	<!DOCTYPE html>
	<html lang="pt-BR">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Planifica√ß√£o Econ√¥mica Democr√°tica com Otimiza√ß√£o</title>
		<link rel="icon" href="./favicon.ico" type="image/x-icon">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.10.1/math.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
		<style>
			
		@font-face {
		font-family: 'Ethnocentric Rg';
		src: url('Ethnocentric Rg.woff2') format('woff2'),
			 url('Ethnocentric Rg.woff') format('woff'),
			 url('Ethnocentric Rg.ttf') format('truetype');
		font-display: swap; /* Garante que o texto √© exibido enquanto a fonte carrega */
	}
			
		body {
			margin: 0;
			position: relative;
		}


	body::before {
		content: "";
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: url('https://i.postimg.cc/mkZcFJ6g/backgroundcibercomunismo-0-NHja4-Lah-transformed.jpg') no-repeat center center;
		background-size: cover;
		z-index: -1;
		animation: pulse-brightness 30s infinite;
		will-change: background-position; /* Otimiza a performance */
		background-attachment: fixed; /* Garante a fixa√ß√£o do fundo */
		background-position: center calc(var(--background-offset, 0%));
	}
			
			@keyframes pulse-brightness {
				0%, 100% {
					filter: brightness(0.9); /* Brilho normal */
				}
				50% {
					filter: brightness(1.7); /* Brilho aumentado */
				}
			}
			
			h1, h2 {
			color: #333;
			display: flex;
			align-items: center; /* Centraliza verticalmente */
			font-family: 'Ethnocentric Rg', 'Courier New', Courier, monospace; !important;
			font-size: 20px; /* Ajuste o tamanho conforme necess√°rio */
			font-weight: normal;
			}
			
			
			table {
		background-color: rgba(100, 0, 0, 0.6) !important; /* Fundo vermelho escuro semi-transparente */
		color: white !important; /* Texto branco para contraste */
		border-collapse: collapse; /* Mescla bordas */
		width: 100%; /* Garante que a tabela ocupe toda a largura dispon√≠vel */
		margin-top: 20px; /* Espa√ßamento superior */
	}

	th, td {
		background-color: rgba(100, 0, 0, 0.5) !important; /* Fundo mais transparente para c√©lulas */
		color: white !important; /* Texto branco */
		border: 1px solid rgba(255, 255, 255, 0.6); /* Bordas brancas semi-transparentes */
		padding: 8px; /* Espa√ßamento interno */
		text-align: center; /* Centraliza o texto */
	}

	th {
		background-color: rgba(100, 0, 0, 0.7) !important; /* Fundo menos transparente para cabe√ßalhos */
	}
			
			button { padding: 10px 20px; margin: 10px 0; background-color: #007bff; color: white; border: none; cursor: pointer; }
			input[type="number"] { width: 80px; }
			input[type="text"] { width: 100%; }
			.demand-field { display: flex; align-items: center; margin-bottom: 10px; }
			.demand-field label { margin-right: 10px; font-weight: bold; }
			.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); }
			.modal-content { background-color: white; margin: 10% auto; padding: 20px; width: 400px; border-radius: 8px; }
			
			/* Estilo padr√£o para os bot√µes */
			button {
				transition: filter 0.3s ease, box-shadow 0.3s ease; /* Adiciona uma transi√ß√£o suave */
			}

			/* Efeito de brilho ao passar o mouse */
			button:hover {
				filter: brightness(1.5); /* Aumenta o brilho*/
				box-shadow: 0 0 10px rgba(255, 150, 150, 0.5); /* Adiciona uma leve luz ao redor */
				cursor: pointer; /* Indica interatividade */
			}
			
			/* Estilo do modal de boas-vindas */
	.modal {
		display: none; /* Inicialmente escondido */
		position: fixed;
		z-index: 1050;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.8); /* Fundo escuro semi-transparente */
		display: flex;
		justify-content: center;
		align-items: center;
		overflow-y: auto; /* Permite rolagem vertical em telas pequenas */
	}

	/* Estilo geral das janelas modais */
	.modal-content {
		background-color: #333; /* Cor de fundo */
		color: white; /* Cor do texto */
		border-radius: 8px;
		max-width: 90%; /* Largura m√°xima para telas pequenas */
		max-height: 90%; /* Altura m√°xima para telas pequenas */
		overflow-y: auto; /* Permite rolagem interna se necess√°rio */
		position: relative; /* Necess√°rio para posicionar elementos internos */
		box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6); /* Sombra estilosa para efeito de profundidade */
	}

	/* Barra de t√≠tulo da janela */
	.modal-title-bar {
		display: flex;
		align-items: center;
		justify-content: flex-start; /* Garante que o t√≠tulo fique alinhado √† esquerda */
		background-color: rgba(100, 0, 0, 0.8); /* Cor de fundo atual */
		padding: 10px 15px;
		border-top-left-radius: 8px; /* Arredonda o canto superior esquerdo */
		border-top-right-radius: 8px; /* Arredonda o canto superior direito */
		font-size: 16px;
		font-weight: bold;
		color: white;
	}

	.modal-title-bar img {
		height: 1em; /* Alinha o tamanho da imagem ao tamanho do texto */
		margin-right: 10px; /* Espa√ßo entre a imagem e o t√≠tulo */
	}


	/* Bot√£o fechar na barra de t√≠tulo */
	.modal-title-bar .close {
		background: none; /* Sem fundo padr√£o */
		border: none;
		font-size: 18px;
		color: white; /* Cor do texto */
		cursor: pointer;
		margin-right: 10px; /* Adiciona espa√ßamento √† direita */
		padding: 5px; /* Adiciona um espa√ßamento interno para melhorar o clique */
		border-radius: 3px; /* Torna as bordas do quadrado levemente arredondadas */
	}

	.modal-title-bar .close:hover {
		background-color: rgba(255, 0, 0, 0.2); /* Fundo vermelho claro ao passar o mouse */
		color: white; /* Mant√©m o texto branco */
	}



	.welcome-image {
		display: block; /* Garante que o GIF seja tratado como um bloco */
		margin: 0 auto; /* Centraliza o GIF horizontalmente */
		max-width: 100%; /* Ajusta o tamanho do GIF a telas pequenas */
		height: auto; /* Mant√©m a propor√ß√£o do GIF */
	}

	/* Estilo geral do bot√£o fechar */
	.modal-content .close {
		background: none; /* Sem fundo padr√£o */
		border: none;
		font-size: 18px;
		color: white; /* Cor do texto */
		cursor: pointer;
		margin-right: 10px; /* Espa√ßamento √† direita */
		padding: 5px; /* Espa√ßamento interno */
		border-radius: 3px; /* Bordas arredondadas */
		position: absolute; /* Garante o posicionamento correto */
		top: 10px; /* Posiciona na parte superior */
		right: 15px; /* Posiciona √† direita */
	}

	/* Efeito de hover para qualquer bot√£o fechar */
	.modal-content .close:hover {
		background-color: rgba(255, 0, 0, 0.2); /* Fundo vermelho claro ao passar o mouse */
		color: white; /* Mant√©m o texto branco */
	}

			
			
			/* Estilo geral para fontes e cor de texto */
	body {
		font-family: 'Courier New', Courier, monospace;
		color: white; /* Define o texto geral como branco */
		font-weight: bold;
	}

	/* Estilo para todas as tabelas */
	table {
		background-color: rgba(100, 0, 0, 0.8); /* Fundo vermelho ainda mais escuro e menos transparente */
		color: white; /* Define o texto das tabelas como branco */
		border: 1px solid rgba(255, 255, 255, 0.6); /* Borda branca transparente */
		font-weight: bold;
	}

	th, td {
		background-color: rgba(100, 0, 0, 0.8); /* Fundo vermelho ainda mais escuro e menos transparente */
		color: white; /* Define o texto das c√©lulas como branco */
		border: 1px solid rgba(255, 255, 255, 0.6);
		padding: 8px;
		font-weight: bold;
	}

	/* Se√ß√£o comum para "Vetor Tecnol√≥gico" e "Tamanho da Unidade Produtiva" */
	.config-section {
		padding: 20px;
		background-color: rgba(100, 0, 0, 0.8);
		border: 1px solid rgba(255, 255, 255, 0.6);
		border-radius: 8px;
		margin-bottom: 20px;
		display: flex; /* Usando flexbox para alinhar a se√ß√£o e o globo lado a lado */
		flex-wrap: wrap; /* Permite que o conte√∫do se ajuste no layout */
		justify-content: flex-start; /* Alinha os itens √† esquerda */
		gap: 20px; /* Espa√ßo entre os elementos da se√ß√£o */
	}
	
	/* Se√ß√£o "Tamanho da Unidade Produtiva" */
	#tamanhoUnidadeProdutivaSection {
		margin-left: 0; /* Remove a margem extra para alinhar √† esquerda */
		width: 100%; /* Garantir que ocupe 100% da largura dispon√≠vel */
	}

	/* Alinhamento do conte√∫do */
	#tamanhoUnidadeProdutivaSection div {
		display: flex;
		align-items: center;
		justify-content: flex-start; /* Alinha √† esquerda */
		gap: 10px;
	}

	#tamanhoUnidadeProdutivaSection input {
		background-color: rgba(100, 0, 0, 0.8);
		color: white;
		border: 1px solid rgba(255, 255, 255, 0.6);
		padding: 8px;
		font-family: 'Courier New', Courier, monospace;
		text-align: center;
		width: 150px; /* Define a largura do campo */
	}

	/* T√≠tulos das se√ß√µes */
	.config-section h2 {
		text-align: center;
		margin-bottom: 15px;
		font-size: 1.5em;
	}

	/* Centraliza√ß√£o dos campos */
	.config-fields {
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: 10px; /* Espa√ßamento entre os campos */
	}

	/* T√≠tulo "Tamanho da Economia" */
	.config-section h2 {
		text-align: center; /* Centraliza o t√≠tulo horizontalmente */
		margin-bottom: 20px; /* Espa√ßamento abaixo do t√≠tulo */
		width: 100%; /* T√≠tulo ocupa toda a largura */
	}

	/* Garantir que o globo e a se√ß√£o se ajustem sem sobreposi√ß√£o */
	.config-content {
		display: flex;
		align-items: center; /* Alinha o globo e os campos verticalmente */
		justify-content: flex-start; /* Garante que o conte√∫do da se√ß√£o seja ajustado antes do globo */
		gap: 20px; /* Espa√ßamento entre a se√ß√£o e o globo */
		width: 100%; /* Ajuste a largura para garantir que a se√ß√£o ocupe toda a √°rea */
	}

	/* T√≠tulos em branco */
	h1, h2 {
		background-color: rgba(100, 0, 0, 0.8); /* Fundo vermelho ainda mais escuro e menos transparente */
		color: white; /* Define os t√≠tulos como brancos */
		padding: 10px;
		border-radius: 5px;
		font-weight: bold;
	}



	/* Estilo para todos os campos de entrada, bot√µes e seletores */
	input[type="number"], input[type="text"], input[type="checkbox"], select, button {
		background-color: rgba(100, 0, 0, 0.5); /* Fundo vermelho ainda mais escuro e menos transparente */
		color: white; /* Define o texto dos campos e bot√µes como branco */
		font-family: 'Courier New', Courier, monospace;
		padding: 5px;
		font-weight: bold;
		border: 1px solid rgba(255, 255, 255, 0.6); /* Borda semitransparente */
		padding: 5px; /* Espa√ßamento interno */
		border-radius: 4px; /* Borda levemente arredondada */
	}

	/* Para esconder as modais de otimiza√ß√£o */
	#optimizationModal, #optimizationResultModal {
		display: none; /* Inicialmente escondido */
		position: fixed;
		z-index: 1050;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.8); /* Fundo escuro semi-transparente */
		justify-content: center;
		align-items: center;
	}


	/* Estilo da imagem de boas-vindas */
	.welcome-image {
		width: 100%;
		max-width: 300px;
		margin-bottom: 15px;
	}

	#welcomeModal .modal-content {
		background-color: white; /* Fundo branco */
		color: black; /* Texto preto para contraste */
	}

		.info-bar {
		background-color: rgba(100, 0, 0, 0.8); /* Fundo vermelho transparente */
		color: white;
		font-family: 'Courier New', Courier, monospace;
		font-weight: bold;
		padding: 10px 15px;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		z-index: 1000;
		box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
		display: flex;
		flex-direction: column;
		gap: 10px;
	}

	.news-ticker {
		display: flex;
		align-items: center; /* Alinha verticalmente o texto e a imagem */
		justify-content: space-between; /* Espa√ßa o texto e o √≠cone */
		white-space: nowrap;
		overflow: hidden; /* Impede o conte√∫do de transbordar */
		padding-right: 35px; /* Adiciona espa√ßo √† direita do cont√™iner */
		box-sizing: border-box; /* Garante que o padding seja inclu√≠do nas dimens√µes totais */
	}


	#newsMarquee {
		flex-grow: 1; /* Faz o texto ocupar o m√°ximo de espa√ßo dispon√≠vel */
	}

	.ticker-icon {
		height: 1.5em; /* Ajusta o tamanho da imagem */
		max-width: 50px; /* Limita a largura m√°xima do √≠cone */
		margin-left: 10px; /* Espa√ßo entre o texto e a imagem */
		margin-right: 0; /* Remove margens adicionais se necess√°rio */
		vertical-align: middle;
	}





	/* Linha com o GIF e o texto */
	.info-row {
		display: flex;
		align-items: center; /* Alinha verticalmente o texto e o GIF */
		gap: 10px; /* Espa√ßamento entre o GIF e o texto */
	}

	/* Estilo do texto com localiza√ß√£o e hora */
	#infoText {
		font-size: 18px;
	}

	/* Estilo do GIF */
	.info-gif {
		height: 2em; /* Ajuste proporcional ao tamanho do texto */
		vertical-align: middle;
	}

	/* Letreiro de not√≠cias */
	#newsTicker {
		overflow: visible; /* Garante que nada seja cortado */
		height: auto; /* Ajusta a altura automaticamente */
		padding-top: 5px; /* Espa√ßo extra acima do texto/imagem */
		display: flex; /* Habilita flexbox para centraliza√ß√£o */
		align-items: flex-end;
	}

	#newsTicker img {
		height: 1.7em; /* Mesmo tamanho do texto do letreiro */
		vertical-align: middle; /* Alinha verticalmente com o texto */
		margin-right: 1px; /* Espa√ßo entre a imagem e o texto */
		transform: translateY(-1px); /* Move a imagem 5 pixels para cima */
	}

			#successBox {
		position: fixed;
		top: -50px; /* Come√ßa fora da tela */
		left: 50%;
		transform: translateX(-50%);
		background-color: rgba(0, 255, 0, 0.8); /* Fundo verde transparente */
		color: white;
		padding: 10px 20px;
		border-radius: 5px;
		font-size: 16px;
		font-weight: bold;
		text-align: center;
		opacity: 0; /* Transparente inicialmente */
		transition: top 0.5s ease, opacity 0.5s ease; /* Anima√ß√µes */
		z-index: 2000;
	}

	.welcome-ticker {
		overflow: hidden; /* Esconde o conte√∫do que transborda */
		white-space: nowrap; /* Impede quebra de linha */
		box-sizing: border-box;
		width: 100%; /* Ajusta √† largura do modal */
		font-size: 1.5em; /* Tamanho do texto */
		color: black; /* Cor do texto */
		background-color: rgba(255, 255, 255, 0.8); /* Fundo branco semi-transparente */
		padding: 10px; /* Espa√ßamento interno */
	}

	.welcome-ticker span {
		display: inline-block;
		animation: scroll-text 10s linear infinite; /* Aplica a anima√ß√£o */
	}

	@keyframes scroll-text {
		0% {
			transform: translateX(100%); /* Come√ßa fora da tela, √† direita */
		}
		100% {
			transform: translateX(-100%); /* Sai fora da tela, √† esquerda */
		}
	}

	#globeWrapper {
    position: relative; /* Define o contexto de posi√ß√£o */
    width: 300px; /* Ajuste de acordo com o tamanho do globo */
    height: 300px;
    margin: 0 auto; /* Centraliza o cont√™iner */
}

	#globeBorder {
		position: absolute;
		top: 50%;
		left: 50%;
		width: 350px; /* Ajuste para ser um pouco maior que o globo */
		height: 350px;
		transform: translate(-50%, -50%); /* Centraliza a imagem no cont√™iner */
		z-index: 0; /* Garante que fique atr√°s do globo */
		opacity: 0.5; /* Define a transpar√™ncia */
		pointer-events: none; /* Impede que a imagem interfira com cliques */
	}

	#globeContainer.logged-in {
		width: 300px;
		height: 300px;
		position: relative; /* Relativo ao cont√™iner pai */
		margin-left: 20px; /* Espa√ßamento entre a se√ß√£o e o globo */
		display: flex;
		justify-content: center;
		align-items: center;
		float: right; /* Alinha o globo √† direita */
		z-index: 1; /* Manter o globo no topo, sem esconder a se√ß√£o */
	}

	#globeContainer {
		width: 300px;
		height: 300px;
		position: relative; /* Relativo ao cont√™iner pai */
		margin-left: auto; /* Centraliza horizontalmente */
		margin-right: auto; /* Centraliza horizontalmente */
		display: block; /* Garante que o cont√™iner se comporte como bloco */
		z-index: 1;
		visibility: hidden; /* Oculta inicialmente */
	}

#globeContainer::before {
    content: "";
    position: absolute;
    top: 60%;
    left: 50%;
    width: 350px; /* Ajuste para ser maior que o globo */
    height: 350px;
    background: url('https://i.postimg.cc/TPs1T9y9/bordalogourss-transformed-removebg-preview.png') no-repeat center center;
    background-size: contain;
    transform: translate(-50%, -50%);
    z-index: 0; /* Garante que fique atr√°s do globo */
    opacity: 0.5; /* Define a transpar√™ncia */
    pointer-events: none; /* Evita interfer√™ncia com cliques */
}

#globeContainer::after {
    content: "";
    position: absolute;
    top: 40%;
    left: 50%;
    width: 300px; /* Ajuste para o tamanho desejado da faixa */
    height: 290px;
    transform: translateX(-50%);
    background: url('https://i.postimg.cc/m2s8BxFm/faixatrabalhadoresunivos-semfundo.png') no-repeat center center;
    background-size: contain;
    z-index: 2; /* Garante que a faixa fique acima do globo e dos ramos */
	opacity: 0.9; /* Define a transpar√™ncia */
    pointer-events: none; /* Evita que interfira em intera√ß√µes */
}


	/* Estilo geral para os campos de entrada */
	input[type="text"], input[type="password"] {
		background-color: rgba(100, 0, 0, 0.8); /* Fundo vermelho escuro transl√∫cido */
		color: white; /* Texto branco */
		border: 1px solid rgba(255, 255, 255, 0.6); /* Borda branca transl√∫cida */
		padding: 5px;
		font-family: 'Courier New', Courier, monospace;
		font-weight: bold;
	}

	/* Placeholder com tom de cinza mais claro */
	input[type="text"]::placeholder, input[type="password"]::placeholder {
		color: rgba(200, 200, 200, 0.7); /* Cinza claro transl√∫cido */
		font-style: italic; /* Texto em it√°lico */
	}

	/* Altera√ß√µes ao focar no campo */
	input[type="text"]:focus, input[type="password"]:focus {
		outline: none; /* Remove o contorno padr√£o */
		background-color: rgba(100, 0, 0, 0.9); /* Fundo mais opaco ao focar */
		border: 1px solid rgba(255, 255, 255, 0.8); /* Borda mais clara ao focar */
	}	
	
	#vetorTecnologicoSection {
		margin-top: 20px;
	}

	/* Aplica o efeito de hover para todas as tabelas */
	table tbody tr:hover {
		background-color: rgba(255, 150, 150, 0.5); /* Cor de destaque ao passar o mouse */
	}
		
	/* Define o cursor padr√£o para campos readonly */
	input[readonly] {
		cursor: default; /* Mant√©m o cursor como setinha */
	}
	
	.custom-tooltip {
		position: absolute;
		background-color: rgba(0, 0, 0, 0.8); /* Fundo preto semi-transparente */
		color: white; /* Texto branco */
		padding: 5px 10px; /* Espa√ßamento interno */
		border-radius: 4px; /* Bordas arredondadas */
		font-size: 14px; /* Tamanho do texto */
		white-space: nowrap; /* Impede quebra de linha */
		pointer-events: none; /* Evita interfer√™ncia do mouse */
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra para destaque */
		z-index: 1000; /* Garante que fique no topo */
	}

	/* Desabilita a sele√ß√£o de texto globalmente */
* {
    user-select: none; /* Desativa a sele√ß√£o */
}

/* Permite a sele√ß√£o apenas em campos de texto */
input[type="text"], textarea {
    user-select: text; /* Permite a sele√ß√£o de texto */
}

.highlight-column {
    background-color: rgba(120, 30, 30, 0.5) !important;
}

	#inputTable {
		cursor: cell; /* Exibe um cursor de cruz, similar ao Excel */
	}

#inputTable input{
	cursor: cell; /* Exibe um cursor de cruz, similar ao Excel */
    background-color: transparent !important;
    border: none !important;
    color: white !important;
    padding: 0 !important;
    font-family: inherit;
    font-size: inherit;
    box-shadow: none !important;
}

#inputTable input:focus {
    outline: none !important;
}

#inputTable input[type="text"]{
    text-align: right !important; /* Alinha o texto √† direita */
	direction: rtl;    /* Inverte a dire√ß√£o para mostrar a parte final do texto */
}

 /* Estilo do bot√£o e do menu */
    #languageMenu {
        position: absolute;
        background-color: rgba(100, 0, 0, 0.9); /* Fundo escuro alinhado com o estilo da p√°gina */
        color: white; /* Texto branco */
        border: 1px solid rgba(255, 255, 255, 0.6); /* Borda transl√∫cida */
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6); /* Sombra para destaque */
        z-index: 1000;
        display: none; /* Oculto por padr√£o */
    }

    #languageMenu button {
        display: block;
        background: none;
        border: none;
        color: white;
        text-align: left;
        padding: 5px;
        width: 100%;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    #languageMenu button:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Destaque ao passar o mouse */
    }

    /* Estilo do bot√£o principal */
    #languageButton {
        background-color: rgba(100, 0, 0, 0.8); /* Alinhado ao padr√£o da p√°gina */
        border: 1px solid rgba(255, 255, 255, 0.6);
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 20px;
        cursor: pointer;
        transition: filter 0.3s;
    }

    #languageButton:hover {
        filter: brightness(1.5); /* Efeito de brilho */
    }
		
	.worker-config-section {
		align-items: flex-start; /* Alinha os itens no topo */		
		padding: 20px;
		background-color: rgba(100, 0, 0, 0.8);
		border: 1px solid rgba(255, 255, 255, 0.6);
		border-radius: 8px;
		margin-bottom: 20px;
		display: flex; /* Usando flexbox para alinhar a se√ß√£o e o globo lado a lado */
		flex-wrap: wrap; /* Permite que o conte√∫do se ajuste no layout */
		justify-content: flex-start; /* Alinha os itens √† esquerda */
		gap: 20px; /* Espa√ßo entre os elementos da se√ß√£o */
	}

	.worker-config-section > div {
		display: flex;
		flex-direction: column; /* Alinha os campos verticalmente */
		gap: 10px; /* Espa√ßamento entre os itens */
	}

	#uuidQRCode {
		min-width: 200px;
		min-height: 200px;
		margin: 0; /* Remove margens autom√°ticas */
		margin-top:30px;
		border: 1px solid #ccc;
	}
			
		</style>
	</head>
	<body>
	
		<div id="welcomeModal" class="modal">
			<div class="modal-content">
				<div class="modal-title-bar">
					<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<span>Planifica√ß√£o Econ√¥mica Democr√°tica e com Otimiza√ß√£o</span>
					&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<button class="close" onclick="closeWelcomeModal()">&times;</button>
				</div>
				<br>
				<img src="https://s11.gifyu.com/images/Syrzl.gif" alt="Imagem de boas-vindas" class="welcome-image">
				<h2>Bem-Vindo √† Ditadura do Proletariado, Companheiro!</h2>
				<div id="welcomeTicker" class="welcome-ticker">
					<span>√â hora de arrumarmos a casa!</span>
				</div>
				
			</div>
		</div>

	<div id="successBox">Salvo!</div>


		<br>&nbsp <br> &nbsp <br> &nbsp <br> &nbsp <br> &nbsp <br>
		<h1>
		Planificacao Economica Teste |&nbsp;<audio id="audioContainer" src="https://cast.hoost.com.br:20064/stream" autoplay controls></audio>
		&nbsp;
		<button id="languageButton" onclick="toggleLanguageMenu(event)">üåê</button>
		<div id="languageMenu" style="display: none;">
			<button onclick="translatePage('pt')">üáßüá∑ Portugu√™s</button>
			<button onclick="translatePage('es')">üá¶üá∑ Espa√±ol</button>
			<button onclick="translatePage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
			<button onclick="translatePage('ar')">üáµüá∏ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
			<button onclick="translatePage('fr')">üá≠üáπ Fran√ßais</button>
			<button onclick="translatePage('en')">üá∏üá© English</button>
			<button onclick="translatePage('yo')">üá≥üá¨ √àd√® Yor√πb√°</button>
			<button onclick="translatePage('zh')">üá®üá≥ ‰∏≠Êñá</button>
		</div>
		
		</h1>
		<div id="infoBar" class="info-bar">
			<!-- Linha com GIF e informa√ß√µes de localiza√ß√£o, data e hora -->
			<div class="info-row">
				<img src="https://s11.gifyu.com/images/SyrSF.gif" alt="Foice e Martelo" class="info-gif">
				<span id="infoText"></span>
			</div>
			<!-- Letreiro com imagem -->
		<div id="newsTicker" class="news-ticker">
			<marquee id="newsMarquee" style="font-size: 16px; color: white;"></marquee>
			<img src="https://images.emojiterra.com/twitter/v13.1/512px/1f4c8.png" alt="√çcone de gr√°fico" class="ticker-icon">
		</div>
		</div>




	<div id="loginSection" class="config-section" style="display: none;">
		<h2>Login</h2>
		<!-- Campo Nome de Usu√°rio -->
		<label for="username">Nome de Usu√°rio: </label>
		<input type="text" id="username" name="username" placeholder="Digite seu nome de usu√°rio" maxlength="55" style="width: 250px;">
		<br><br>

		<!-- Campo Senha -->
		<label for="password">Senha: </label>
		<input type="password" id="password" name="password" placeholder="Digite sua senha">
		<br><br>

		<!-- Bot√µes Entrar e Cadastre-se -->
		<button id="loginButton" onclick="handleLogin()">Entrar</button>
		<button id="registerButton" onclick="showRegistrationFields()">Cadastre-se</button>
		<br><br>

		<div id="registrationFields" style="display: none;">
		
			<label for="nameRegistration" style="margin-left: 10px;">Nome:</label>
			<input type="text" id="nameRegistration" placeholder="Digite seu nome completo" style="width: 150px; margin-left: 5px;">
		
			<div style="display: flex; align-items: center;">
				<label for="pronoun" style="margin-right: 10px;">Pronome: </label>
				<select id="pronoun" name="pronoun">
					<option value="feminino">Feminino</option>
					<option value="masculino">Masculino</option>
					<option value="neutro">Neutro</option>
				</select>
			</div>
		
			<label for="instance">Inst√¢ncia: </label>
			<select id="instance" name="instance" onchange="showFields()">
				<option value="" disabled selected>Selecione...</option>
				<option value="Trabalhador">Trabalhador</option>
				<option value="Associa√ß√£o de Moradores">Associa√ß√£o de Moradores</option>
				<option value="Comit√™ de Bairro">Comit√™ de Bairro</option>
				<option value="Comit√™ de F√°brica">Comit√™ de F√°brica</option>
				<option value="Comit√™ do Campo">Comit√™ do Campo</option>
				<option value="Comit√™ de Rede de Distribui√ß√£o">Comit√™ de Rede de Distribui√ß√£o</option>
				<option value="Comit√™ de Rede de Servi√ßo">Comit√™ de Rede de Servi√ßos</option>
				<option value="Conselho Popular Distrital de F√°brica">Conselho Popular Distrital de F√°brica</option>
				<option value="Conselho Popular Distrital Urbano">Conselho Popular Distrital Urbano</option>
				<option value="Conselho Popular Distrital de Rede de Distribui√ß√£o">Conselho Popular Distrital de Rede de Distribui√ß√£o</option>
				<option value="Conselho Popular Distrital de Rede de Servi√ßos">Conselho Popular Distrital de Rede de Servi√ßos</option>
				<option value="Conselho Popular Municipal">Conselho Popular Municipal</option>
				<option value="Conselho Popular Regional Estadual">Conselho Popular Regional Estadual</option>
				<option value="Conselho Popular Estadual">Conselho Popular Estadual</option>
				<option value="Conselho Popular Regional Nacional">Conselho Popular Regional Nacional</option>
				<option value="Conselho Popular Nacional">Conselho Popular Nacional</option>
				<option value="Conselho Popular Regional Continental">Conselho Popular Regional Continental</option>
				<option value="Conselho Popular Continental">Conselho Popular Continental</option>
				<option value="Conselho Popular Intercontinental">Conselho Popular Intercontinental</option>
			</select>
			<br><br>

			<!-- Campos adicionais -->
			<div id="additionalFields" style="display: none; flex-direction: column; gap: 10px;">
			
				<label for="preposition" style="margin-right: 10px;">Preposi√ß√£o: </label>
				<select id="preposition" name="preposition" style="width: 80px;">
					<option value="de">de</option>
					<option value="da">da</option>
					<option value="do">do</option>
				</select>
			
				<div style="align-items: center;">
					<label for="jurisdiction" style="margin-right: 10px;">Jurisdi√ß√£o: </label>
					<input 
						type="text" 
						id="jurisdiction" 
						name="jurisdiction" 
						placeholder="Nome do Local, Regi√£o etc."
						style="
							color: gray; 
							font-style: italic; 
							width: 200px; 
							background-color: transparent; 
							border: 1px solid white;
							padding: 5px;
						"
						onfocus="this.style.color='white'; this.style.fontStyle='normal'; if(this.value==='Nome do Local, Regi√£o etc.')this.value='';" 
						onblur="if(this.value===''){this.style.color='gray'; this.style.fontStyle='italic'; this.value='Nome do Local, Regi√£o etc.';}"
					>
				</div>
				<div style="display: flex; align-items: center;">
					
				</div>
			</div>
			
			<br><br>
			<!-- Bot√£o Cadastrar -->
			<button id="registerSubmitButton" onclick="handleRegister()">Cadastrar</button>
			
		</div>	
	</div>

	<br>


		</div>

	<div id="globeContainer"></div>


	<div id="logado" style="display: none;">

	<div id="conselheiroDeConselho">
		<div class="config-section">
			<h2>Tamanho da Economia</h2>
			<label for="numRows">N√∫mero de produtos:</label>
			<input type="number" id="numRows" value="3" min="1" onkeydown="handleEnter(event)">
			<label for="numCols">N√∫mero de Setores Produtivos:</label>
			<input type="number" id="numCols" value="3" min="1" onkeydown="handleEnter(event)">
			
			<button onclick="resizeTable()" class="btn">Redimensionar</button>
			<button onclick="confirmClearTable()">Limpar Tabela</button>
			<button onclick="resetEconomy()">Resetar Economia</button>

			<label><input type="checkbox" id="autoFillCheckbox" onchange="toggleAutoFill()"> Preenchimento Autom√°tico</label>
			
			<div style="margin-bottom: 10px;">
				<label for="conselhoPopularAssociadoDeConselhoPopular">Conselho Popular Associado:</label>
				<input 
					type="text" 
					id="conselhoPopularAssociadoDeConselhoPopular" 
					style="width: 300px;">
					
				<button class="btn" style="margin-left: 10px;" onclick="fetchEstimates()">Calcular Estimativas</button>
			</div>

			
		</div>

		<div class="input-section">
			<h2>Matriz Tecnol√≥gica</h2>
			<table id="inputTable">
				<thead>
					<tr>
						<th>Produtos / Setores Produtivos</th>
						<th><input type="text" value="Produ√ß√£o de Autom√≥veis" readOnly></th>
						<th><input type="text" value="Produ√ß√£o de Computadores" readOnly></th>
						<th><input type="text" value="Produ√ß√£o de Celulares" readOnly></th>
					</tr>
				</thead>
				<tbody id="inputTechnologicalMatrixTableBody">
					<!-- Linhas ser√£o preenchidas dinamicamente -->
				</tbody>
			</table>


			<h2 id="SecaoDemandaFinal">Demanda Final</h2>
	<table id="finalDemandTable">
		<thead>
			<tr>
				<th>Produto</th>
				<th>Demanda (mil)</th>
				<th>A√ß√µes</th>
			</tr>
		</thead>
		<tbody id="finalDemandInputs">
			<tr>
				<td>Autom√≥veis</td>
				<td><input id="demand0" type="number" value="1"></td>
				<td><button onclick="openOptimizationModal(0)">Otimizar</button></td>
			</tr>
			<tr>
				<td>Computadores</td>
				<td><input id="demand1" type="number" value="0"></td>
				<td><button onclick="openOptimizationModal(1)">Otimizar</button></td>
			</tr>
			<tr>
				<td>Celulares</td>
				<td><input id="demand2" type="number" value="0"></td>
				<td><button onclick="openOptimizationModal(2)">Otimizar</button></td>
			</tr>
		</tbody>
	</table>

	<button onclick="planify()">Planificar</button>


		<!-- Modal para entrada de par√¢metros de otimiza√ß√£o -->
		<div id="optimizationModal" class="modal">
			<div class="modal-content">
				<div class="modal-title-bar">
					<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<span>Par√¢metros de Otimiza√ß√£o</span>
					&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<button class="close" onclick="closeOptimizationModal()">&times;</button>
				</div>
				<p><strong>Produto:</strong> <span id="productName"></span></p>
				<label for="workerLimit">Limite de Trabalhadores nas F√°bricas:</label>
				<input type="number" id="workerLimit" required><br><br>
				<label for="workerHours">Carga Hor√°ria Di√°ria (h):</label>
				<input type="number" id="workerHours" max="12" required><br><br>
				<label for="productionTime">Tempo para Produzir 1 Unidade (h):</label>
				<input type="number" id="productionTime" required><br><br>
				<label for="weeklyScale">Escala semanal (dias):</label>
				<input type="number" id="weeklyScale" min="1" max="7" required><br><br>
				<label for="nightShift">Turno Noturno:</label>
				<input type="checkbox" id="nightShift"><br><br>
				<button onclick="saveOptimizationInputs()">Salvar</button>
			</div>
		</div>



		<!-- Modal para exibir resultados de otimiza√ß√£o -->
		<div id="optimizationResultModal" class="modal">
			<div class="modal-content">
				<div class="modal-title-bar">
					<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<span>Plano de Produ√ß√£o do Setor</span>
					&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
					<button class="close" onclick="closeOptimizationResultModal()">&times;</button>
				</div>
				<div id="optimizationResult"></div>
			</div>
		</div>


		<div class="output-section">
			<!-- T√≠tulo "Planifica√ß√£o Otimizada", vis√≠vel ap√≥s clicar em "Planificar" -->
			<h2 id="planificationTitle" style="display: none;">Planifica√ß√£o Otimizada</h2>
			<div id="result"></div>
		</div>

	<!-- Bot√£o "Dados copi√°veis", vis√≠vel ap√≥s clicar em "Planificar" -->
	<button id="openCopyableDataModal" class="btn" style="display: none;">Dados copi√°veis</button>

	<!-- Janela modal para exibir os dados copi√°veis -->
	<div id="copyableDataModal" class="modal" style="display: none;">
		<div class="modal-content">
			<div class="modal-title-bar">
				<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<span>Dados Copi√°veis</span>
				&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<button class="close" onclick="closeCopyableDataModal()">&times;</button>
			</div>

			<div class="modal-body">
				<h3>Matriz Tecnol√≥gica (para c√≥pia)</h3>
				<pre id="matrixModalOutput" style="background-color: #333; color: white; padding: 10px; border-radius: 8px; overflow-x: auto;"></pre>
				<h3>Vetor de Demanda (para c√≥pia)</h3>
				<pre id="vectorModalOutput" style="background-color: #333; color: white; padding: 10px; border-radius: 8px; overflow-x: auto;"></pre>
			</div>
		</div>
	</div>

		<button id="downloadDataButton" class="btn" style="display: none;">Salvar Localmente</button>
		<button id="uploadDataButton" class="btn">Upload de Arquivo</button>
		<input type="file" id="uploadInput" style="display: none;" accept=".csv" />
		<button id="sendDataButton" class="btn" onclick="sendDataToJsonBin()" style="display: none;">Salvar Online</button>
		<button id="fetchDataButton" class="btn" onclick="fetchDataFromJsonBin()">Receber Online</button>
	</div>
	</div>
	<div id="conselheiroDeComiteDeFabricaOuCampo">

	<div id="tamanhoUnidadeProdutivaSection">
		<h2>Informa√ß√µes da Unidade Produtiva</h2>
		<div class="config-section">
			<label for="quantidadeBensProducao" style="margin: 0;">Quantidade de Bens de Produ√ß√£o:</label>
			<input 
				type="number" 
				id="quantidadeBensProducao" 
				value="3" 
				min="1" 
				onkeydown="if (event.key === 'Enter') updateVetorTecnologicoTable()" 
				style="width: 100px;">
			<button onclick="updateVetorTecnologicoTable()">Redimensionar</button>
			
			 <!-- Novo campo de texto "Setor" -->
			<label for="setorUnidade" style="margin-left: 10px;">Setor:</label>
			<input 
				type="text" 
				id="setorUnidade" 
				placeholder="Digite o setor"
				style="width: 150px; margin-left: 5px;">
				
			<label for="comiteColTitle" style="margin-left: 10px;">Nome da Unidade de Produ√ß√£o:</label>
			<input type="text" id="comiteColTitle" placeholder="Digite o comit√™" style="width: 150px; margin-left: 5px;">
			
			 <div style="margin-bottom: 10px;">
				<label for="limiteEfetivoTrabalhadores">Limite Efetivo de Trabalhadores na Unidade de Produ√ß√£o:</label>
				<input 
					type="number" 
					id="limiteEfetivoTrabalhadores" 
					style="width: 150px;">
			</div>

			<div style="margin-bottom: 10px;">
				<label for="conselhoPopularAssociadoDeComiteOuTrabalhador">Conselho Popular Associado:</label>
				<input 
					type="text" 
					id="conselhoPopularAssociadoDeComiteOuTrabalhador" 
					style="width: 300px;">
			</div>
			
			<div style="margin-bottom: 10px;">
				<button id="updateDemandAndGoalButton" class="btn" onclick="updateDemandAndGoal()">Atualizar Demanda e Meta</button>
			</div>
			
		</div>
	</div>

	<div id="vetorTecnologicoSection">
		<h2>Vetor Tecnol√≥gico</h2>
		<table id="vetorTecnologicoTable" class="input-section">
			<thead>
				<tr>
					<th>Bens de Produ√ß√£o</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<!-- Linhas preenchidas dinamicamente -->
			</tbody>
		</table>
	</div>

	<div id="estoqueDemandaSection" class="input-section">
		<h2>Estoque e Demanda</h2>
		<table id="estoqueDemandaTable">
			<thead>
				<tr>
					<th>Bem de Produ√ß√£o</th>
					<th>Estoque (mil)</th>
					<th>Demanda (mil)</th>
					<th>
						<button id="propostaButton" class="btn" onclick="openPropostaModal()">Proposta</button>
					</th>
				</tr>
			</thead>
			<tbody>
				<!-- Linhas preenchidas dinamicamente -->
			</tbody>
		</table>
	</div>




	<!-- Modal "Proposta para demais Trabalhadores" -->
	<div id="propostaModal" class="modal" style="display: none;">
		<div class="modal-content">
			<div class="modal-title-bar">
				<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<span>Proposta para demais Trabalhadores</span>
				&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<button class="close" onclick="closePropostaModal()">&times;</button>
			</div>
			<p><strong>Nome da Unidade de Produ√ß√£o:</strong> <span id="unitName"></span></p>
			<label for="workerLimitProposta">Limite de Trabalhadores na Unidade de Produ√ß√£o:</label>
			<input type="number" id="workerLimitProposta" required><br><br>
			<label for="workerHoursProposta">Carga Hor√°ria Di√°ria (h):</label>
			<input type="number" id="workerHoursProposta" max="12" required><br><br>
			<label for="productionTimeProposta">Tempo para Produzir 1 Unidade (h):</label>
			<input type="number" id="productionTimeProposta" required><br><br>
			<label for="weeklyScaleProposta">Escala semanal (dias):</label>
			<input type="number" id="weeklyScaleProposta" min="1" max="7" required><br><br>
			<label for="nightShiftProposta">Turno Noturno:</label>
			<input type="checkbox" id="nightShiftProposta"><br><br>
			<button onclick="savePropostaInputs()">Salvar</button>
		</div>
	</div>

	<div id="producaoMetaSection" class="input-section">
		<h2>Produ√ß√£o e Meta</h2>
		<table id="producaoMetaTable">
			<thead>
				<tr>
					<th>Produto</th>
					<th>Quantidade Produzida (mil)</th>
					<th>Quantidade que Falta ser Produzida (mil)</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="text" value="Produto Produzido"></td>
					<td><input id="producedQuantity" type="number" value="0"></td>
					<td><input id="pendingProductionQuantity" type="number" value="10000" readOnly></td>
					<td>
						<button class="btn" onclick="openProducaoMetaModal()">Planejamento</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- Modal para "Plano dessa Unidade de Produ√ß√£o" -->
	<div id="producaoMetaModal" class="modal" style="display: none;">
		<div class="modal-content">
			<div class="modal-title-bar">
				<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<span>Plano dessa Unidade de Produ√ß√£o</span>
				&nbsp;<img src="https://i.postimg.cc/TPhm79zs/pngwing-com-8.png" alt="√çcone de estrela">
				<button class="close" onclick="closeProducaoMetaModal()">&times;</button>
			</div>
			<div id="producaoMetaContent">
				<p><strong>Nome da Unidade de Produ√ß√£o:</strong> ${comiteColTitle}</p>
				<p><strong>Produto:</strong> ${productName}</p>
				<p><strong>Expediente:</strong> ${data.optimizationInputs[productIndex].workerHours} horas</p>
				<p><strong>Escala Semanal:</strong> ${data.optimizationResults[productIndex].workerHours}</p>
				<p><strong>Quantidade Necess√°ria de Trabalhadores:</strong> ${optimizationInputs[productIndex].workerLimit}</p>
				<p><strong>Produ√ß√£o pendente:</strong> ${instanceData.producaoMeta}</p>
				<p><strong>Turno:</strong> ${instanceData.workShift}</p>
				<p><strong>Tempo para Produ√ß√£o (para contrata√ß√£o ou renova√ß√£o):</strong> ${instanceData.totalEmploymentPeriod}</p>
			</div>
		</div>
	</div>


	</div>


	<div id="conselheiroDeAssociacaoDeMoradores"> Conselheiro de Associa√ß√£o de Moradores </div>

	<div id="trabalhador">
	
	Tela de Trabalhador <br/><br/>
	Trabalho Social Total: <input id="totalSocialWork" /> <br/>
	
	Participa√ß√£o Social no Trabalho Social (0,01% 0,001: ${percentualTrabalhoSocialDoTrabalhador}
	Lista de Produtos do Conselho Associado √† sua Associa√ß√£o de Moradores: <br/>
	<span id="produtosParaConsumoDoTrabalhador">
	- Produto 1 (${percentualTrabalhoSocialProduto[1]}) <br/>
	- Produto 2 (${percentualTrabalhoSocialProduto[2]}) <br/>
	</span>
	
	<br/><br/>
	
	Onde<br/>
	- ${percentualTrabalhoSocialDoTrabalhador} = ${horasTrabalhadasDoTrabalhador/totalSocialWork} <br/>
	- ${percentualTrabalhoSocialProduto[1]} =  ${horaTrabalhadaPraProduzir1UnidadeDoProduto/totalSocialWork} <br/>
	<br/>
	- -${horasTrabalhadasDoTrabalhador} vir de um campo "Horas no Ponto Eletr√¥nico: <input id="horasTrabalhadasDoTrabalhador" />".<br/>
	
	
	
	<div id="workCertificateSection">
		
		<div id="workCertificateSection">
		<h2>Certificado de Trabalho</h2>
		<div class="worker-config-section">
			<!-- QR Code --><br/>
			<div id="uuidQRCode"></div>

			<!-- Campos de entrada -->
			<div>
				<label for="name" style="margin-left: 10px;">Nome:</label>
				<input type="text" id="name" placeholder="Nome ainda n√£o cadastrado" style="width: 150px; margin-left: 5px;" readOnly>

				<label for="conselhoPopularAssociadoDeComiteOuTrabalhadorTelaTrabalhador">
					Conselho de Distribui√ß√£o e Servi√ßo Associado:
				</label>
				<input type="text" id="conselhoPopularAssociadoDeComiteOuTrabalhadorTelaTrabalhador" style="width: 300px;">

				<label for="comiteAssociadoDeTrabalhador">Comit√™ de Unidade de Produ√ß√£o Associado:</label>
				<input type="text" id="comiteAssociadoDeTrabalhador" style="width: 300px;">

				<label for="associacaoDeMoradoresAssociadaDeTrabalhador">Associa√ß√£o de Moradores Associada:</label>
				<input type="text" id="associacaoDeMoradoresAssociadaDeTrabalhador" style="width: 300px;">

				<label for="hoursAtElectronicPoint">Horas no Ponto Eletr√¥nico (h no m√™s):</label>
				<input type="number" id="hoursAtElectronicPoint" style="width: 150px;">

				<label for="partipacaoIndividualEstimadaNoTrabalhoSocial">
					Participa√ß√£o Individual no Trabalho Social (%10^11):
				</label>
				<input type="number" id="partipacaoIndividualEstimadaNoTrabalhoSocial" style="width: 150px;" readOnly>
			</div>
		</div>
	</div>
	</div>

	<div id="pedidosDeRetirada" class="input-section">
		<h2>Pedidos de Retirada</h2>
		<table id="estoqueDemandaTable">
			<thead>
				<tr>
					<th>Bem de Consumo ou Servi√ßo</th>
					<th>Demanda (dividir por mil quando salvar e multiplicar por mil ao carregar na tela)</th>
				</tr>
			</thead>
			<tbody>
				<!-- Linhas preenchidas dinamicamente -->
			</tbody>
		</table>
	</div>
	
	
	</div>

		<script>
		
			let userIsLoggedIn = false;
			let user = null;
			let primeiroConselheiroDoConselho = true;
			// Vari√°veis globais para armazenar os dados antigos
			let previousTableData = [];
			let previousProductNames = [];
			let previousSectorNames = [];
			let previousDemandValues = [];
			let propostaDados = {};
			let councilData = null;
			let modalContext = null;
			let conselhoMundialKey = "Conselho Popular Intercontinental da Terra";
			let totalSocialWork = 0;
			let totalSocialWorkDessaJurisdicao = 0;
			let effectivelyPlannedProductionTime = 0;
			
		
			const productNames = [
				"Autom√≥veis", "Computadores", "Celulares", "Geladeiras", "Televisores",
				"Roupas de algod√£o", "Embalagens pl√°sticas", "M√≥veis de madeira", "A√ßo",
				"Vidro", "Produtos de limpeza", "Tintas", "Cosm√©ticos", "Borracha",
				"Medicamentos", "Papel", "Embalagens de alum√≠nio", "Fertilizantes",
				"Pe√ßas automotivas", "Componentes eletr√¥nicos"
			];

			const inputNames = [
				"A√ßo", "Pl√°stico", "Alum√≠nio", "Madeira", "Vidro", "Algod√£o", "Borracha",
				"Produtos qu√≠micos", "Cobre", "Tinta", "Pol√≠meros", "Petr√≥leo", "S√≠lica",
				"Borracha sint√©tica", "L√≠tio", "Carbonato de c√°lcio", "Petr√≥leo refinado",
				"Bioetanol", "Min√©rio de ferro", "Celulose"
			];

			const predefinedValues = [
				[0.2, 0.1, 0.05, 0.02, 0.05, 0.1, 0.02, 0.1, 0.08, 0.1, 0.02, 0.05, 0.02, 0.08, 0.05, 0.04, 0.02, 0.02, 0.05, 0.05],
				[0.05, 0.2, 0.08, 0.1, 0.03, 0.05, 0.1, 0.02, 0.07, 0.05, 0.1, 0.03, 0.05, 0.08, 0.1, 0.02, 0.04, 0.02, 0.07, 0.04],
				[0.03, 0.1, 0.2, 0.02, 0.08, 0.07, 0.02, 0.05, 0.1, 0.05, 0.04, 0.02, 0.07, 0.1, 0.02, 0.08, 0.05, 0.05, 0.02, 0.08],
				[0.08, 0.05, 0.02, 0.2, 0.05, 0.1, 0.05, 0.07, 0.02, 0.1, 0.08, 0.03, 0.02, 0.05, 0.04, 0.1, 0.05, 0.1, 0.02, 0.07],
				[0.1, 0.02, 0.05, 0.03, 0.2, 0.05, 0.1, 0.02, 0.07, 0.05, 0.1, 0.04, 0.05, 0.03, 0.1, 0.08, 0.05, 0.1, 0.07, 0.02],
				[0.05, 0.1, 0.02, 0.08, 0.03, 0.2, 0.07, 0.05, 0.1, 0.04, 0.05, 0.1, 0.02, 0.1, 0.05, 0.08, 0.05, 0.03, 0.1, 0.04],
				[0.07, 0.02, 0.05, 0.1, 0.05, 0.1, 0.2, 0.03, 0.02, 0.07, 0.08, 0.05, 0.1, 0.02, 0.05, 0.07, 0.1, 0.04, 0.08, 0.05],
				[0.02, 0.05, 0.1, 0.05, 0.07, 0.03, 0.1, 0.2, 0.08, 0.05, 0.03, 0.08, 0.02, 0.1, 0.05, 0.1, 0.07, 0.05, 0.02, 0.04],
				[0.05, 0.1, 0.02, 0.1, 0.04, 0.05, 0.07, 0.05, 0.2, 0.08, 0.1, 0.02, 0.05, 0.1, 0.05, 0.04, 0.08, 0.07, 0.02, 0.1],
				[0.1, 0.05, 0.07, 0.05, 0.08, 0.1, 0.03, 0.1, 0.05, 0.2, 0.05, 0.07, 0.04, 0.1, 0.03, 0.05, 0.1, 0.04, 0.07, 0.08],
				[0.02, 0.07, 0.05, 0.04, 0.1, 0.08, 0.05, 0.1, 0.1, 0.03, 0.2, 0.02, 0.07, 0.05, 0.1, 0.04, 0.08, 0.05, 0.1, 0.02],
				[0.05, 0.1, 0.08, 0.02, 0.04, 0.05, 0.1, 0.03, 0.1, 0.07, 0.02, 0.2, 0.08, 0.05, 0.04, 0.05, 0.1, 0.1, 0.03, 0.07],
				[0.03, 0.05, 0.1, 0.08, 0.1, 0.02, 0.07, 0.05, 0.05, 0.04, 0.1, 0.07, 0.2, 0.02, 0.05, 0.05, 0.08, 0.1, 0.04, 0.05],
				[0.1, 0.05, 0.03, 0.07, 0.05, 0.1, 0.02, 0.05, 0.1, 0.05, 0.1, 0.08, 0.04, 0.2, 0.07, 0.02, 0.05, 0.05, 0.1, 0.03],
				[0.05, 0.1, 0.02, 0.05, 0.08, 0.1, 0.07, 0.1, 0.03, 0.1, 0.05, 0.04, 0.05, 0.08, 0.2, 0.05, 0.1, 0.03, 0.07, 0.02],
				[0.04, 0.05, 0.1, 0.05, 0.02, 0.07, 0.08, 0.1, 0.05, 0.04, 0.08, 0.1, 0.03, 0.05, 0.07, 0.2, 0.1, 0.02, 0.05, 0.05],
				[0.05, 0.08, 0.02, 0.1, 0.07, 0.04, 0.05, 0.03, 0.05, 0.07, 0.1, 0.1, 0.02, 0.1, 0.04, 0.05, 0.2, 0.1, 0.07, 0.03],
				[0.03, 0.07, 0.05, 0.05, 0.1, 0.02, 0.1, 0.04, 0.08, 0.1, 0.05, 0.1, 0.02, 0.07, 0.05, 0.08, 0.03, 0.2, 0.05, 0.1],
				[0.07, 0.05, 0.04, 0.1, 0.05, 0.02, 0.08, 0.05, 0.1, 0.1, 0.03, 0.05, 0.05, 0.04, 0.1, 0.07, 0.02, 0.05, 0.2, 0.08],
				[0.05, 0.03, 0.1, 0.04, 0.07, 0.05, 0.08, 0.1, 0.02, 0.05, 0.1, 0.05, 0.07, 0.08, 0.02, 0.1, 0.03, 0.07, 0.08, 0.2]
			];
		
			let currentProductIndex = null;
			let optimizationInputs = {};  // Objeto para armazenar os dados de entrada de otimiza√ß√£o de cada produto
			let optimizationResults = {};

			let optimizedStatus = {};  // Objeto para armazenar o status de otimiza√ß√£o de cada produto


	// Fun√ß√£o para preencher a tabela com valores iniciais baseados em predefinedValues
	function populateInitialTable() {
		const tbody = document.getElementById('inputTechnologicalMatrixTableBody');
		tbody.innerHTML = ''; // Limpa qualquer conte√∫do existente na tabela

		const initialRows = 3;
		const initialCols = 3;

		// Atualiza o cabe√ßalho da tabela
		const thead = document.getElementById('inputTable').querySelector('thead tr');
		thead.innerHTML = '<th>Produtos / Setores Produtivos</th>';
		for (let colIndex = 0; colIndex < initialCols; colIndex++) {
			const sectorHeader = document.createElement('th');
			const sectorInput = document.createElement('input');
			sectorInput.type = 'text';
			sectorInput.value = `Produ√ß√£o de ${colIndex < initialRows ? productNames[colIndex] : "Outro"}`; 
			sectorInput.readOnly = true; // Define como apenas leitura
			addTooltipBehavior(sectorInput); // Adiciona o comportamento de tooltip
			sectorHeader.appendChild(sectorInput);
			thead.appendChild(sectorHeader);
		}

		// Atualiza as linhas da tabela
		for (let rowIndex = 0; rowIndex < initialRows; rowIndex++) {
			const row = document.createElement('tr');

			// Adicionar o campo de entrada para o nome do produto
			const productNameCell = document.createElement('td');
			const productInput = document.createElement('input');
			productInput.type = 'text';
			productInput.value = productNames[rowIndex];
			productInput.oninput = (e) => updateProductName(rowIndex, e.target.value);
			productNameCell.appendChild(productInput);
			row.appendChild(productNameCell);

			// Adicionar as c√©lulas restantes
			for (let colIndex = 0; colIndex < initialCols; colIndex++) {
				const cell = document.createElement('td');
				const input = document.createElement('input');
				input.type = 'number';
				input.value = predefinedValues[rowIndex][colIndex];
				cell.appendChild(input);
				addHighlightBehavior(cell); // Adiciona o comportamento de destaque
				row.appendChild(cell);
			}

			tbody.appendChild(row);
		}
	}



	// Chama a fun√ß√£o populateInitialTable() ao carregar a p√°gina
	window.onload = function() {
		populateInitialTable(); // Carrega a tabela inicial
		document.getElementById('welcomeModal').style.display = 'flex'; // Exibe o modal de boas-vindas
		togglePlanificationElements();  // Garante que os elementos estejam ocultos no carregamento
		
		try {
			document.getElementById('fetchDataButton').click();
		} catch (error) {
			console.error("Erro ao executar 'Receber Dados':", error);
		}
		
		showNotification("Ol√°! Se for Conselheiro voc√™ pode fazer login.", true);
		
		initSmallGlobe();
		
	}

	// Fun√ß√£o para fechar o modal
	function closeWelcomeModal() {
		const modal = document.getElementById('welcomeModal');
		modal.style.display = 'none';
	}


			document.addEventListener('keydown', (event) => {
				if (event.key === 'Escape') {
					
					 closeAllModals();
					
				}
				
				if (event.ctrlKey && event.key === 'Enter') {
					event.preventDefault(); // Impede a√ß√µes padr√£o, se houver
					planify(); // Chama a fun√ß√£o de planifica√ß√£o
				}
				
				 if (event.ctrlKey) {
					// Filtra apenas as combina√ß√µes espec√≠ficas configuradas no programa
					if (event.key === 'd' || event.key === 'D') {
						event.preventDefault(); // Impede a a√ß√£o padr√£o apenas para CTRL+S
						const downloadButton = document.getElementById('downloadDataButton');
						if (downloadButton) {
							downloadButton.click();
						}
					} else if (event.key === 'o' || event.key === 'O') {
						event.preventDefault(); // Impede a a√ß√£o padr√£o apenas para CTRL+O
						const uploadButton = document.getElementById('uploadDataButton');
						if (uploadButton) {
							uploadButton.click();
						}
					} else if (event.key === 's' || event.key === 'S') {
						event.preventDefault(); // Impede o comportamento padr√£o do navegador (salvar p√°gina)
						
						if (userIsLoggedIn) { // Verifica se o usu√°rio est√° logado
							const sendButton = document.getElementById('sendDataButton');
							if (sendButton) {
								sendButton.click(); // Simula o clique no bot√£o "Enviar Dados"
							}
						} else {
							showNotification("Voc√™ precisa estar logado para poder salvar suas altera√ß√µes", false);
						}
					} else if (event.key === 'Backspace') {
						event.preventDefault(); // Evita a a√ß√£o padr√£o do navegador
						confirmClearTable(); // Chama a fun√ß√£o de confirma√ß√£o antes de limpar
					} else if (event.ctrlKey && (event.key === 'e' || event.key === 'E')) {
						if (userIsLoggedIn) { // Verifica se o usu√°rio est√° logado
							event.preventDefault(); // Impede o comportamento padr√£o
							logout(); // Simula o clique no bot√£o "Sair"
						}
						// Se o usu√°rio n√£o estiver logado, o comportamento padr√£o √© mantido
					} else if (event.ctrlKey && (event.key === 'l' || event.key === 'L')) {
						event.preventDefault(); // Previne o comportamento padr√£o
						if (!userIsLoggedIn) { // Verifica se o usu√°rio n√£o est√° logado
							showLoginSection();
						}
					}
		
				}
			});

	function saveOptimizationInputs() {
		const workerLimit = parseFloat(document.getElementById('workerLimit').value);
		const workerHours = parseFloat(document.getElementById('workerHours').value);
		const productionTime = parseFloat(document.getElementById('productionTime').value);
		const nightShift = document.getElementById('nightShift').checked;
		const weeklyScale = parseInt(document.getElementById('weeklyScale').value);

		// Verifica√ß√£o dos campos obrigat√≥rios
		if (
			isNaN(workerLimit) ||
			isNaN(workerHours) ||
			isNaN(productionTime) ||
			isNaN(weeklyScale) ||
			weeklyScale < 1 ||
			weeklyScale > 7
		) {
			showNotification("Por favor, preencha todos os campos corretamente. A escala semanal deve estar entre 1 e 7 dias.", false);
			return;
		}

		// Limitar a carga hor√°ria di√°ria a no m√°ximo 12 horas
		if (workerHours > 12) {
			showNotification("A carga hor√°ria di√°ria n√£o pode ser maior do que 12 horas.", false);
			return;
		}

		// Salva os dados no objeto de otimiza√ß√£o
		if (!optimizationInputs[currentProductIndex]) {
			optimizationInputs[currentProductIndex] = {}; // Inicializa se n√£o existir
		}

		optimizationInputs[currentProductIndex] = {
			workerLimit,
			workerHours,
			productionTime,
			nightShift,
			weeklyScale
		};

	// Atualiza os bot√µes de otimiza√ß√£o
		updateOptimizeButtonColor(currentProductIndex);
		closeOptimizationModal();	

		optimizedStatus[currentProductIndex] = true; // Marca o produto como otimizado
		updateOptimizeButtonColor(currentProductIndex); // Atualiza a cor do bot√£o

		closeOptimizationModal(); // Fecha o modal ap√≥s salvar

		// Verifica se a tabela de "Planifica√ß√£o Otimizada" est√° vis√≠vel e executa a fun√ß√£o "planify" automaticamente
		//const resultDiv = document.getElementById('result');
		//if (resultDiv && resultDiv.innerHTML.trim() !== '') {
		//	planify();
		//}
		
		
		
	}


	// Atualiza a fun√ß√£o closeOptimizationModal para remover o ouvinte de eventos ao fechar o modal
	function closeOptimizationModal() {
		document.getElementById('optimizationModal').style.display = 'none';
		document.removeEventListener('keydown', handleEnterPress); // Remove o ouvinte ao fechar o modal
	}

	// Fun√ß√£o para redimensionar a tabela e preservar dados antigos
	function resizeTable() {
		const numRows = parseInt(document.getElementById('numRows').value);
		const numCols = parseInt(document.getElementById('numCols').value);

		const table = document.getElementById('inputTable');
		const tbody = table.querySelector('tbody');
		const thead = table.querySelector('thead');

		// Armazenar os dados antigos antes do redimensionamento
		storePreviousTableData();
		storePreviousDemandValues();

		// Atualiza o cabe√ßalho da tabela com os nomes dos setores produtivos
		thead.innerHTML = '<tr><th>Produtos / Setor Produtivo</th></tr>';
		for (let j = 0; j < numCols; j++) {
			const sectorHeader = document.createElement('th');
			const sectorInput = document.createElement('input');
			sectorInput.type = 'text';
			sectorInput.value = previousSectorNames[j] || `Produ√ß√£o de ${inputNames[j % inputNames.length]}`;
			sectorInput.readOnly = true;
			addTooltipBehavior(sectorInput); // Adiciona o comportamento de tooltip
			sectorHeader.appendChild(sectorInput);
			thead.querySelector('tr').appendChild(sectorHeader);
		}

		// Redimensiona o corpo da tabela preservando os dados antigos
		tbody.innerHTML = '';
		for (let i = 0; i < numRows; i++) {
			const row = document.createElement('tr');

			// Nome do produto
			const productNameCell = document.createElement('td');
			const productInput = document.createElement('input');
			productInput.type = 'text';
			productInput.value = previousProductNames[i] || `Produto ${i + 1}`;
			//productInput.onchange = () => syncProductName(i, productInput.value);  // Sincroniza nome de produto
			productInput.oninput = () => updateProductName(i, productInput.value);
			productNameCell.appendChild(productInput);
			row.appendChild(productNameCell);

			for (let j = 0; j < numCols; j++) {
				const cell = document.createElement('td');
				const input = document.createElement('input');
				input.type = 'number';

				// Preenche com o valor antigo ou usa um valor padr√£o
				input.value = (previousTableData[i] && previousTableData[i][j] !== undefined)
					? previousTableData[i][j]
					: predefinedValues[i % predefinedValues.length][j % predefinedValues[0].length];

				input.onchange = storePreviousTableData;
				cell.appendChild(input);
				addHighlightBehavior(cell); // Adiciona o comportamento de destaque
				row.appendChild(cell);
			}

			tbody.appendChild(row);
		}

		// Atualiza a se√ß√£o de demanda final com os nomes dos produtos e valores de demanda preservados
		updateFinalDemand(numRows);

		// Se preenchimento autom√°tico estiver habilitado, preenche automaticamente novos campos
		if (document.getElementById('autoFillCheckbox').checked) {
			autoFillTable();
		}

		// Atualiza os dados antigos
		storePreviousTableData();
	}



	// Fun√ß√£o para armazenar os dados antigos da tabela, incluindo nomes dos produtos e setores
	function storePreviousTableData() {
		const tbody = document.getElementById('inputTable').querySelector('tbody');
		const thead = document.getElementById('inputTable').querySelector('thead');

		previousTableData = [];
		previousProductNames = [];
		previousSectorNames = [];
		previousDemandValues = []; // Armazenar os valores de demanda

		// Armazena os nomes dos setores
		const sectorHeaders = thead.querySelectorAll('th input');
		sectorHeaders.forEach((input, index) => {
			//if (index > 0) previousSectorNames[index - 1] = input.value;
			if (index >= 0) previousSectorNames[index] = input.value;
		});

		// Armazena os dados da tabela e os nomes dos produtos
		tbody.querySelectorAll('tr').forEach((row, index) => {
			const rowData = [];
			const productInput = row.querySelector('td:first-child input');
			previousProductNames[index] = productInput.value;

			row.querySelectorAll('td:not(:first-child) input').forEach((input) => {
				rowData.push(input.value || 0);
			});
			previousTableData.push(rowData);
		});

		// Armazena os valores de demanda atuais
		const demandInputs = document.querySelectorAll('#finalDemandInputs input[type="number"]');
		demandInputs.forEach(input => previousDemandValues.push(input.value || 0));
	}

	// Fun√ß√£o para armazenar os valores antigos da demanda final
	function storePreviousDemandValues() {
		const demandInputs = document.querySelectorAll('#finalDemandInputs input[type="number"]');
		previousDemandValues = Array.from(demandInputs).map(input => input.value || 0);
	}

	// Fun√ß√£o para atualizar a tabela de demanda final
	function updateFinalDemand(numRows) {
		const demandContainer = document.getElementById('finalDemandInputs');
		demandContainer.innerHTML = '';

		for (let i = 0; i < numRows; i++) {
			const demandRow = document.createElement('tr');

			// Nome do produto sincronizado com a tabela
			const productNameCell = document.createElement('td');
			productNameCell.textContent = previousProductNames[i] || `Produto ${i + 1}`;
			demandRow.appendChild(productNameCell);

			// Entrada de demanda (preserva valor existente ou padr√£o)
			const demandInputCell = document.createElement('td');
			const demandInput = document.createElement('input');
			demandInput.type = 'number';
			demandInput.id = `demand${i}`;
			demandInput.value = previousDemandValues[i] || (i === 0 ? 1 : 0);
			demandInputCell.appendChild(demandInput);
			demandRow.appendChild(demandInputCell);

			// Bot√£o de otimiza√ß√£o
			const buttonCell = document.createElement('td');
			const button = document.createElement('button');
			button.textContent = 'Otimizar';
			button.onclick = () => openOptimizationModal(i);
			buttonCell.appendChild(button);
			demandRow.appendChild(buttonCell);

			demandContainer.appendChild(demandRow);

			// Atualizar a cor do bot√£o com base no status de otimiza√ß√£o
			updateOptimizeButtonColor(i);
		}
	}

	// Fun√ß√£o para atualizar a tabela de demanda final
	function updateFinalDemand(numRows) {
		const demandContainer = document.getElementById('finalDemandInputs');
		demandContainer.innerHTML = '';

		for (let i = 0; i < numRows; i++) {
			const demandRow = document.createElement('tr');

			// Nome do produto sincronizado com a tabela
			const productNameCell = document.createElement('td');
			productNameCell.textContent = previousProductNames[i] || `Produto ${i + 1}`;
			demandRow.appendChild(productNameCell);

			// Entrada de demanda (preserva valor existente ou padr√£o)
			const demandInputCell = document.createElement('td');
			const demandInput = document.createElement('input');
			demandInput.type = 'number';
			demandInput.id = `demand${i}`;
			demandInput.value = previousDemandValues[i] !== undefined ? previousDemandValues[i] : (i === 0 ? 1 : 0);
			demandInputCell.appendChild(demandInput);
			demandRow.appendChild(demandInputCell);

			// Bot√£o de otimiza√ß√£o
			const buttonCell = document.createElement('td');
			const button = document.createElement('button');
			button.textContent = 'Otimizar';
			button.onclick = () => openOptimizationModal(i);
			buttonCell.appendChild(button);
			demandRow.appendChild(buttonCell);

			demandContainer.appendChild(demandRow);

			// Atualizar a cor do bot√£o com base no status de otimiza√ß√£o
			updateOptimizeButtonColor(i);
		}
	}

	// Fun√ß√£o para atualizar os dados antigos da tabela
	function updatePreviousTableData() {
		const tbody = document.getElementById('inputTable').querySelector('tbody');
		previousTableData = [];
		tbody.querySelectorAll('tr').forEach((row) => {
			const rowData = [];
			row.querySelectorAll('input[type="number"]').forEach((input) => {
				rowData.push(input.value || 0);
			});
			previousTableData.push(rowData);
		});
	}



	function performOptimization(productIndex) {
		const inputs = optimizationInputs[productIndex];
		if (!inputs) return;

		const { productionGoal, workerLimit, workerHours, productionTime, weeklyScale, nightShift } = inputs;

		if (!workerLimit || workerLimit <= 0) {
			const productName = getProductNames()[productIndex];
			//showNotification(`O limite de trabalhadores por f√°brica n√£o foi configurado corretamente para a produ√ß√£o de ${productName}.`);
			return;
		}

		// C√°lculo total de horas necess√°rias para produzir a quantidade desejada
		const totalHours = productionTime * productionGoal;

		// Capacidade semanal por trabalhador (em horas)
		const weeklyWorkHoursPerWorker = weeklyScale * workerHours;

		// C√°lculo do n√∫mero de trabalhadores necess√°rios
		const workersNeeded = Math.ceil(totalHours / weeklyWorkHoursPerWorker);

		// Capacidade total de trabalho por turno (independente de ser diurno ou noturno)
		const shiftWorkHours = workerLimit * workerHours;

		// Total de turnos necess√°rios
		const totalShifts = Math.ceil(totalHours / shiftWorkHours);

		// Capacidade di√°ria considerando escala semanal e turno noturno
		const dailyWorkHours = nightShift ? shiftWorkHours * 2 : shiftWorkHours;
		const totalDailyWorkHours = dailyWorkHours * weeklyScale / 7;

		// Prazo m√≠nimo de produ√ß√£o em dias
		const minimumProductionTime = Math.ceil(totalHours / totalDailyWorkHours);

		// Per√≠odo total de trabalho (em semanas e dias restantes)
		const totalWorkDays = Math.ceil(totalHours / dailyWorkHours);
		const totalWeeks = Math.floor(totalWorkDays / weeklyScale);
		const remainingDays = totalWorkDays % weeklyScale;

		// C√°lculo das horas de opera√ß√£o por dia
		const factoryOperationHours = nightShift ? 24 : 12;

		// Convers√£o do prazo m√≠nimo de produ√ß√£o para dias
		const minimumProductionTimeInDays = minimumProductionTime / 24; // Considera 1 dia = 24 horas

		// Nova f√≥rmula para calcular o n√∫mero de f√°bricas necess√°rias
		const factoriesNeeded = Math.ceil(totalHours / (factoryOperationHours * workerLimit * minimumProductionTimeInDays));



		// C√°lculo da quantidade de f√°bricas
		//const factoriesNeeded = Math.ceil(totalHours / shiftWorkHours);

		// Formata√ß√£o do per√≠odo total de emprego
		let totalEmploymentPeriod;
		if (totalWorkDays < weeklyScale) {
			totalEmploymentPeriod = `${totalWorkDays} dias`;
		} else {
			totalEmploymentPeriod = formatDays(totalWorkDays * 24); // Converte dias em horas para formatDays
		}

		const table = document.querySelector('#result table'); // Seleciona a tabela "Planifica√ß√£o Otimizada"
		const row = table?.rows[productIndex + 1]; // Seleciona a linha correspondente ao √≠ndice (ajusta para ignorar cabe√ßalho)
		const plannedFinalDemand = row ? parseFloat(row.cells[1].textContent.trim())*1000 : 0; // Acessa a c√©lula da coluna correspondente e converte o valor

		// Armazenamento dos resultados para exibi√ß√£o
		optimizationResults[productIndex] = {
			totalHours,
			workersNeeded,
			factoriesNeeded, // Adiciona o c√°lculo das f√°bricas
			totalShifts,
			minimumProductionTime,
			totalEmploymentPeriod,
			weeklyScale,
			plannedFinalDemand
		};
	}

	let isPlanified = false; // Vari√°vel para controlar se a planifica√ß√£o foi feita

	function planify() {
		const resultDiv = document.getElementById('result');
		resultDiv.innerHTML = "";

		try {
			const techMatrix = makeSquareMatrix(getTableData());
			const adjustedDemand = adjustDemandVector(getFinalDemand(), techMatrix.length);
			const identityMatrix = math.identity(techMatrix.length)._data;
			const iMinusA = math.subtract(identityMatrix, techMatrix);
			const inverseIMinusA = math.inv(iMinusA);
			const productionVector = math.multiply(inverseIMinusA, adjustedDemand);

			const productNames = getProductNames();
			resultDiv.innerHTML = `
				<table>
					<thead>
						<tr>
							<th>Produto</th>
							<th>Produ√ß√£o Necess√°ria para Atender a Demanda Final (mil)</th>
							<th>A√ß√µes</th>
						</tr>
					</thead>
					<tbody>
						${productionVector.map((val, i) => {
							const hasOptimization = isOptimizationDataComplete(i); // Valida√ß√£o aqui
							return `
								<tr>
									<td>${productNames[i]}</td>
									<td>${val.toFixed(2)}</td>
									<td>
										${hasOptimization ? 
										`<button onclick="openOptimizationResultModal(${i})">Otimiza√ß√£o</button>` : 
										`<button disabled>Otimiza√ß√£o N√£o Dispon√≠vel</button>`}
									</td>
								</tr>
							`;
						}).join('')}
					</tbody>
				</table>
			`;

			// Define a meta de produ√ß√£o e executa a otimiza√ß√£o para cada produto com dados completos
			productionVector.forEach((value, index) => {
				if (isOptimizationDataComplete(index)) {
					optimizationInputs[index].productionGoal = value * 1000; // Define a meta
					performOptimization(index); // Executa a otimiza√ß√£o
					updateOptimizeButtonColor(index); // Atualiza o bot√£o ap√≥s a otimiza√ß√£o
				}
			});

			// Formata√ß√£o da matriz e vetor para exibi√ß√£o
			const formattedMatrix = JSON.stringify(techMatrix, null, 2);
			const formattedVector = JSON.stringify(adjustedDemand, null, 2);

			// Preenche os elementos na modal
			document.getElementById('matrixModalOutput').textContent = formattedMatrix;
			document.getElementById('vectorModalOutput').textContent = formattedVector;

			// Marca que a planifica√ß√£o foi feita e exibe o t√≠tulo e o bot√£o
			isPlanified = true;
			togglePlanificationElements();

			// Rolagem suave para o t√≠tulo "Planifica√ß√£o Otimizada"
			const planificationTitle = document.getElementById('planificationTitle'); // Seleciona o t√≠tulo "Planifica√ß√£o Otimizada"
			const infobar = document.getElementById('infoBar'); // Seleciona a infobar

			if (planificationTitle) {
				const infobarHeight = infobar ? infobar.offsetHeight : 0; // Calcula a altura da infobar
				const planificationTitlePosition = planificationTitle.getBoundingClientRect().top + window.scrollY; // Posi√ß√£o do t√≠tulo na p√°gina
				const targetPosition = planificationTitlePosition - infobarHeight; // Compensa a altura da infobar

				// Rola suavemente para a posi√ß√£o ajustada
				window.scrollTo({
					top: targetPosition,
					behavior: 'smooth',
				});
			}


		} catch (error) {
			resultDiv.innerHTML = `<p class="error-message">Erro: ${error.message}</p>`;
		}
	}


	function togglePlanificationElements() {
		const planificationTitle = document.getElementById('planificationTitle');
		const copyableButton = document.getElementById('openCopyableDataModal');
		const downloadButton = document.getElementById('downloadDataButton');

		if (isPlanified) {
			planificationTitle.style.display = 'block';  // Exibe o t√≠tulo
			copyableButton.style.display = 'block';      // Exibe o bot√£o "Dados copi√°veis"
			downloadButton.style.display = 'block';      // Exibe o bot√£o "Baixar Dados"
		} else {
			planificationTitle.style.display = 'none';   // Oculta o t√≠tulo
			copyableButton.style.display = 'none';       // Oculta o bot√£o "Dados copi√°veis"
			downloadButton.style.display = 'none';       // Oculta o bot√£o "Baixar Dados"
		}
	}


	// Fun√ß√£o para fechar modais ao clicar fora do conte√∫do
	function closeCopyableDataModal() {
		const modal = document.getElementById('copyableDataModal');
		modal.style.display = 'none'; // Fecha a modal
	}

	// Fun√ß√£o para fechar a modal de otimiza√ß√£o
	function closeOptimizationModal() {
		document.getElementById('optimizationModal').style.display = 'none';
	}

	// Exibe os resultados da otimiza√ß√£o no modal de resultados
		function openOptimizationResultModal(index) {
		const result = optimizationResults[index];
		const inputs = optimizationInputs[index];
		if (!result || !inputs) return;

		const productName = getProductNames()[index];
		const workerHours = inputs.workerHours; // Carga hor√°ria di√°ria configurada
		const totalHours = result.totalHours; // Total de horas de trabalho
		const workersNeeded = result.workersNeeded; // Trabalhadores necess√°rios
		const totalShifts = result.totalShifts; // Total de turnos de trabalho
		const minimumProductionTime = result.minimumProductionTime; // Prazo m√≠nimo de produ√ß√£o
		const totalEmploymentPeriod = result.totalEmploymentPeriod; // Per√≠odo total em que estar√£o empregados
		const workShift = inputs.nightShift ? "Diurno e Noturno" : "Diurno"; // Verifica o tipo de turno
		const weeklyScale = result.weeklyScale; // Escala semanal
		const factoriesNeeded = result.factoriesNeeded;

		const daysOff = 7 - weeklyScale; // Dias de folga na semana
		const formattedWeeklyScale = `${weeklyScale}X${daysOff}`; // Formata como solicitado

		document.getElementById('optimizationResult').innerHTML = `
			<p><strong>Produto:</strong> ${productName}</p>
			<p><strong>Carga Hor√°ria Total:</strong> ${totalHours.toFixed(2)} horas</p>
			<p><strong>F√°bricas Necess√°rias:</strong> ${factoriesNeeded}</p>
			<p><strong>Prazo M√≠nimo de Produ√ß√£o:</strong> ${formatDays(minimumProductionTime * 24)}</p>
			<p><strong>Turno:</strong> ${workShift}</p>
			<p><strong>Trabalhadores Necess√°rios:</strong> ${workersNeeded}</p>
			<p><strong>Total de Turnos:</strong> ${totalShifts}</p>
			<p><strong>Expediente do Trabalhador:</strong> ${workerHours}h por dia</p>
			<p><strong>Escala de Trabalho:</strong> ${formattedWeeklyScale}</p>
			<p><strong>Per√≠odo Total de Emprego:</strong> ${totalEmploymentPeriod}</p>
		`;


		const modal = document.getElementById('optimizationResultModal');
		modal.style.display = 'flex';
	}

	// Fun√ß√£o para fechar a modal de resultados de otimiza√ß√£o
	function closeOptimizationResultModal() {
		document.getElementById('optimizationResultModal').style.display = 'none';
	}

			function closeOptimizationModal() {
				document.getElementById('optimizationModal').style.display = 'none';
			}

			

			function updateOptimizeButtonColor(productIndex) {
				const button = document.querySelector(`#finalDemandInputs tr:nth-child(${productIndex + 1}) button`);
				const inputs = optimizationInputs[productIndex];

				// Verifica se todos os campos obrigat√≥rios est√£o preenchidos
				const isComplete = inputs && 
					inputs.workerLimit > 0 && 
					inputs.workerHours > 0 &&
					inputs.productionTime > 0 &&
					inputs.weeklyScale > 0;

				if (isComplete) {
					button.style.backgroundColor = 'green'; // Dados completos, bot√£o fica verde
				} else {
					button.style.backgroundColor = '';     // Reseta a cor do bot√£o
				}
			}

		   function openOptimizationModal(productIndex) {
			   
		currentProductIndex = productIndex;

		// Inicializa os dados de otimiza√ß√£o para o produto, se necess√°rio
		if (!optimizationInputs[productIndex]) {
			optimizationInputs[productIndex] = {};
		}
		const inputs = optimizationInputs[productIndex] || {}; // Obt√©m ou inicializa os dados

		// Define o nome do produto no modal
		const productNames = getProductNames();
		document.getElementById('productName').textContent = productNames[productIndex];

		// Preenche os campos do modal com valores salvos ou padr√£o
		document.getElementById('workerLimit').value = inputs.workerLimit || '';
		document.getElementById('workerHours').value = inputs.workerHours || '';
		document.getElementById('productionTime').value = inputs.productionTime || '';
		document.getElementById('nightShift').checked = inputs.nightShift || false;
		document.getElementById('weeklyScale').value = inputs.weeklyScale || '';

		// Exibe o modal de otimiza√ß√£o
		const modal = document.getElementById('optimizationModal');
		modal.style.display = 'flex';

		// Posiciona o cursor automaticamente no campo "Limite de Trabalhadores nas F√°bricas"
		document.getElementById('workerLimit').focus();

		// Adiciona o ouvinte de eventos para capturar Enter
		document.addEventListener('keydown', handleEnterPress);
	}






	// Fun√ß√£o para acionar "Salvar" ao pressionar Enter
	function handleEnterPress(event) {
		if (event.key === 'Enter') {
			event.preventDefault(); // Impede o comportamento padr√£o do Enter
			saveOptimizationInputs();
			document.removeEventListener('keydown', handleEnterPress); // Remove o ouvinte ap√≥s salvar
		}
	}


	function handleEnter(event) {
		if (event.key === "Enter") {
			event.preventDefault(); // Impede o comportamento padr√£o do Enter
			resizeTable(); // Chama a fun√ß√£o para redimensionar a tabela
		}
	}


			function closeOptimizationModal() {
				const modal = document.getElementById('optimizationModal');
				modal.style.display = 'none';
				document.removeEventListener('keydown', handleEnterPress); // Remove o ouvinte ao fechar
			}



			function toggleAutoFill() {
				if (document.getElementById('autoFillCheckbox').checked) {
					autoFillTable();
				} else {
					clearTable();
				}
			}

			function autoFillTable() {
				const rows = document.getElementById('inputTable').querySelectorAll('tbody tr');
				const productNames = ["Autom√≥veis", "Computadores", "Celulares", "Geladeiras", "Televisores"];

				rows.forEach((row, i) => {
					row.cells[0].querySelector('input[type="text"]').value = productNames[i % productNames.length];
					let rowValues = [];
					let sum = 0;

					for (let j = 1; j < row.cells.length; j++) {
						let value = i === j ? (Math.random() * 0.05).toFixed(2) : (Math.random() * 0.1).toFixed(2);
						rowValues.push(parseFloat(value));
						sum += parseFloat(value);
					}

					if (sum >= 1) {
						rowValues = rowValues.map(value => (value / sum * 0.9).toFixed(2));
					}

					rowValues.forEach((value, j) => {
						row.cells[j + 1].querySelector('input[type="number"]').value = value;
					});
				});
			}

			function getTableData() {
				const tbody = document.querySelector('#inputTable tbody');
				const rows = tbody.querySelectorAll('tr');

				return Array.from(rows).map(row => {
					const cells = row.querySelectorAll('td:not(:first-child) input[type="number"]');
					return Array.from(cells).map(input => parseFloat(input.value) || 0);
				});
			}
			

			function getProductNames() {
				const rows = document.querySelectorAll('#inputTable tbody tr');
				return Array.from(rows).map(row => row.querySelector('td:first-child input').value);
			}

			function setProductNames(productNames) {
				const rows = document.querySelectorAll('#inputTable tbody tr');
				rows.forEach((row, index) => {
					const input = row.querySelector('td:first-child input');
					if (input && productNames[index]) {
						input.value = productNames[index];
					}
				});
			}

			function setSectorNames(sectorNames) {
				const headers = document.querySelectorAll('#inputTable thead tr th');
				headers.forEach((header, index) => {
					if (index > 0 && sectorNames[index - 1]) { // Pula a primeira coluna ("Produtos")
						const input = header.querySelector('input');
						if (input) {
							input.value = sectorNames[index - 1]; // Define o t√≠tulo correto do setor
						}
					}
				});
			}
			
			function getSectorNames() {
				const headers = document.querySelectorAll('#inputTable thead tr th');
				return Array.from(headers)
					.slice(1) // Ignora a primeira coluna (nomes dos produtos)
					.map(header => {
						const input = header.querySelector('input');
						return input ? input.value : `Setor ${Array.from(headers).indexOf(header)}`;
					});
			}


			function getFinalDemand() {
				const tbody = document.querySelector('#finalDemandInputs');
				const inputs = tbody.querySelectorAll('input[type="number"]');
				return Array.from(inputs).map(input => parseFloat(input.value) || 0);
			}


			function makeSquareMatrix(matrix) {
				const size = Math.max(matrix.length, matrix[0].length);
				return Array.from({ length: size }, (_, i) =>
					Array.from({ length: size }, (_, j) => (matrix[i] && matrix[i][j]) || 0)
				);
			}

			function adjustDemandVector(demand, size) {
				return Array.from({ length: size }, (_, i) => demand[i] || 0);
			}

	function resetEconomy() {
		const confirmation = confirm("Tem certeza de que deseja resetar a economia? Todos os dados ser√£o perdidos e a economia ser√° restaurada para o estado inicial.");
		if (confirmation) {
			location.reload(); // Recarrega a p√°gina, restaurando todos os dados ao estado inicial
		}
	}



	function confirmClearTable() {
		const confirmation = confirm("Tem certeza de que deseja limpar a tabela? Todos os dados ser√£o perdidos.");
		if (confirmation) {
			clearTable(); // Chama a fun√ß√£o de limpeza se confirmado
		}
	}


	function clearTable() {
		const rows = document.getElementById('inputTable').querySelectorAll('tbody tr');
		rows.forEach(row => {
			const cells = row.querySelectorAll('input[type="number"]');
			cells.forEach(cell => cell.value = '0');
		});

		// Limpa os valores de demanda e status de otimiza√ß√£o
		const demandInputs = document.querySelectorAll('#finalDemandInputs input[type="number"]');
		demandInputs.forEach(input => input.value = '0');
		optimizedStatus = {};  // Resetar o status de otimiza√ß√£o

		// Atualiza os bot√µes "Otimizar" para o estado padr√£o
		const optimizeButtons = document.querySelectorAll('#finalDemandInputs button');
		optimizeButtons.forEach(button => button.style.backgroundColor = '');

		// Limpa os valores nas janelas modais de otimiza√ß√£o
		if (document.getElementById('productionGoal')) {
			document.getElementById('productionGoal').value = '';
		}
		document.getElementById('workerLimit').value = '';
		document.getElementById('workerHours').value = '';
		document.getElementById('productionTime').value = '';

		// Limpa os dados de otimiza√ß√£o armazenados para cada produto
		optimizationInputs = {};
		optimizationResults = {};

		// Limpa os resultados de "Planificar"
		document.getElementById('result').innerHTML = '';

		// Oculta o t√≠tulo "Planifica√ß√£o Otimizada" e a tabela
		isPlanified = false; // Marca que a planifica√ß√£o foi resetada
		togglePlanificationElements(); // Atualiza visibilidade

		// Limpa campos adicionais conforme solicitado
		document.getElementById('conselhoPopularAssociadoDeConselhoPopular').value = '';
		document.getElementById('quantidadeBensProducao').value = '';
		document.getElementById('setorUnidade').value = '';
		document.getElementById('comiteColTitle').value = '';
		document.getElementById('limiteEfetivoTrabalhadores').value = '';
		document.getElementById('conselhoPopularAssociadoDeComiteOuTrabalhador').value = '';
		document.getElementById('conselhoPopularAssociadoDeComiteOuTrabalhadorTelaTrabalhador').value = '';
		

		// Limpa todos os campos das colunas "Bens de Produ√ß√£o" e "Quantidade necess√°ria para produzir 1 unidade"
		const vetorTecnologicoInputs = document.querySelectorAll('#vetorTecnologicoTable tbody input');
		vetorTecnologicoInputs.forEach(input => input.value = '');

		// Limpa todos os valores das colunas "Bem de Produ√ß√£o", "Estoque" e "Demanda"
		const estoqueDemandaInputs = document.querySelectorAll('#estoqueDemandaTable tbody input');
		estoqueDemandaInputs.forEach(input => input.value = '');

		// Limpa todos os valores da janela modal "Proposta para demais Trabalhadores"
		document.getElementById('workerLimitProposta').value = '';
		document.getElementById('workerHoursProposta').value = '';
		document.getElementById('productionTimeProposta').value = '';
		document.getElementById('nightShiftProposta').checked = false;
		document.getElementById('weeklyScaleProposta').value = '';

		// Limpa os campos das colunas "Produto", "Quantidade Produzida" e "Quantidade que Falta ser Produzida"
		const producaoMetaInputs = document.querySelectorAll('#producaoMetaTable tbody input');
		producaoMetaInputs.forEach(input => input.value = '');

		// Adicionalmente, limpa as vari√°veis associadas na mem√≥ria
		previousTableData = [];
		previousProductNames = [];
		previousSectorNames = [];
		previousDemandValues = [];
		propostaDados = {};
		totalSocialWorkDessaJurisdicao = 0;
		councilData = null;
		currentProductIndex = null;
		modalContext = null;
		
		//Limpeza de vari√°veis e campos da tela de Trabalhador
		document.getElementById('name').value = '';
		document.getElementById('comiteAssociadoDeTrabalhador').value = '';
		document.getElementById('associacaoDeMoradoresAssociadaDeTrabalhador').value = '';
		document.getElementById('hoursAtElectronicPoint').value = '';
		document.getElementById('partipacaoIndividualEstimadaNoTrabalhoSocial').value = '';
		
	}



	function formatDays(totalHours) {
		const days = Math.floor(totalHours / 24);
		const remainingHours = totalHours % 24; // Calcula as horas restantes que n√£o completam um dia

		const years = Math.floor(days / 365);
		const remainingDaysAfterYears = days % 365;
		const months = Math.floor(remainingDaysAfterYears / 30);
		const remainingDaysAfterMonths = remainingDaysAfterYears % 30;
		const weeks = Math.floor(remainingDaysAfterMonths / 7);
		const remainingDays = remainingDaysAfterMonths % 7;

		const pluralize = (value, singular, plural) => value === 1 ? singular : plural;

		const parts = []; // Lista para armazenar as partes n√£o nulas

		if (years > 0) parts.push(`${years} ${pluralize(years, "ano", "anos")}`);
		if (months > 0) parts.push(`${months} ${pluralize(months, "m√™s", "meses")}`);
		if (weeks > 0) parts.push(`${weeks} ${pluralize(weeks, "semana", "semanas")}`);
		if (remainingDays > 0) parts.push(`${remainingDays} ${pluralize(remainingDays, "dia", "dias")}`);
		if (remainingHours > 0) parts.push(`${remainingHours} ${pluralize(remainingHours, "hora", "horas")}`);

		return parts.join(", ");
	}


	let userLocation = null; // Vari√°vel para armazenar a localiza√ß√£o do usu√°rio
	let userCity = "Localiza√ß√£o n√£o dispon√≠vel"; // Cidade padr√£o para fallback

	// Fun√ß√£o para atualizar o conte√∫do da barra com hora e localiza√ß√£o
	function fetchLocationAndUpdateInfoBar() {
		const infoText = document.getElementById('infoText');
		const now = new Date();
		const locale = 'pt-BR';

		// Formatar a data e hora
		const dia = now.getDate();
		const mes = now.toLocaleString(locale, { month: 'long' });
		const ano = now.getFullYear();
		const horas = now.getHours().toString().padStart(2, '0');
		const minutos = now.getMinutes().toString().padStart(2, '0');
		const segundos = now.getSeconds().toString().padStart(2, '0');

		 // Determinar o t√≠tulo com base no pronome
		let title = '';

		// Atualizar a barra com os dados do conselho e hora local
		if (userIsLoggedIn) {
		
			const username = document.getElementById('username').value;
			const password = document.getElementById('password').value;
			if(null == user){
				user = users.find(u => u.username === username && u.password === password);
			}
		
			if (user.instancePrepositionJurisdictionUUID.includes("WorkerUUID")) {
				//√â trabalhador que n√£o √© conselheiro
				
				if (user.pronoun === 'feminino') {
					title = 'Trabalhadora';
				} else if (user.pronoun === 'masculino') {
					title = 'Trabalhador';
				} else {
					title = 'Trabalhadore';
				}				
				
				infoText.innerHTML = `${title} ${user.name}, ${dia} de ${mes} de ${ano}, ${horas}:${minutos}:${segundos} <button id="logoutButton" onclick="logout()">Sair</button>`;
			}
			else {
				//√â conselheiro
				
				if (user.pronoun === 'feminino') {
					title = 'Conselheira';
				} else if (user.pronoun === 'masculino') {
					title = 'Conselheiro';
				} else {
					title = 'Conselheire';
				}
				
				infoText.innerHTML = `${title} ${user.name}, ${user.instance} ${user.preposition} ${user.jurisdiction}, ${dia} de ${mes} de ${ano}, ${horas}:${minutos}:${segundos} <button id="logoutButton" onclick="logout()">Sair</button>`;
			}
		} else {
			// Caso n√£o tenha dados completos, mostrar apenas o texto com a hora e localiza√ß√£o
			infoText.innerHTML = `<button id="loginButton" onclick="showLoginSection()">Fa√ßa Login</button> ${dia} de ${mes} de ${ano}, ${horas}:${minutos}:${segundos}`;
		}
	}


	// Fun√ß√£o para obter a localiza√ß√£o apenas uma vez
	function getUserLocation() {
		if (!navigator.geolocation) {
			// Caso o navegador n√£o suporte geolocaliza√ß√£o
			userCity = "Geolocaliza√ß√£o n√£o suportada";
			return;
		}

		// Solicitar localiza√ß√£o do navegador apenas uma vez
		navigator.geolocation.getCurrentPosition(
			(position) => {
				const { latitude, longitude } = position.coords;

				// Obter cidade com geocodifica√ß√£o reversa
				fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`)
					.then(response => response.json())
					.then(data => {
						userCity = data.address.city || data.address.town || data.address.village || "Localiza√ß√£o desconhecida";
					})
					.catch(() => {
						userCity = "Localiza√ß√£o n√£o dispon√≠vel";
					});
			},
			() => {
				// Caso o usu√°rio negue a permiss√£o
				userCity = "Permiss√£o negada";
			}
		);
	}

	// Inicializa a localiza√ß√£o (chamada √∫nica)
	getUserLocation();

	// Atualiza a barra continuamente para exibir a hora atualizada
	function updateInfoBar() {
		fetchLocationAndUpdateInfoBar();
	}

	// Inicializa a barra e atualiza a hora
	setInterval(updateInfoBar, 1000);
	updateInfoBar();


	// Fun√ß√µes para abrir e fechar a modal
	function openCopyableDataModal() {
		document.getElementById('copyableDataModal').style.display = 'flex'; // Exibe a modal
	}

	function closeCopyableDataModal() {
		document.getElementById('copyableDataModal').style.display = 'none'; // Fecha a modal
	}

	// Evento no bot√£o para abrir a modal
	document.getElementById('openCopyableDataModal').addEventListener('click', openCopyableDataModal);

	// Fun√ß√£o para embaralhar a lista de not√≠cias
	function shuffleArray(array) {
		for (let i = array.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[array[i], array[j]] = [array[j], array[i]];
		}
		return array;
	}


	function fetchNewsTitles() {
		// Dados est√°ticos simulando as not√≠cias retornadas pela API
		const headlines = [
		"Vale do S√£o Francisco (BA/PE): Produ√ß√£o de 963 mil toneladas de manga e 207,7 mil toneladas de uva de mesa.",
		"Chapada do Apodi (RN): Exporta√ß√£o de quase metade do mel√£o nacional e 12% da melancia.",
		"Regi√£o Sul (PR, SC, RS): 96% da produ√ß√£o de uva industrial do Brasil, com destaque para vinhos e espumantes.",
		"Par√° (Norte): Produ√ß√£o de 1,5 milh√£o de toneladas de a√ßa√≠, representando 94% do total nacional.",
		"Centro-Oeste: Crescimento no cultivo de frutas nativas como guaran√° e castanha-do-Brasil.",
		"Sudeste: Produ√ß√£o de 17,7 milh√µes de toneladas de laranja prevista para 2024.",
		"Sul da Bahia: Projeto de reflorestamento na APA do Pratigi recuperou 140 hectares e revitalizou 100 nascentes.",
		"Mata Atl√¢ntica (RJ): Projeto Onda Verde j√° plantou 2 milh√µes de mudas em 26 anos.",
		"Amaz√¥nia Legal: Reflorestamento de 30 milh√µes de √°rvores nativas em 25 √°reas desmatadas.",
		"Cerrado (GO/MS/MT): 500 hectares restaurados no projeto Emas-Taquari, conectando parques e beneficiando 51 fam√≠lias.",
		"Ind√∫stria Eletroeletr√¥nica (SP): Produ√ß√£o deve crescer 3% em 2024, com aumento de semicondutores e motores el√©tricos.",
		"Campinas (SP): Parques tecnol√≥gicos desenvolvendo novos sensores para agricultura e sa√∫de.",
		"Norte e Nordeste: Crescimento de semicondutores para energia solar e hidrog√™nio verde.",
		"Sul do Brasil: Automa√ß√£o industrial impulsiona moderniza√ß√£o de 60 f√°bricas em 2024.",
		"Regi√£o Centro-Oeste: Projetos de rob√≥tica colaborativa ampliam exporta√ß√£o de equipamentos industriais.",
		"Frente Oeste (RS): Desenvolvimento de infraestrutura digital e turismo inteligente com tecnologia.",
		"Bahia: Uso de tecnologia qu√¢ntica em projetos industriais para solu√ß√µes avan√ßadas.",
		"S√£o Paulo: Ind√∫stria de software cresce 8%, com destaque para intelig√™ncia artificial em sa√∫de e log√≠stica.",
		"Amaz√¥nia: Restaura√ß√£o de ecossistemas com biotecnologia para 100 mil hectares at√© 2025.",
		"Cear√°: Amplia√ß√£o da fabrica√ß√£o de equipamentos para telecomunica√ß√µes, com 5G liderando a transforma√ß√£o."
	];


		const shuffledHeadlines = shuffleArray([...headlines]); // Embaralha as not√≠cias
		const newsText = shuffledHeadlines.join(' - '); // Cria o texto para o letreiro
		const marquee = document.getElementById('newsMarquee');
		marquee.innerHTML = `
			<img src="https://i.postimg.cc/65gr9cjN/bandeiravermelhaanimada.gif" alt="Bandeira Vermelha">
			${newsText}
		`;
		
	}

	// Chama a fun√ß√£o imediatamente para carregar os dados na primeira vez
	fetchNewsTitles();

	function updateProductName(rowIndex, newName) {
		const demandRows = document.querySelectorAll('#finalDemandInputs tr');
		const sectorHeader = document.querySelector(`#inputTable thead tr th:nth-child(${rowIndex + 2}) input`);

		if (demandRows[rowIndex]) {
			const productCell = demandRows[rowIndex].querySelector('td:first-child');
			if (productCell) {
				productCell.textContent = newName; // Atualiza o nome do produto na tabela Demanda Final
			}
		}
		
		if (sectorHeader) { 
			if (newName.includes("Rede")) {
				sectorHeader.value = newName;
			} else {
				sectorHeader.value = `Produ√ß√£o de ${newName}`;
			}
		}

		//showNotification(`Produto ${rowIndex + 1} atualizado para: ${newName}`, true);
	}

	function updateSectorName(colIndex, newName) {
		const thead = document.querySelector('#inputTable thead tr');
		const headerCell = thead.querySelectorAll('th')[colIndex + 1]; // Coluna come√ßa no √≠ndice 1

		if (headerCell) {
			const input = headerCell.querySelector('input[type="text"]');
			if (input) {
				input.value = newName; // Atualiza o t√≠tulo da coluna
			}
		}

		//showNotification(`Setor ${colIndex + 1} atualizado para: ${newName}`, true);
	}


	document.getElementById('downloadDataButton').addEventListener('click', () => {
		try {
			const csvContent = generateCSV();
			downloadCSV(csvContent, 'dados_economia.csv');
		} catch (error) {
			console.error('Erro ao gerar o arquivo CSV:', error);
		}
	});

	function generateCSV() {
		const data = collectAllData();

		let csv = '';

		// Nomes dos Produtos
		csv += 'Produtos\n';
		csv += data.productNames.join(',') + '\n\n';

		// Matriz Tecnol√≥gica
		csv += 'Matriz Tecnol√≥gica\n';
		data.techMatrix.forEach((row, rowIndex) => {
			csv += `${data.productNames[rowIndex]},${row.map(value => value || 0).join(',')}\n`;
		});
		csv += '\n';

		// Demanda Final
		csv += 'Demanda Final\n';
		data.finalDemand.forEach((value, rowIndex) => {
			csv += `${data.productNames[rowIndex]},${value || 0}\n`;
		});
		csv += '\n';

		// Dados de Otimiza√ß√£o
		csv += 'Otimiza√ß√£o\n';
		for (const [index, inputs] of Object.entries(data.optimizationInputs)) {
			const values = [
				data.productNames[index] || '',
				inputs.workerLimit || 0,
				inputs.workerHours || 0,
				inputs.productionTime || 0,
				inputs.nightShift ? 'true' : 'false',
				inputs.weeklyScale || 0,
				optimizedStatus[index] ? 'true' : 'false'
			];
			csv += values.join(',') + '\n';
		}
		csv += '\n';

		// Resultados da Planifica√ß√£o
		csv += 'Resultados da Planifica√ß√£o\n';
		for (const [index, results] of Object.entries(data.optimizationResults)) {
			const values = [
				data.productNames[index] || '',
				results.totalHours || 0,
				results.workersNeeded || 0,
				results.factoriesNeeded || 0,
				results.totalShifts || 0,
				results.minimumProductionTime || 0,
				results.totalEmploymentPeriod || ''
			];
			csv += values.join(',') + '\n';
		}

		return csv;
	}






	function downloadCSV(content, filename) {
		const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
		const link = document.createElement('a');
		link.href = URL.createObjectURL(blob);
		link.download = filename;
		link.click();
	}


	document.getElementById('uploadDataButton').addEventListener('click', () => {
		const fileInput = document.getElementById('uploadInput');
		fileInput.click();
	});

	document.getElementById('uploadInput').addEventListener('change', async (event) => {
		const file = event.target.files[0];
		if (file) {
			try {
				const content = await file.text();
				restoreDataFromCSV(content);
				console.info('Dados restaurados com sucesso!');
			} catch (error) {
				console.error('Erro ao restaurar os dados:', error);
				console.info('Ocorreu um erro ao restaurar os dados. Verifique o arquivo CSV.');
			}
		}
	});

	function restoreDataFromCSV(content) {
		const lines = content.split('\n').map(line => line.trim()).filter(line => line);
		let section = null;

		const data = {
			productNames: [],
			techMatrix: [],
			finalDemand: [],
			optimizationInputs: {},
			optimizationResults: {}
		};

		lines.forEach(line => {
			const cells = line.split(',');

			if (line === 'Produtos') {
				section = 'productNames';
			} else if (line === 'Matriz Tecnol√≥gica') {
				section = 'techMatrix';
			} else if (line === 'Demanda Final') {
				section = 'finalDemand';
			} else if (line === 'Otimiza√ß√£o') {
				section = 'optimizationInputs';
			} else if (line === 'Resultados da Planifica√ß√£o') {
				section = 'optimizationResults';
			} else {
				if (section === 'productNames') {
					data.productNames = cells.map(name => name.trim());
				} else if (section === 'techMatrix') {
					if (cells.length > 1) {
						const values = cells.slice(1).map(value => parseFloat(value) || 0);
						data.techMatrix.push(values);
					}
				} else if (section === 'finalDemand') {
					if (cells.length === 2) {
						const demand = parseFloat(cells[1]) || 0;
						data.finalDemand.push(demand);
					}
				} else if (section === 'optimizationInputs') {
					const [
						productName,
						workerLimit,
						workerHours,
						productionTime,
						nightShift,
						weeklyScale,
						optimized
					] = cells;

					const productIndex = data.productNames.indexOf(productName);

					if (productIndex !== -1) {
						const inputs = {
							workerLimit: parseFloat(workerLimit) || 0,
							workerHours: parseFloat(workerHours) || 0,
							productionTime: parseFloat(productionTime) || 0,
							nightShift: nightShift === 'true',
							weeklyScale: parseInt(weeklyScale, 10) || 0
						};

						// Salvar os dados no objeto e processar se otimizados
						data.optimizationInputs[productIndex] = inputs;
						if (optimized === 'true') {
							optimizationInputs[productIndex] = inputs;
							saveOptimizationInputsForProduct(productIndex); // Chama a fun√ß√£o para salvar e processar
						}
					}
				}
			}
		});

		// Valida√ß√£o e ajuste de dados restaurados
		if (data.finalDemand.length !== data.productNames.length) {
			while (data.finalDemand.length < data.productNames.length) {
				data.finalDemand.push(0);
			}
		}

		// Redimensionar a tabela e carregar os dados
		resizeTableForData(data.productNames.length, data.techMatrix[0]?.length || 0);
		populateTechMatrix(data.techMatrix, data.productNames);
		populateFinalDemand(data.finalDemand);

		// Atualiza o status de otimiza√ß√£o e os bot√µes
		Object.keys(optimizationInputs).forEach(index => {
			const productIndex = parseInt(index, 10);
			const hasOptimization = isOptimizationDataComplete(productIndex);
			optimizedStatus[productIndex] = hasOptimization; // Define o status
			updateOptimizeButtonColor(productIndex); // Atualiza a cor do bot√£o
		});

		// Executar a fun√ß√£o de planifica√ß√£o automaticamente
		planify();

		console.info('Dados restaurados e planificados com sucesso!');
	}

	function saveOptimizationInputsForProduct(productIndex) {
		const inputs = optimizationInputs[productIndex];
		if (!inputs) return;

		// Salva os dados no objeto de otimiza√ß√£o
		optimizationInputs[productIndex] = inputs;
		optimizedStatus[productIndex] = true;

		// Atualiza o bot√£o na tabela "Demanda Final"
		updateOptimizeButtonColor(productIndex);

		// Recalcula a otimiza√ß√£o para este produto
		performOptimization(productIndex);
	}

	function saveOptimizationInputsForProduct(productIndex) {
		const inputs = optimizationInputs[productIndex];
		if (!inputs) return;

		// Salva os dados no objeto de otimiza√ß√£o
		optimizationInputs[productIndex] = inputs;
		optimizedStatus[productIndex] = true;

		// Atualiza o bot√£o na tabela "Demanda Final"
		updateOptimizeButtonColor(productIndex);

		// Recalcula a otimiza√ß√£o para este produto
		performOptimization(productIndex);

		// Atualiza os resultados da "Planifica√ß√£o Otimizada"
		const resultDiv = document.getElementById('result');
		if (resultDiv && resultDiv.innerHTML.trim() !== '') {
			planify(); // Reprocessa os dados da planifica√ß√£o
		}
	}







	function restoreFromCSV(content) {
		const lines = content.split('\n').map(line => line.trim()).filter(line => line);
		let section = null;

		const data = {
			productNames: [],
			techMatrix: [],
			finalDemand: [],
			optimizationInputs: {},
			optimizationResults: {}
		};

		lines.forEach(line => {
			if (line === 'Produtos') {
				section = 'productNames';
			} else if (line === 'Matriz Tecnol√≥gica') {
				section = 'techMatrix';
			} else if (line === 'Demanda Final') {
				section = 'finalDemand';
			} else if (line === 'Otimiza√ß√£o') {
				section = 'optimizationInputs';
			} else if (line === 'Resultados da Planifica√ß√£o') {
				section = 'optimizationResults';
			} else {
				const cells = line.split(',');

				if (section === 'productNames') {
					data.productNames = cells;
				} else if (section === 'techMatrix') {
					const productName = cells[0];
					const values = cells.slice(1).map(Number);
					data.techMatrix.push(values);
					if (!data.productNames.includes(productName)) {
						data.productNames.push(productName);
					}
				} else if (section === 'finalDemand') {
					const productName = cells[0];
					const value = Number(cells[1]);
					data.finalDemand.push(value);
				} else if (section === 'optimizationInputs') {
					const [productName, workerLimit, workerHours, productionTime, nightShift, weeklyScale] = cells;
					const productIndex = data.productNames.indexOf(productName);
					data.optimizationInputs[productIndex] = {
						workerLimit: parseFloat(workerLimit),
						workerHours: parseFloat(workerHours),
						productionTime: parseFloat(productionTime),
						nightShift: nightShift === 'true',
						weeklyScale: parseInt(weeklyScale, 10)
					};
				} else if (section === 'optimizationResults') {
					const [
						productName,
						totalHours,
						workersNeeded,
						factoriesNeeded,
						totalShifts,
						minimumProductionTime,
						totalEmploymentPeriod
					] = cells;
					const productIndex = data.productNames.indexOf(productName);
					data.optimizationResults[productIndex] = {
						totalHours: parseFloat(totalHours),
						workersNeeded: parseInt(workersNeeded, 10),
						factoriesNeeded: parseFloat(factoriesNeeded),
						totalShifts: parseInt(totalShifts, 10),
						minimumProductionTime: parseInt(minimumProductionTime, 10),
						totalEmploymentPeriod
					};
				}
			}
		});

		// Restaurar os dados
		resizeTableForData(data.techMatrix.length, data.techMatrix[0]?.length || 0);
		populateTechMatrix(data.techMatrix, data.productNames);
		populateFinalDemand(data.finalDemand);
		optimizationInputs = data.optimizationInputs;
		optimizationResults = data.optimizationResults;
		planify(); // Recalcula os resultados
		
		// Atualiza os bot√µes com base nos dados carregados
		Object.keys(optimizationInputs).forEach(index => {
			updateOptimizeButtonColor(parseInt(index, 10));
		});
		
	}



	function resizeTableForData(numRows, numCols) {
		document.getElementById('numRows').value = numRows;
		document.getElementById('numCols').value = numCols;
		resizeTable(); // Redimensiona a tabela usando a fun√ß√£o existente
	}






	function populateTechMatrix(techMatrix, productNames) {
		const thead = document.getElementById('inputTable').querySelector('thead tr');
		const tbody = document.getElementById('inputTable').querySelector('tbody');

		// Atualizar os t√≠tulos das colunas
		thead.innerHTML = '<th>Produtos / Setor Produtivo</th>'; // Redefine o cabe√ßalho
		productNames.forEach(productName => {
			const sectorHeader = document.createElement('th');
			const sectorInput = document.createElement('input');
			sectorInput.type = 'text';
			sectorInput.value = `Produ√ß√£o de ${productName}`;
			sectorInput.readOnly = true; // Define como apenas leitura
			addTooltipBehavior(sectorInput); // Adiciona o comportamento de tooltip
			sectorHeader.appendChild(sectorInput);
			thead.appendChild(sectorHeader);
		});

		// Atualizar os dados da tabela
		tbody.innerHTML = ''; // Limpa a tabela existente
		techMatrix.forEach((row, rowIndex) => {
			const tr = document.createElement('tr');
			const productNameCell = document.createElement('td');
			const productInput = document.createElement('input');
			productInput.type = 'text';
			productInput.value = productNames[rowIndex];
			productInput.oninput = () => updateProductName(rowIndex, productInput.value);
			productNameCell.appendChild(productInput);
			tr.appendChild(productNameCell);

			row.forEach(value => {
				const cell = document.createElement('td');
				const input = document.createElement('input');
				input.type = 'number';
				input.value = value;
				cell.appendChild(input);
				addHighlightBehavior(cell); // Adiciona o comportamento de destaque
				tr.appendChild(cell);
			});

			tbody.appendChild(tr);
		});
	}


	function populateFinalDemand(finalDemand) {
		const demandContainer = document.getElementById('finalDemandInputs');
		demandContainer.innerHTML = ''; // Limpa a tabela antes de preencher

		finalDemand.forEach((demand, index) => {
			const row = document.createElement('tr');

			// Coluna do nome do produto
			const productNameCell = document.createElement('td');
			productNameCell.textContent = getProductNames()[index] || `Produto ${index + 1}`;
			row.appendChild(productNameCell);

			// Entrada de demanda
			const demandInputCell = document.createElement('td');
			const demandInput = document.createElement('input');
			demandInput.type = 'number';
			demandInput.value = demand;
			demandInput.id = `demand${index}`;
			demandInputCell.appendChild(demandInput);
			row.appendChild(demandInputCell);

			// Bot√£o de a√ß√£o
			const actionCell = document.createElement('td');
			const optimizeButton = document.createElement('button');
			optimizeButton.textContent = 'Otimizar';
			optimizeButton.onclick = () => openOptimizationModal(index); // Reatribuir o evento de clique
			actionCell.appendChild(optimizeButton);
			row.appendChild(actionCell);

			demandContainer.appendChild(row);

			// Atualizar a cor do bot√£o com base no status de otimiza√ß√£o
			updateOptimizeButtonColor(index);
		});
	}


	function collectAllData() {
		// Obter nomes dos produtos
		const productNames = getProductNames();

		// Obter dados da tabela "Matriz Tecnol√≥gica"
		const techMatrix = getTableData();

		// Obter dados da tabela "Demanda Final"
		const finalDemand = getFinalDemand();
		
		const instancePrepositionJurisdictionUUID = user.instancePrepositionJurisdictionUUID;

		return {
			productNames,       // Nomes dos produtos
			techMatrix,         // Dados da Matriz Tecnol√≥gica
			finalDemand,        // Dados da Demanda Final
			optimizationInputs, // Configura√ß√µes de otimiza√ß√£o (objeto global)
			optimizationResults, // Resultados da planifica√ß√£o (objeto global)
			instancePrepositionJurisdictionUUID			//Inst√¢ncia + Preposi√ß√£o + Jurisdi√ß√£o
		};
	}

	function updateColumnTitles(productNames) {
		const headerRow = document.getElementById('inputTable').querySelector('thead tr');

		// Ignorar a primeira c√©lula (que cont√©m "Produtos / Setores Produtivos")
		const columnHeaders = headerRow.querySelectorAll('th');

		productNames.forEach((productName, index) => {
			const columnHeader = columnHeaders[index + 1]; // +1 para ignorar a primeira c√©lula
			if (columnHeader) {
				const input = columnHeader.querySelector('input');
				if (input) {
					input.value = `Produ√ß√£o de ${productName}`; // Atualiza o t√≠tulo
					input.readOnly = true; // Configura como somente leitura
					addTooltipBehavior(input); // Adiciona o comportamento de tooltip
				}
			}
		});
	}

	// Dados para salvar e carregar os dados online
	const endpoint = "data";
	//const apiKey = 'ixYIiBIuxiS68RgTT7qYB50K3jOiUKMK9bQFPjAcRd';
	//let apiUrl = `https://api.jsonsilo.com/${endpoint}`;
	let apiUrl = `${window.location.origin}/jsonServer/${endpoint}`;

	// Headers para a requisi√ß√£o
	const headers = {
		'Content-Type': 'application/json'
	};

	// Proxy
	//const proxyUrl = "https://api.allorigins.win/raw?url=";
	//apiUrl = proxyUrl + encodeURIComponent(apiUrl);

	function sendDataToJsonBin() {
		if (!userIsLoggedIn || !user) {
			showNotification("Voc√™ precisa estar logado para enviar dados.", false);
			return;
		}

		const instanceKey = user.instancePrepositionJurisdictionUUID;

		const setorUnidade = document.getElementById("setorUnidade").value.trim();

		const estoqueDemandaData = [];
		document.querySelectorAll("#estoqueDemandaTable tbody tr").forEach(row => {
			const bemDeProducao = row.cells[0].textContent.trim();
			const estoque = row.cells[1].querySelector("input").value.trim();
			const demanda = row.cells[2].querySelector("input").value.trim();
			estoqueDemandaData.push({ bemDeProducao, estoque, demanda });
		});

		const producaoMetaData = [];
		document.querySelectorAll("#producaoMetaTable tbody tr").forEach(row => {
			const produto = row.cells[0].querySelector("input").value.trim();
			const quantidadeProduzida = row.cells[1].querySelector("input").value.trim();
			const quantidadeMeta = row.cells[2].querySelector("input").value.trim();
			producaoMetaData.push({ produto, quantidadeProduzida, quantidadeMeta });
		});

		const comiteColTitle = document.getElementById("comiteColTitle").value.trim();

		//De Trabalhadores
		const comiteAssociadoDeTrabalhador = document.getElementById("comiteAssociadoDeTrabalhador").value.trim();
		const associacaoDeMoradoresAssociadaDeTrabalhador = document.getElementById("associacaoDeMoradoresAssociadaDeTrabalhador").value.trim();
		const hoursAtElectronicPoint = Number(document.getElementById("hoursAtElectronicPoint").value)
		
		console.log(`hoursAtElectronicPoint/totalSocialWork: ${hoursAtElectronicPoint}/${totalSocialWork} = ${hoursAtElectronicPoint/totalSocialWork}`);
		
		const partipacaoIndividualEstimadaNoTrabalhoSocial = hoursAtElectronicPoint/totalSocialWork;   //document.getElementById("partipacaoIndividualEstimadaNoTrabalhoSocial").value.concat("e-13")); //quando exibir na tela exibe multiplicado por esse valor
		
		//-----------

		const propostaTrabalhadoresData = { ...propostaDados };

		// Coleta os dados da segunda coluna da tabela "Vetor Tecnol√≥gico"
		const vetorTecnologicoData = [];
		document.querySelectorAll("#vetorTecnologicoTable tbody tr").forEach(row => {
			const secondColumnInput = row.cells[1]?.querySelector("input");
			if (secondColumnInput) {
				vetorTecnologicoData.push(secondColumnInput.value.trim());
			}
		});

		// Coleta os novos campos da se√ß√£o "Informa√ß√µes da Unidade Produtiva"
		const limiteEfetivoTrabalhadores = document.getElementById("limiteEfetivoTrabalhadores").value.trim();
		
		let conselhoPopularAssociadoDeComiteOuTrabalhadorData;
		
		if(user.instancePrepositionJurisdictionUUID.includes("WorkerUUID")){
			conselhoPopularAssociadoDeComiteOuTrabalhadorData = document.getElementById("conselhoPopularAssociadoDeComiteOuTrabalhadorTelaTrabalhador").value.trim();
		} else{
			conselhoPopularAssociadoDeComiteOuTrabalhadorData = document.getElementById("conselhoPopularAssociadoDeComiteOuTrabalhador").value.trim();
		}

		// Coleta o campo da se√ß√£o "Tamanho da Economia"
		const conselhoPopularAssociadoDeConselhoPopular = document.getElementById("conselhoPopularAssociadoDeConselhoPopular").value.trim();

		const dataToSave = {
			inputTable: getTableData(),
			productNames: getProductNames(),
			sectorNames: getSectorNames(),
			finalDemand: getFinalDemand(),
			optimizationInputs,
			optimizationResults,
			setorUnidade,
			limiteEfetivoTrabalhadores, // Novo campo da se√ß√£o "Informa√ß√µes da Unidade Produtiva"
			conselhoPopularAssociadoDeComiteOuTrabalhador: conselhoPopularAssociadoDeComiteOuTrabalhadorData,
			conselhoPopularAssociadoDeConselhoPopular, // Novo campo da se√ß√£o "Tamanho da Economia"
			estoqueDemanda: estoqueDemandaData,
			producaoMeta: producaoMetaData,
			comiteColTitle,
			propostaTrabalhadores: propostaTrabalhadoresData,
			vetorTecnologico: vetorTecnologicoData, // Adiciona os dados coletados
			totalSocialWorkDessaJurisdicao, // Valor padr√£o inicial
			comiteAssociadoDeTrabalhador,
			associacaoDeMoradoresAssociadaDeTrabalhador,
			partipacaoIndividualEstimadaNoTrabalhoSocial,
			hoursAtElectronicPoint,
			effectivelyPlannedProductionTime
		};

		fetch(apiUrl, {
			method: 'GET',
			headers: headers
		})
			.then(response => response.json())
			.then(binData => {
				const record = binData || {};
				record[instanceKey] = { ...record[instanceKey], ...dataToSave };

				return fetch(apiUrl, {
					method: 'PUT',
					headers: headers,
					body: JSON.stringify(record)
				});
			})
			.then(() => showNotification("Dados enviados com sucesso!", true))
			.catch(err => console.error("Erro ao enviar dados:", err));
	}


	function fetchDataFromJsonBin() {

		// Reseta os dados anteriores antes de carregar novos dados
		previousTableData = [];

		if (!userIsLoggedIn || !user) {
			showNotification("Voc√™ precisa estar logado para receber dados.", false);
			return;
		}

		// Limpa os dados antigos antes de carregar novos
		optimizationInputs = {};
		optimizationResults = {};
		optimizedStatus = {};

		const instanceKey = user.instancePrepositionJurisdictionUUID;

		fetch(apiUrl, {
			method: 'GET',
			headers: headers
		})
			.then(response => response.json())
			.then(binData => {
				const record = binData || {};
				const instanceData = record[instanceKey];

				if(user.instancePrepositionJurisdictionUUID.includes("WorkerUUID")){
					//Trabalhador n√£o conselheiro
					document.getElementById("name").value = user.name;
					generateQRCode(user.uuid);
				}

				if (instanceData) {

					// Obter dimens√µes da matriz tecnol√≥gica
					const numProducts = instanceData.productNames?.length || 0;
					const numSectors = instanceData.sectorNames?.length || 0;

					// Atualizar os campos "N√∫mero de produtos" e "N√∫mero de Setores Produtivos"
					document.getElementById('numRows').value = numProducts;
					document.getElementById('numCols').value = numSectors;

					if(!record[conselhoMundialKey]){
						showNotification("Cadastre um Conselho Popular Mundial.", false);
					}

					totalSocialWork = record[conselhoMundialKey]?.totalSocialWorkDessaJurisdicao || "Ainda n√£o h√° registro mundial de trabalho social total.";

					// Executar a fun√ß√£o de redimensionar tabela
					resizeTable();

					fillTableWithData(instanceData.inputTable || []);
					setProductNames(instanceData.productNames || []);
					setSectorNames(instanceData.sectorNames || []);
					setFinalDemand(instanceData.finalDemand || []);
					optimizationInputs = instanceData.optimizationInputs || {};
					optimizationResults = instanceData.optimizationResults || {};

					synchronizeFinalDemandProducts();
					updateAllOptimizeButtons();
					planify(); // Executa a planifica√ß√£o automaticamente ap√≥s carregar os dados
					showNotification("Dados recebidos com sucesso!", true);

					if(user.instancePrepositionJurisdictionUUID.includes("WorkerUUID")){
						//Trabalhador n√£o conselheiro

						document.getElementById("conselhoPopularAssociadoDeComiteOuTrabalhadorTelaTrabalhador").value = instanceData.conselhoPopularAssociadoDeComiteOuTrabalhador;
						document.getElementById("comiteAssociadoDeTrabalhador").value = instanceData.comiteAssociadoDeTrabalhador;
						document.getElementById("associacaoDeMoradoresAssociadaDeTrabalhador").value = instanceData.associacaoDeMoradoresAssociadaDeTrabalhador;
						document.getElementById("hoursAtElectronicPoint").value = Number(instanceData.hoursAtElectronicPoint);
						document.getElementById("totalSocialWork").value = totalSocialWork;
						
						console.log(`hoursAtElectronicPoint/totalSocialWork: ${instanceData.hoursAtElectronicPoint}/${totalSocialWork} = ${instanceData.hoursAtElectronicPoint/totalSocialWork}`);
						
						document.getElementById("partipacaoIndividualEstimadaNoTrabalhoSocial").value = ((instanceData.hoursAtElectronicPoint/totalSocialWork)*Number("1e13")).toFixed(2);
						
					}else{
						//Conselheiro
						
					}

					// Ajustar o campo "Setor"
					if (instanceData.setorUnidade) {
						document.getElementById("setorUnidade").value = instanceData.setorUnidade;
					}

					// Carregar os novos campos da se√ß√£o "Informa√ß√µes da Unidade Produtiva"
					if (instanceData.limiteEfetivoTrabalhadores !== undefined) {
						document.getElementById("limiteEfetivoTrabalhadores").value = instanceData.limiteEfetivoTrabalhadores;
					}

					if (instanceData.conselhoPopularAssociadoDeComiteOuTrabalhador !== undefined) {
						document.getElementById("conselhoPopularAssociadoDeComiteOuTrabalhador").value = instanceData.conselhoPopularAssociadoDeComiteOuTrabalhador;
					}

					// Carregar conselhoPopularAssociadoDeConselhoPopular a se√ß√£o "Tamanho da Economia"
					if (instanceData.conselhoPopularAssociadoDeConselhoPopular !== undefined) {
						document.getElementById("conselhoPopularAssociadoDeConselhoPopular").value = instanceData.conselhoPopularAssociadoDeConselhoPopular;
					}

					// Ajustar "Quantidade de Bens de Produ√ß√£o" e popula "Estoque e Demanda"
					if (instanceData.estoqueDemanda) {
						const estoqueDemandaBody = document.querySelector("#estoqueDemandaTable tbody");
						const requiredRows = instanceData.estoqueDemanda.length;

						document.getElementById('quantidadeBensProducao').value = requiredRows;

						if (estoqueDemandaBody) {
							estoqueDemandaBody.innerHTML = ""; // Limpa a tabela

							instanceData.estoqueDemanda.forEach((item, index) => {
								const row = document.createElement("tr");

								const bemCell = document.createElement("td");
								bemCell.textContent = item.bemDeProducao || `Bem ${index + 1}`;

								const estoqueCell = document.createElement("td");
								const estoqueInput = document.createElement("input");
								estoqueInput.type = "number";
								estoqueInput.value = item.estoque || 0;
								estoqueCell.appendChild(estoqueInput);

								const demandaCell = document.createElement("td");
								const demandaInput = document.createElement("input");
								demandaInput.type = "number";
								demandaInput.value = item.demanda || 0;
								demandaInput.readOnly = true;
								demandaCell.appendChild(demandaInput);

								row.appendChild(bemCell);
								row.appendChild(estoqueCell);
								row.appendChild(demandaCell);
								estoqueDemandaBody.appendChild(row);
							});
						}
					}

					// Ajustar a tabela "Vetor Tecnol√≥gico"
					if (instanceData.estoqueDemanda) {
						const vetorTecnologicoBody = document.querySelector("#vetorTecnologicoTable tbody");
						const estoqueDemandaBody = document.querySelector("#estoqueDemandaTable tbody");
						const requiredRows = instanceData.estoqueDemanda.length;

						if (vetorTecnologicoBody && estoqueDemandaBody) {
							vetorTecnologicoBody.innerHTML = ""; // Limpa a tabela

							instanceData.estoqueDemanda.forEach((item, index) => {
								const row = document.createElement("tr");

								// Coluna: Nome do Produto (Bem de Produ√ß√£o)
								const bemDeProducaoCell = document.createElement("td");
								const bemInput = document.createElement("input");
								bemInput.type = "text";
								bemInput.value = item.bemDeProducao || `Bem ${index + 1}`;

								// Sincroniza com a tabela "Estoque e Demanda"
								bemInput.addEventListener("input", () => {
									const estoqueRow = estoqueDemandaBody.querySelectorAll("tr")[index];
									if (estoqueRow) {
										const bemCell = estoqueRow.querySelector("td:first-child");
										if (bemCell) {
											bemCell.textContent = bemInput.value;
										}
									}
								});

								bemDeProducaoCell.appendChild(bemInput);

								// Coluna: Valor (inicializa com 0 ou valor carregado)
								const valorCell = document.createElement("td");
								const valorInput = document.createElement("input");
								valorInput.type = "number";
								valorInput.value = instanceData.vetorTecnologico?.[index] || 0;
								valorCell.appendChild(valorInput);

								row.appendChild(bemDeProducaoCell);
								row.appendChild(valorCell);
								vetorTecnologicoBody.appendChild(row);
							});
						}
					}

					// Carregar o t√≠tulo do comit√™
					if (instanceData.comiteColTitle) {
						document.getElementById("comiteColTitle").value = instanceData.comiteColTitle;
					}

					// Carregar dados do modal "Proposta para demais Trabalhadores"
					if (instanceData.propostaTrabalhadores) {
						propostaDados = instanceData.propostaTrabalhadores;

						document.getElementById("workerLimitProposta").value = propostaDados.workerLimit || 0;
						document.getElementById("workerHoursProposta").value = propostaDados.workerHours || 0;
						document.getElementById("productionTimeProposta").value = propostaDados.productionTime || 0;
						document.getElementById("nightShiftProposta").checked = propostaDados.nightShift || false;
						document.getElementById("weeklyScaleProposta").value = propostaDados.weeklyScale || 0;
					}

					// Carregar dados da tabela "Produ√ß√£o e Meta"
					if (instanceData.producaoMeta) {
						
						const producaoMetaBody = document.querySelector("#producaoMetaTable tbody");
						producaoMetaBody.innerHTML = ""; // Limpa a tabela

						instanceData.producaoMeta.forEach((item, index) => {
							const row = document.createElement("tr");

							// Coluna: Produto
							const produtoCell = document.createElement("td");
							const produtoInput = document.createElement("input");
							produtoInput.type = "text";
							produtoInput.value = item.produto || `Produto ${index + 1}`;
							produtoCell.appendChild(produtoInput);

							// Coluna: Quantidade Produzida
							const quantidadeProduzidaCell = document.createElement("td");
							const quantidadeProduzidaInput = document.createElement("input");
							quantidadeProduzidaInput.type = "number";
							quantidadeProduzidaInput.id = "producedQuantity";
							quantidadeProduzidaInput.value = parseFloat(item.quantidadeProduzida).toFixed(3) || 0;
							quantidadeProduzidaCell.appendChild(quantidadeProduzidaInput);

							// Coluna: Quantidade Meta
							const quantidadeMetaCell = document.createElement("td");
							const quantidadeMetaInput = document.createElement("input");
							quantidadeMetaInput.type = "number";
							quantidadeMetaInput.value = item.quantidadeMeta || 0;
							quantidadeMetaInput.id = "pendingProductionQuantity";
							quantidadeMetaInput.readOnly = true;
							quantidadeMetaCell.appendChild(quantidadeMetaInput);

							// Coluna: Planejamento (bot√£o)
							const planejamentoCell = document.createElement("td");
							const planejamentoButton = document.createElement("button");
							planejamentoButton.className = "btn";
							planejamentoButton.textContent = "Planejamento";
							planejamentoButton.onclick = () => openProducaoMetaModal();
							planejamentoCell.appendChild(planejamentoButton);

							// Adiciona as c√©lulas √† linha
							row.appendChild(produtoCell);
							row.appendChild(quantidadeProduzidaCell);
							row.appendChild(quantidadeMetaCell);
							row.appendChild(planejamentoCell);

							// Adiciona a linha ao corpo da tabela
							producaoMetaBody.appendChild(row);

							// Inicializa o evento e executa a atualiza√ß√£o inicial
							produtoInput.addEventListener('input', atualizarTituloColunaVetorTecnologico);
							atualizarTituloColunaVetorTecnologico(); // Atualiza o t√≠tulo na inicializa√ß√£o
						});
					
						// Carregue os dados e atribua √†s vari√°veis
						 
						 const produtoInput = document.querySelector('#producaoMetaTable tbody tr td:first-child input');
						 
						const limiteEfetivoTrabalhadores = document.getElementById("limiteEfetivoTrabalhadores").value.trim();
						const comiteColTitle = instanceData.comiteColTitle;
						const productName = produtoInput.value || "Produto";
						const minimumProductionTime = instanceData.producaoMeta; //ver se vou ter que somar tudo pra tirar a media ponderada como fiz antes. multiplicar o valor do setor pelo peso pra ter a propor√ß√£o pra essa fabrica.
						const workShift = instanceData.workShift;
						const workerHours = instanceData.workerHours;
						const weeklyScale = instanceData.weeklyScale;
						const totalEmploymentPeriod = instanceData.totalEmploymentPeriod;
						
						
					} else {
						console.error("Nenhum dado encontrado para a inst√¢ncia:", instanceKey);
					}

				} else {
					showNotification("Nenhum dado encontrado para sua inst√¢ncia.", false);
				}
			})
			.catch(err => console.error("Erro ao receber dados do JSONBin:", err));
	}



	document.getElementById("sendDataButton").addEventListener("click", sendDataToJsonBin);

	// Suponha um bot√£o para restaurar dados
	document.getElementById("fetchDataButton").addEventListener("click", () => {
		const binId = "67454301e41b4d34e45ab292"; //binID dos dados que se deseja restaurar
		if (binId) {
			fetchDataFromJsonBin(binId);
		}
	});

	function restoreDataFromJSON(data) {
		try {
		
			// Determina o n√∫mero de produtos e setores com base nos dados recebidos
			const numRows = data.productNames.length;
			const numCols = data.techMatrix[0]?.length || 0;

			// Atualiza os valores dos inputs do Tamanho da Economia
			document.getElementById('numRows').value = numRows;
			document.getElementById('numCols').value = numCols;

			// Redimensiona a tabela principal
			resizeTable();

			// Preenche os dados recebidos na interface
			const tbody = document.getElementById('inputTechnologicalMatrixTableBody');
			tbody.innerHTML = '';

			data.productNames.forEach((name, rowIndex) => {
				const row = document.createElement('tr');

				// Nome do produto
				const productNameCell = document.createElement('td');
				const productInput = document.createElement('input');
				productInput.type = 'text';
				productInput.value = name;
				productInput.oninput = (e) => updateProductName(rowIndex, e.target.value);
				productNameCell.appendChild(productInput);
				row.appendChild(productNameCell);

				// Dados da Matriz Tecnol√≥gica
				data.techMatrix[rowIndex].forEach(value => {
					const cell = document.createElement('td');
					const input = document.createElement('input');
					input.type = 'number';
					input.value = value;
					cell.appendChild(input);
					addHighlightBehavior(cell); // Adiciona o comportamento de destaque
					row.appendChild(cell);
				});

				tbody.appendChild(row);
			});

			// Atualiza a tabela de Demanda Final
			const demandInputsContainer = document.getElementById('finalDemandInputs');
			demandInputsContainer.innerHTML = '';

			data.finalDemand.forEach((value, index) => {
				const demandRow = document.createElement('tr');

				// Nome do produto
				const productNameCell = document.createElement('td');
				productNameCell.textContent = data.productNames[index];
				demandRow.appendChild(productNameCell);

				// Valor da demanda
				const demandInputCell = document.createElement('td');
				const demandInput = document.createElement('input');
				demandInput.type = 'number';
				demandInput.value = value;
				demandInput.id = `demand${index}`;
				demandInputCell.appendChild(demandInput);
				demandRow.appendChild(demandInputCell);

				// Bot√£o de otimiza√ß√£o
				const buttonCell = document.createElement('td');
				const button = document.createElement('button');
				button.textContent = 'Otimizar';
				button.onclick = () => openOptimizationModal(index);
				buttonCell.appendChild(button);
				demandRow.appendChild(buttonCell);

				demandInputsContainer.appendChild(demandRow);
			});

			// Preenche os dados de "Par√¢metros de Otimiza√ß√£o" para os produtos
			Object.keys(data.optimizationInputs).forEach(index => {
				const productIndex = parseInt(index, 10);
				const inputs = data.optimizationInputs[productIndex];

				if (inputs) {
					optimizationInputs[productIndex] = {
						workerLimit: inputs.workerLimit || 0,
						workerHours: inputs.workerHours || 0,
						productionTime: inputs.productionTime || 0,
						nightShift: inputs.nightShift || false,
						weeklyScale: inputs.weeklyScale || 0
					};
				}
			});

			// Atualiza o status de otimiza√ß√£o e os bot√µes
			Object.keys(optimizationInputs).forEach(index => {
				const productIndex = parseInt(index, 10);
				const hasOptimization = isOptimizationDataComplete(productIndex);
				optimizedStatus[productIndex] = hasOptimization; // Define o status
				updateOptimizeButtonColor(productIndex); // Atualiza a cor do bot√£o
			});

			console.info('Dados restaurados com sucesso!');
			
			// Chama a fun√ß√£o planify automaticamente ap√≥s carregar os dados
			planify();
			
		} catch (error) {
			console.error('Erro ao restaurar os dados:', error);
		}
	}



	function convertJSONToCSV(data) {
		let csv = "";

		// Nomes dos Produtos
		csv += "Produtos\n";
		csv += data.productNames.join(",") + "\n\n";

		// Matriz Tecnol√≥gica
		csv += "Matriz Tecnol√≥gica\n";
		data.techMatrix.forEach((row, rowIndex) => {
			csv += `${data.productNames[rowIndex]},${row.map(value => value || 0).join(",")}\n`;
		});
		csv += "\n";

		// Demanda Final
		csv += "Demanda Final\n";
		data.finalDemand.forEach((value, rowIndex) => {
			csv += `${data.productNames[rowIndex]},${value || 0}\n`;
		});
		csv += "\n";

		// Dados de Otimiza√ß√£o
		if (data.optimizationInputs) {
			csv += "Otimiza√ß√£o\n";
			for (const [index, inputs] of Object.entries(data.optimizationInputs)) {
				const values = [
					data.productNames[index] || "",
					inputs.workerLimit || 0,
					inputs.workerHours || 0,
					inputs.productionTime || 0,
					inputs.nightShift ? "true" : "false",
					inputs.weeklyScale || 0,
					"true" // Supondo que os dados de JSON incluem otimiza√ß√µes feitas
				];
				csv += values.join(",") + "\n";
			}
			csv += "\n";
		}

		// Resultados da Planifica√ß√£o
		if (data.optimizationResults) {
			csv += "Resultados da Planifica√ß√£o\n";
			for (const [index, results] of Object.entries(data.optimizationResults)) {
				const values = [
					data.productNames[index] || "",
					results.totalHours || 0,
					results.workersNeeded || 0,
					results.factoriesNeeded || 0,
					results.totalShifts || 0,
					results.minimumProductionTime || 0,
					results.totalEmploymentPeriod || ""
				];
				csv += values.join(",") + "\n";
			}
		}

		return csv;
	}

	function isOptimizationDataComplete(productIndex) {
		const inputs = optimizationInputs[productIndex];
		if (!inputs) return false;

		return (
			inputs.workerLimit > 0 &&
			inputs.workerHours > 0 &&
			inputs.productionTime > 0 &&
			inputs.weeklyScale > 0
		);
	}

	// Fun√ß√£o para mostrar os campos adicionais quando o Inst√¢ncia √© selecionado
		function showFields() {
			const select = document.getElementById('instance');
			const additionalFields = document.getElementById('additionalFields');
			
			if (select.value && !select.value.includes("Trabalhador")) {
				additionalFields.style.display = 'flex'; // Exibe os campos adicionais
			} else {
				additionalFields.style.display = 'none'; // Oculta os campos adicionais
			}
		}

		// Fun√ß√£o para mostrar ou ocultar a se√ß√£o de Login
		   function showLoginSection() {
			const loginSection = document.getElementById("loginSection");
			loginSection.style.display = "block"; // Torna a se√ß√£o de login vis√≠vel
			const loginButton = document.getElementById("loginButton");
			loginButton.style.display = "none"; // Oculta o bot√£o "Fa√ßa Login"
			// Ocultar os campos de registro, caso estejam vis√≠veis
			document.getElementById('registrationFields').style.display = 'none';
			
			// Rola a p√°gina para o topo
			
			// Rola suavemente para o topo da p√°gina
			window.scrollTo({
				top: 0,
				behavior: 'smooth',
			});
			
			const usernameField = document.getElementById('username');
			usernameField.focus(); // Move o cursor para o campo "Nome de Usu√°rio"
			
			
			
		}

		// Manter os dados inseridos no formul√°rio quando clicar em "Fa√ßa Login"
		document.getElementById("loginButton").addEventListener("click", showLoginSection);

	// Fun√ß√£o para mostrar o campo de jurisdi√ß√£o quando uma op√ß√£o √© selecionada
		function showJurisdiction() {
			const select = document.getElementById('instance');
			const jurisdictionContainer = document.getElementById('jurisdictionContainer');
			
			// Exibe o campo apenas se uma op√ß√£o v√°lida for selecionada
			if (select.value) {
				jurisdictionContainer.style.display = 'flex'; // Exibe o campo com layout flex
				jurisdictionContainer.style.alignItems = 'center'; // Centraliza o r√≥tulo e o campo
			} else {
				jurisdictionContainer.style.display = 'none'; // Oculta o campo
			}
		}

		// Fun√ß√£o para atualizar o texto do conselho
		function updateCouncilText(event) {
			if (event.key === "Enter") {
				event.preventDefault(); // Impede comportamento padr√£o do Enter

				const instance = document.getElementById("instance").value;
				const jurisdiction = document.getElementById("jurisdiction").value.trim();
				const preposition = document.getElementById("preposition").value;
				const infoText = document.getElementById("infoText");

				if (!(instance && jurisdiction && preposition)) {
					showNotification("Por favor, preencha todos os campos obrigat√≥rios.", false);
				}
			}
		}

		// Adiciona o evento de Enter no campo de jurisdi√ß√£o
		document.getElementById("jurisdiction").addEventListener("keydown", updateCouncilText);

		// Mostra os campos adicionais ao selecionar o Inst√¢ncia
		document.getElementById("instance").addEventListener("change", showFields);

	// Exibe os campos de registro ao clicar no bot√£o "Cadastre-se"
	function showRegistrationFields() {
		const registrationFields = document.getElementById('registrationFields');
		registrationFields.style.display = 'block'; // Exibe os campos
	}

	async function handleLogin() {
		const usernameField = document.getElementById('username');
		const username = usernameField.value.trim();
		const password = document.getElementById('password').value.trim();

		if (!username || !password) {
			showNotification('Preencha todos os campos de login.', false);
			return;
		}

		try {
			// Buscar dados
			const response = await fetch(apiUrl, {
				method: 'GET',
				headers: headers
			});

			const data = await response.json();  // Parse dos dados em formato JSON

			//console.info("data: ");
			//console.log(data);

			// Verifica se o usu√°rio existe e a senha corresponde
			user = data.users.find(
				user => user.username === username && user.password === password
			);

			if (user) {
				// Define os dados globais do usu√°rio logado
				userIsLoggedIn = true;
				user = {
					username: user.username,
					instance: user.instance,
					pronoun: user.pronoun,
					jurisdiction: user.jurisdiction,
					preposition: user.preposition,
					instancePrepositionJurisdictionUUID: user.instancePrepositionJurisdictionUUID,
					uuid: user.uuid,
					name: user.name
				};

				// Realize outras a√ß√µes de login aqui, se necess√°rio
				
				if (user.pronoun === 'feminino') {
					showNotification(`Bem-vinda, ${user.name}!`, true);
				} else if (user.pronoun === 'masculino') {
					showNotification(`Bem-vindo, ${user.name}!`, true);
				} else {
					showNotification(`Bem-vinde, ${user.name}!`, true);
				}
				
				// Aplica a classe 'logged-in' ao #globeContainer para aplicar o estilo de login
				const globeContainer = document.getElementById('globeContainer');
				globeContainer.classList.add('logged-in'); // Adiciona a classe para alinhamento √† direita
				
				// Exibe a div "logado"
				document.getElementById('logado').style.display = 'block'; // Torna vis√≠vel
				
				// Oculta a se√ß√£o de login
				document.getElementById('loginSection').style.display = 'none';
				userIsLoggedIn = true;
				document.getElementById('sendDataButton').style.display = 'inline-block'; // Exibe o bot√£o para enviar dados
				
				// Controle de exibi√ß√£o das divs de telas com base na inst√¢ncia
				
			if (user.instance.includes('Conselho')) {
				document.getElementById('conselheiroDeConselho').style.display = 'block';
				document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'none';
				document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'none';
				document.getElementById('trabalhador').style.display = 'none';
				
			} else if (user.instance.includes('Comit√™')) {
				document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'block';
				document.getElementById('conselheiroDeConselho').style.display = 'none';
				document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'none';
				document.getElementById('trabalhador').style.display = 'none';

				// Atualizar o t√≠tulo da segunda coluna
				const comiteColTitle = document.getElementById('comiteColTitle');
				comiteColTitle.value = user.instance === 'Comit√™ de F√°brica' ? 'Nome da F√°brica' : 'Nome do Campo';

				// Preencher tabela com valores padr√£o
				updateVetorTecnologicoTable();
				
			} else if (user.instance.includes('Trabalhador')) {
				document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'none';
				document.getElementById('conselheiroDeConselho').style.display = 'none';
				document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'none';
				document.getElementById('trabalhador').style.display = 'block';			
				
			} else {
				// Para Associa√ß√£o de Moradores ou outras inst√¢ncias
				document.getElementById('conselheiroDeConselho').style.display = 'none';
				document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'none';
				document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'block';
				document.getElementById('trabalhador').style.display = 'none';
			}
				
				// Chama automaticamente a fun√ß√£o que recebe os dados online
				setTimeout(() => {
					fetchDataFromJsonBin();
					// Chama automaticamente a fun√ß√£o que recebe os dados online
					setTimeout(() => {
						scrollToEndOfPage();
						openProducaoMetaModal();
					}, 2000);
				}, 1000);
				
				} else {
					showNotification('Usu√°rio ou senha inv√°lidos.', false);
					document.getElementById('logado').style.display = 'none'; 
					document.getElementById('conselheiroDeConselho').style.display = 'none';
					document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'none';
					document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'none';
				}
		} catch (error) {
			console.error('Erro ao fazer login:', error);
			showNotification('Erro ao autenticar. Tente novamente mais tarde.', false);
			document.getElementById('logado').style.display = 'none'; 
			document.getElementById('conselheiroDeConselho').style.display = 'none';
			document.getElementById('conselheiroDeComiteDeFabricaOuCampo').style.display = 'none';
			document.getElementById('conselheiroDeAssociacaoDeMoradores').style.display = 'none';
		}
	}


	async function handleRegister() {
		const username = document.getElementById('username').value.trim();
		const password = document.getElementById('password').value.trim();
		const pronoun = document.getElementById('pronoun').value;
		const instance = document.getElementById('instance').value;
		const name = document.getElementById('nameRegistration').value;
		
		let space = "";
		let preposition = "";
		let jurisdiction = "";
		let uuid = "";
		let uuidPreposition = "";

		if(instance.includes("Trabalhador")) {
			uuid = generateUUID();
			uuidPreposition = "UUID:";
		}
		else {
			space = " ";
			preposition = document.getElementById('preposition').value;
			jurisdiction = document.getElementById('jurisdiction').value.trim();
		}

		// Combina instance, preposition e jurisdiction
		const instancePrepositionJurisdictionUUID = (`${instance=='Trabalhador'?'Worker':instance}${space}${preposition}${space}${jurisdiction}${space}${uuidPreposition}${space}${uuid}`).trim();

		if (!username || !password || !instance || !pronoun) {
			if(!instance.includes("Trabalhador") && (!jurisdiction || !preposition))
			showNotification('Preencha todos os campos corretamente.', false);
			return;
		}

		try {
			
			// Buscar dados
			const response = await fetch(apiUrl, {
				method: 'GET',
				headers: headers
			});

			const data = await response.json();  // Parse dos dados em formato JSON

			// Certifique-se de que a chave "users" exista no objeto
			if (!data.users) {
				data.users = [];
			}

			// Verifica se o nome de usu√°rio j√° est√° registrado
			if (data.users.some(user => user.username === username)) {
				showNotification('Nome de usu√°rio j√° registrado. Escolha outro.', false);
				return;
			}

			// Adiciona o novo usu√°rio com todos os dados
			data.users.push({
				username,
				password,
				instance,
				pronoun,
				jurisdiction,
				preposition,
				instancePrepositionJurisdictionUUID,
				uuid,
				name
			});

			// Salva de volta online
			await fetch(apiUrl, {
				method: 'PUT',
				headers: headers,
				body: JSON.stringify(data)
			});


			showNotification('Usu√°rio registrado com sucesso!', true);
		} catch (error) {
			console.error('Erro ao salvar usu√°rio:', error);
			showNotification('Erro ao registrar usu√°rio. Tente novamente mais tarde.', false);
		}
	}


	function displaySuccessMessage(message) {
		const successBox = document.getElementById("successBox");
		successBox.textContent = message;
		successBox.style.top = "10px";
		successBox.style.opacity = "1";

		setTimeout(() => {
			successBox.style.top = "-50px";
			successBox.style.opacity = "0";
		}, 3000); // Oculta a mensagem ap√≥s 3 segundos
	}

	function logout() {
		userIsLoggedIn = false; // Altere o estado do usu√°rio para deslogado
		
		document.getElementById('sendDataButton').style.display = 'none'; // Oculta o bot√£o de enviar dados

		let title = "";
		if(!user.instancePrepositionJurisdictionUUID.includes("WorkerUUID")){
			if (user.pronoun === 'feminino') {
				title = 'Conselheira';
			} else if (user.pronoun === 'masculino') {
				title = 'Conselheiro';
			} else {
				title = 'Conselheire';
			}
		}

		showNotification(`At√© a pr√≥xima, ${title} ${user.name}!`, true); // Mensagem de confirma√ß√£o
		
		// Limpar os campos do formul√°rio
		document.getElementById('username').value = '';
		document.getElementById('password').value = '';
		document.getElementById('instance').value = '';
		document.getElementById('pronoun').value = '';
		document.getElementById('jurisdiction').value = '';
		document.getElementById('preposition').value = '';
		document.getElementById('nameRegistration').value = '';
		document.getElementById('uuidQRCode').innerHTML = '';
		clearTable();
		user = null;
		
		updateInfoBar(); // Atualiza a barra de informa√ß√µes para refletir o estado de logout
		
		// Rola suavemente para o topo da p√°gina
		window.scrollTo({
			top: 0,
			behavior: 'smooth',
		});
		
		// Esconde a div "logado"
		document.getElementById('logado').style.display = 'none'; // Torna invis√≠vel
		
		 // Remove a classe 'logged-in' do #globeContainer para voltar ao alinhamento centralizado
		const globeContainer = document.getElementById('globeContainer');
		globeContainer.classList.remove('logged-in'); // Remove a classe para voltar ao centro
		
	}

	function showNotification(message, isSuccess) {
		const notificationBox = document.getElementById('successBox');
		notificationBox.textContent = message; // Define a mensagem
		notificationBox.style.opacity = '1'; // Torna vis√≠vel
		notificationBox.style.top = '10px'; // Move para uma posi√ß√£o vis√≠vel

		// Ajusta a cor de fundo com base no tipo de mensagem
		if (isSuccess) {
			notificationBox.style.backgroundColor = 'rgba(0, 255, 0, 0.8)'; // Verde para mensagens de sucesso
			notificationBox.style.color = 'rgba(255, 255, 255, 1)'; // Verde para mensagens de sucesso
		} else {
			notificationBox.style.backgroundColor = 'rgba(255, 255, 0, 0.8)'; // Amarelo amarronzado para mensagens de erro/aten√ß√£o
			notificationBox.style.color = 'rgba(70, 0, 0, 1)'; // Verde para mensagens de sucesso
		}

		 // Calcula a dura√ß√£o da mensagem com base no tamanho do texto
		const duration = Math.ceil(message.length / 80) * 3000;

		// Oculta a mensagem ap√≥s o tempo calculado
		setTimeout(() => {
			notificationBox.style.opacity = '0'; // Torna invis√≠vel
			notificationBox.style.top = '-50px'; // Move para fora da tela
		}, duration);
	}

	// Manipulador para pressionar "Enter" nos campos de Login ou Cadastre-se
	document.addEventListener('keydown', function(event) {
		if (event.key === 'Enter') {
			const activeElement = document.activeElement; // Elemento que est√° em foco
			const loginSection = document.getElementById('loginSection');
			const registerFields = document.getElementById('registrationFields');

			// Verifica se a se√ß√£o de Login est√° vis√≠vel
			if (loginSection && loginSection.style.display !== 'none') {
				// Caso esteja no modo de Cadastro
				if (registerFields && registerFields.style.display === 'block') {
					// Verifica se o foco est√° em um dos campos de Cadastro
					if (activeElement.id === 'instance' || 
						activeElement.id === 'pronoun' || 
						activeElement.id === 'jurisdiction' || 
						activeElement.id === 'preposition') {
						event.preventDefault(); // Impede o comportamento padr√£o do Enter
						handleRegister(); // Simula o clique no bot√£o "Cadastrar"
						return;
					}
				}

				// Verifica se o foco est√° nos campos de Nome de Usu√°rio ou Senha
				if (activeElement.id === 'username' || activeElement.id === 'password') {
					event.preventDefault(); // Impede o comportamento padr√£o do Enter
					//document.getElementById('loginButton').click(); // Simula o clique no bot√£o "Entrar"
					handleLogin();
				}
			}
		}
	});

	let marker, camera, label; // Declare as vari√°veis no escopo global

	function initSmallGlobe() {
		// Seleciona o cont√™iner para a anima√ß√£o
		const globeContainer = document.getElementById('globeContainer');

		// Configura√ß√µes iniciais da cena
		const scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
		const renderer = new THREE.WebGLRenderer({ alpha: true }); // Fundo transparente
		renderer.setSize(300, 300); // Tamanho fixo do globo
		globeContainer.appendChild(renderer.domElement);

		 // Adiciona a esfera da Terra
		const textureLoader = new THREE.TextureLoader();
		const earthTexture = textureLoader.load('https://i.postimg.cc/90NWNd6t/textura-Terra.jpg');
		
		
		const earthGeometry = new THREE.SphereGeometry(1, 32, 32);
		const earthMaterial = new THREE.MeshStandardMaterial({ map: earthTexture });
		earthMaterial.transparent = true;
		earthMaterial.opacity = 0.8;
		const earth = new THREE.Mesh(earthGeometry, earthMaterial);

		// Corrige a orienta√ß√£o da textura
		//earth.rotation.x = Math.PI; // Gira 180 graus para alinhar corretamente


		// Ajuste manual da rota√ß√£o
		//earth.rotation.y = THREE.MathUtils.degToRad(80); // Corrigir longitude

		scene.add(earth);

		// Adiciona ilumina√ß√£o
		const ambientLight = new THREE.AmbientLight(0xff0000, 2);
		scene.add(ambientLight);

		// Aqui adicionamos a luz vermelha
		const redLight = new THREE.PointLight(0xffbbbb, 1);
		redLight.position.set(50, 30, 50);
		scene.add(redLight);

		// Configura a posi√ß√£o inicial da c√¢mera
		camera.position.z = 3;

		// Adiciona o marcador vermelho para a localiza√ß√£o do usu√°rio
		navigator.geolocation.getCurrentPosition(function (position) {
			const latitude = position.coords.latitude;
			const longitude = position.coords.longitude;

			let ajusteManualDeLongitude = -99; //Ajuste para calibra√ß√£o da Longitude do Marcador, em graus

			// Converter latitude e longitude para coordenadas 3D
			const phi = (90 - latitude) * (Math.PI / 180); // Latitude
			const theta = (longitude + 180 + ajusteManualDeLongitude) * (Math.PI / 180); // Longitude

	const loader = new THREE.TextureLoader();
	const globeRadius = 1; // Substitua pelo raio real do globo (exemplo: 1 para THREE.SphereGeometry(1, ...))
	const displacement = 0.1; // Ajuste o deslocamento para fora do globo

	loader.load('https://i.postimg.cc/65gr9cjN/bandeiravermelhaanimada.gif', function (texture) {
		// Criar a geometria da bandeira (um plano)
		const planeGeometry = new THREE.PlaneGeometry(0.2, 0.2); // Ajuste o tamanho da bandeira
		const planeMaterial = new THREE.MeshBasicMaterial({
			map: texture,
			transparent: true,
			side: THREE.DoubleSide // Garante que a bandeira seja vis√≠vel dos dois lados
		});
		marker = new THREE.Mesh(planeGeometry, planeMaterial); // Armazena na vari√°vel global

		// Posicionar a bandeira fora do globo
		marker.position.set(
			(Math.sin(phi) * Math.cos(theta)) * (globeRadius + displacement),
			(Math.cos(phi)) * (globeRadius + displacement),
			(Math.sin(phi) * Math.sin(theta)) * (globeRadius + displacement)
		);

		// Vetor que aponta para o centro do globo
		const center = new THREE.Vector3(0, 0, 0);
		const directionToCenter = center.clone().sub(marker.position).normalize();

		// Alinhar a bandeira com a superf√≠cie
		const upVector = new THREE.Vector3(0, -1, 0); // Vetor "para cima" da bandeira
		const quaternion = new THREE.Quaternion().setFromUnitVectors(upVector, directionToCenter);
		marker.setRotationFromQuaternion(quaternion);
		

		// Adicionar a bandeira ao globo
		earth.add(marker);
	});





			// Usar a API de Geocodifica√ß√£o Reversa para obter o nome da cidade
			const geocodeUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&addressdetails=1&zoom=18`;

			fetch(geocodeUrl)
				.then(response => response.json())
				.then(data => {
					// Tenta diferentes campos para o nome da cidade
					const city = data.address.city || data.address.town || data.address.village || "Cidade desconhecida";
					const state = data.address.state || data.address.region;
					const country = data.address.country;

					// Criar um r√≥tulo HTML para a localiza√ß√£o no globo
					label = document.createElement('div');
					label.innerHTML = `${city}, <br>${state}, <br>${country}`;
					label.style.position = 'absolute';
					label.style.fontSize = '12px';
					label.style.fontWeight = 'bold';
					label.style.backgroundColor = 'rgba(255, 255, 255, 0.7)'; // Fundo branco transparente
					label.style.color = '#8B0000'; // Texto vermelho escuro
					label.style.padding = '5px 10px'; // Espa√ßamento interno
					label.style.borderRadius = '5px'; // Bordas arredondadas
					label.style.textAlign = 'center'; // Centraliza o texto horizontalmente
					label.style.pointerEvents = 'none'; // Evita que o r√≥tulo interfira com intera√ß√µes do globo
					label.style.transform = 'translateX(-50%)'; // Centraliza o r√≥tulo

					// Posicionar o r√≥tulo em cima do ponteiro (marcador)
					globeContainer.appendChild(label);
					
					globeContainer.style.visibility = 'visible';
					
					// Fun√ß√£o para atualizar a posi√ß√£o do r√≥tulo com base na rota√ß√£o
					function updateLabelPosition() {
						const vector = new THREE.Vector3();
						const canvasBounds = renderer.domElement.getBoundingClientRect();

						// Posi√ß√£o da bandeira no mundo 3D
						vector.setFromMatrixPosition(marker.matrixWorld);

						// Converte a posi√ß√£o 3D para 2D (tela)
						vector.project(camera);

						// Converte para coordenadas de pixel no canvas
						const x = (vector.x * 0.5 + 0.5) * canvasBounds.width;
						const y = (1 - (vector.y * 0.5 + 0.5)) * canvasBounds.height;

						// Posiciona o r√≥tulo acima da bandeira (ajuste "y" para subir um pouco)
						label.style.left = `${x}px`;
						label.style.top = `${y - 100}px`; // Move o r√≥tulo um pouco para cima
						
						//console.info('vector.z'+vector.z);
						
						if (vector.z < 0.94) {
							label.style.display = 'block'; // Mostra o HTML quando a bandeira est√° √† frente
						} else {
							label.style.display = 'none'; // Oculta o HTML quando a bandeira est√° atr√°s
						}
						
					}

					// Fun√ß√£o para converter coordenadas 3D para coordenadas da tela
					function getScreenPosition(position, camera, renderer) {
						const vector = position.clone().project(camera);
						const x = (vector.x * 0.5 + 0.5) * renderer.domElement.width;
						const y = (vector.y * -0.5 + 0.5) * renderer.domElement.height;
						return { x, y };
					}

					// Atualiza a posi√ß√£o do r√≥tulo durante a anima√ß√£o
					function animate() {
						requestAnimationFrame(animate);
						 // Atualize a posi√ß√£o do r√≥tulo
						updateLabelPosition();
					}

					animate();
				})
				.catch(error => {
					console.error('Erro ao obter o nome da cidade:', error);
				});
		}, function (error) {
			console.error('Erro ao obter localiza√ß√£o:', error);
		});

		// Fun√ß√£o de anima√ß√£o
		function animate() {
			requestAnimationFrame(animate);
			earth.rotation.y += 0.001; // Velocidade de rota√ß√£o
			
			renderer.render(scene, camera);
		}

		animate();
	}

	function fillTableWithData(inputTableData) {
		const tbody = document.querySelector('#inputTable tbody');
		const thead = document.querySelector('#inputTable thead tr');

		// Limpa a tabela existente
		tbody.innerHTML = '';
		thead.innerHTML = '<th>Produtos / Setores Produtivos</th>';

		if (inputTableData.length === 0) {
			showNotification("Tabela vazia recebida, nenhuma altera√ß√£o feita.", false);
			return;
		}

		// Atualiza os cabe√ßalhos da tabela com base no n√∫mero de colunas
		const numCols = inputTableData[0].length;
		for (let j = 0; j < numCols; j++) {
			const sectorHeader = document.createElement('th');
			const sectorInput = document.createElement('input');
			sectorInput.type = 'text';
			sectorInput.value = `Setor ${j + 1}`;
			sectorInput.oninput = () => updateSectorName(j, sectorInput.value);
			sectorInput.readOnly = true;
			addTooltipBehavior(sectorInput); // Adiciona o comportamento de tooltip
			sectorHeader.appendChild(sectorInput);
			thead.appendChild(sectorHeader);
		}

		// Preenche a tabela com os dados recebidos
		inputTableData.forEach((row, rowIndex) => {
			const tableRow = document.createElement('tr');

			// Adiciona uma c√©lula para o nome do produto
			const productNameCell = document.createElement('td');
			const productInput = document.createElement('input');
			productInput.type = 'text';
			productInput.value = `Produto ${rowIndex + 1}`;
			productInput.oninput = () => updateProductName(rowIndex, productInput.value);
			productNameCell.appendChild(productInput);
			tableRow.appendChild(productNameCell);

			// Preenche os valores das colunas
			row.forEach(value => {
				const cell = document.createElement('td');
				const input = document.createElement('input');
				input.type = 'number';
				input.value = value || 0;
				cell.appendChild(input);
				addHighlightBehavior(cell); // Adiciona o comportamento de destaque
				tableRow.appendChild(cell);
			});

			tbody.appendChild(tableRow);
		});

		//showNotification("Tabela preenchida com os dados recebidos.", true);
	}


	function setFinalDemand(finalDemandData) {
		const tbody = document.getElementById('finalDemandInputs');
		const rows = tbody.querySelectorAll('tr');

		// Certifica-se de que o n√∫mero de entradas de demanda corresponda ao n√∫mero de linhas
		rows.forEach((row, index) => {
			const input = row.querySelector('input[type="number"]');
			input.value = finalDemandData[index] !== undefined ? finalDemandData[index] : 0;
		});

		showNotification("Demanda final atualizada com os dados recebidos.", true);
	}

	function synchronizeFinalDemandProducts() {
		const productRows = document.querySelectorAll('#inputTable tbody tr');
		const demandRows = document.querySelectorAll('#finalDemandInputs tr');

		productRows.forEach((productRow, index) => {
			const productName = productRow.querySelector('td:first-child input').value;
			if (demandRows[index]) {
				demandRows[index].querySelector('td:first-child').textContent = productName;
			}
		});
	}

	function updateAllOptimizeButtons() {
		const demandRows = document.querySelectorAll('#finalDemandInputs tr');
		
		demandRows.forEach((row, index) => {
			updateOptimizeButtonColor(index); // Atualiza a cor do bot√£o com base nos novos dados
		});
	}

	function toggleHTMLVisibility(htmlElement, object, camera) {
		const vector = new THREE.Vector3();
		object.getWorldPosition(vector); // Obt√©m a posi√ß√£o da bandeira no mundo
		vector.project(camera); // Projeta a posi√ß√£o para a tela

		if (vector.z > 0) {
			htmlElement.style.display = 'block'; // Mostra o HTML quando a bandeira est√° √† frente
		} else {
			htmlElement.style.display = 'none'; // Oculta o HTML quando a bandeira est√° atr√°s
		}
	}

	function updateVetorTecnologicoTable() {
		const quantidadeBensProducao = parseInt(document.getElementById('quantidadeBensProducao').value, 10);
		const table = document.getElementById('vetorTecnologicoTable');
		const tbody = table.querySelector('tbody');
		const productColumnTitle = document.querySelector('#producaoMetaTable tbody tr td:first-child input').value;

		// Salvar os dados antigos da tabela "Vetor Tecnol√≥gico"
		const previousData = [];
		tbody.querySelectorAll('tr').forEach((row, rowIndex) => {
			const rowData = [];
			row.querySelectorAll('td input').forEach((input, colIndex) => {
				rowData[colIndex] = input.value; // Armazena o valor da c√©lula
			});
			previousData[rowIndex] = rowData;
		});
		

		// Limpar o conte√∫do atual da tabela
		tbody.innerHTML = '';

		// Criar novas linhas preservando dados antigos
		for (let i = 0; i < quantidadeBensProducao; i++) {
			const row = document.createElement('tr');

			// Criar c√©lula do nome do bem de produ√ß√£o
			const productCell = document.createElement('td');
			const productInput = document.createElement('input');
			productInput.type = 'text';
			productInput.value = previousData[i] && previousData[i][0] !== undefined ? previousData[i][0] : `Bem ${i + 1}`;
			productInput.oninput = syncProductionNames; // Atualiza nomes automaticamente
			productCell.appendChild(productInput);
			row.appendChild(productCell);

			// Criar c√©lula do valor tecnol√≥gico
			const valueCell = document.createElement('td');
			const valueInput = document.createElement('input');
			valueInput.type = 'number';
			valueInput.value = previousData[i] && previousData[i][1] !== undefined && previousData[i][1] !== ''
				? previousData[i][1]
				: '0'; // Define vazio se n√£o houver valor anterior
			valueCell.appendChild(valueInput);
			row.appendChild(valueCell);

			tbody.appendChild(row);
		}

		// Atualizar a tabela de estoque e demanda preservando dados
		updateEstoqueDemandaTable(quantidadeBensProducao);
		syncProductionNames(); // Sincroniza os nomes iniciais
		
		document.querySelector('#vetorTecnologicoTable thead tr th:nth-child(2)').innerHTML = `Quantidade necess√°ria para produzir 1 unidade de ${productColumnTitle}`;
		
	}



	function updateEstoqueDemandaTable(quantidadeBensProducao) {
		const tableBody = document.querySelector("#estoqueDemandaTable tbody");

		// Salvar os dados existentes antes de limpar a tabela
		const previousData = Array.from(tableBody.querySelectorAll("tr")).map(row => ({
			bemDeProducao: row.cells[0].textContent.trim(),
			estoque: row.cells[1].querySelector("input").value.trim(),
			demanda: row.cells[2].querySelector("input").value.trim()
		}));

		// Limpar a tabela
		tableBody.innerHTML = '';

		// Criar novas linhas preservando dados antigos
		for (let i = 0; i < quantidadeBensProducao; i++) {
			const row = document.createElement('tr');

			// Coluna "Bem de Produ√ß√£o"
			const bemDeProducaoCell = document.createElement('td');
			bemDeProducaoCell.textContent = previousData[i]?.bemDeProducao || `Bem ${i + 1}`;
			row.appendChild(bemDeProducaoCell);

			// Coluna "Estoque"
			const estoqueCell = document.createElement('td');
			const estoqueInput = document.createElement('input');
			estoqueInput.type = 'number';
			estoqueInput.value = previousData[i]?.estoque || 0; // Mant√©m o valor ou define como 0
			estoqueCell.appendChild(estoqueInput);
			row.appendChild(estoqueCell);

			// Coluna "Demanda"
			const demandaCell = document.createElement('td');
			const demandaInput = document.createElement('input');
			demandaInput.type = 'number';
			demandaInput.value = previousData[i]?.demanda || 0; // Mant√©m o valor ou define como 0
			demandaCell.appendChild(demandaInput);
			row.appendChild(demandaCell);

			tableBody.appendChild(row);
		}
	}


	function openPropostaModal(index, productName) {
		const modal = document.getElementById('propostaModal');
		const unitName = document.getElementById('comiteColTitle').value || 'Unidade de Produ√ß√£o';
		document.getElementById('unitName').textContent = unitName;
		modal.style.display = 'flex';
		setupEnterKeyListenerForPropostaModal(); // Adiciona o ouvinte
	}

	function closePropostaModal() {
		document.getElementById('propostaModal').style.display = 'none';
	}

	function syncProductionNames() {
		const vetorRows = document.querySelectorAll('#vetorTecnologicoTable tbody tr');
		const estoqueRows = document.querySelectorAll('#estoqueDemandaTable tbody tr');

		vetorRows.forEach((vetorRow, index) => {
			const productInput = vetorRow.querySelector('td:first-child input');
			const estoqueCell = estoqueRows[index]?.querySelector('td:first-child');

			if (productInput && estoqueCell) {
				estoqueCell.textContent = productInput.value; // Atualiza o nome
			}
		});
	}

	
	function openProducaoMetaModal() {
    // Obt√©m a refer√™ncia ao modal
    const modal = document.getElementById('producaoMetaModal');

    // Vari√°veis locais para exibir no modal
    const unitName = document.getElementById('comiteColTitle')?.value || 'Nome n√£o definido';
    const productName = document.querySelector('#producaoMetaTable tbody tr td:first-child input')?.value || 'Produto n√£o definido';
    const workersLimit = document.getElementById('limiteEfetivoTrabalhadores')?.value || '0';
    const producedQuantity = document.getElementById('producedQuantity')?.value || '0';
    const pendingQuantity = document.getElementById('pendingProductionQuantity')?.value || '0';
    const conselhoAssociado = document.getElementById('conselhoPopularAssociadoDeComiteOuTrabalhador')?.value || null;

    // Verifica se o Conselho Associado est√° definido
    if (!conselhoAssociado) {
        //console.info('Conselho Associado n√£o definido.');
        return;
    }

	//alert(`${councilData} ${currentProductIndex} ${modalContext}`);

	if(null !== councilData && null !== currentProductIndex && null !== modalContext){
		populateModalContent(councilData, currentProductIndex, modalContext);
		return;
	}

    // Carregar os dados diretamente do JSONBIN usando conselhoAssociado como instanceKey
    showNotification('Carregando informa√ß√µes do Conselho associado...', true);

    fetch(apiUrl, {
		method: 'GET',
		headers: headers
	})
		.then(response => response.json())
		.then(binData => {
            const record = binData || {};
            councilData = record[conselhoAssociado]; // Usa conselhoAssociado como instanceKey

            // Verifica se os dados do Conselho Associado est√£o dispon√≠veis
            if (!councilData || !councilData.productNames) {
                showNotification('Dados do Conselho associado n√£o encontrados.', false);
                return;
            }

            // Encontra o √≠ndice do produto no array productNames
            currentProductIndex = councilData.productNames.indexOf(productName);
            if (currentProductIndex === -1) {
                showNotification('Produto n√£o encontrado no Conselho associado.', false);
                return;
            }

			modalContext = {
                unitName,
                productName,
                workersLimit,
                producedQuantity,
                pendingQuantity
            };

            populateModalContent(councilData, currentProductIndex, modalContext);
        })
        .catch(err => {
            console.error('Erro ao buscar dados do JSONBin:', err);
            showNotification('Erro ao buscar dados do Conselho associado.', false);
        });
}

function populateModalContent(councilData, currentProductIndex, modalContext) {
	
	// Obt√©m os dados espec√≠ficos do produto
	const optimizationInputs = councilData.optimizationInputs[currentProductIndex] || {};
	const optimizationResults = councilData.optimizationResults[currentProductIndex] || {};
	
    // Desestrutura o contexto para facilitar o acesso
    const { unitName, productName, workersLimit, producedQuantity, pendingQuantity } = modalContext;

    // Dados espec√≠ficos do produto
    const workerHours = optimizationInputs.workerHours || 'N√£o definido';
    const weeklyScale = optimizationInputs.weeklyScale;
	const daysOff = 7 - weeklyScale; // Dias de folga na semana
	const formattedWeeklyScale = `${weeklyScale}X${daysOff}`; // Formata como solicitado
    const nightShift = optimizationInputs.nightShift ? 'Diurno e Noturno' : 'Diurno';
    const productionTime = optimizationInputs.productionTime || 0;
    const totalEmploymentPeriod = formatDays(parseFloat(optimizationResults.totalEmploymentPeriod) * 24); // Converte dias em horas para formatDays
	
	//console.info("optimizationInputs: ");
	//console.log(optimizationInputs);
	
	effectivelyPlannedProductionTime = productionTime; //para ser salvo e usado depois usado no calculo do trabalho social total. √© pego j√° planificado a partir do conselho acima que fez o calculo de planifica√ß√£o

    // Atualiza o conte√∫do do modal
    document.getElementById('producaoMetaContent').innerHTML = `
        <p><strong>Nome da Unidade de Produ√ß√£o:</strong> ${unitName}</p>
        <p><strong>Produto:</strong> ${productName}</p>
        <p><strong>Expediente:</strong> ${workerHours} horas</p>
        <p><strong>Escala Semanal:</strong> ${formattedWeeklyScale}</p>
        <p><strong>Quantidade Necess√°ria de Trabalhadores:</strong> ${workersLimit}</p>
        <p><strong>Produ√ß√£o Finalizada:</strong> ${producedQuantity}</p>
        <p><strong>Produ√ß√£o Pendente:</strong> ${pendingQuantity}</p>
        <p><strong>Turno:</strong> ${nightShift}</p>
        <p><strong>Tempo para Produ√ß√£o (para contrata√ß√£o ou renova√ß√£o):</strong> ${totalEmploymentPeriod}</p>
    `;
    document.getElementById('producaoMetaModal').style.display = 'flex';
}



	
	function closeProducaoMetaModal() {
		const modal = document.getElementById('producaoMetaModal');
		modal.style.display = 'none';
	}

	function scrollToEndOfPage() {
		window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	}

	// Fun√ß√£o para fechar qualquer modal aberto
	function closeAllModals() {
		const modals = document.querySelectorAll('.modal'); // Seleciona todos os modais
		modals.forEach(modal => {
			modal.style.display = 'none';
		});
	}

	// Evento para fechar o modal ao clicar fora do conte√∫do
	window.addEventListener('click', (event) => {
		const modals = document.querySelectorAll('.modal');
		modals.forEach(modal => {
			if (event.target === modal) { // Verifica se o clique foi fora do modal
				modal.style.display = 'none';
			}
		});
		
		const menu = document.getElementById('languageMenu');
        const button = document.getElementById('languageButton');
        if (!menu.contains(event.target) && event.target !== button) {
            menu.style.display = 'none';
        }
		
	});

	 // Manipula a rolagem para criar o efeito de parallax
	 let currentOffset = 0; // Posi√ß√£o atual suavizada
		let targetOffset = 0;  // Posi√ß√£o alvo

		const lerp = (start, end, t) => start + (end - start) * t; // Fun√ß√£o de interpola√ß√£o linear

		const updateBackground = () => {
			// Aproxima a posi√ß√£o atual da posi√ß√£o alvo com suavidade
			currentOffset = lerp(currentOffset, targetOffset, 0.05);

			// Define a posi√ß√£o do fundo
			document.body.style.setProperty('--background-offset', `${currentOffset}%`);

			// Continua o loop
			requestAnimationFrame(updateBackground);
		};

		// Atualiza a posi√ß√£o alvo com base na rolagem do usu√°rio
		window.addEventListener('scroll', () => {
			const scrollPosition = window.scrollY;
			const maxScroll = document.body.scrollHeight - window.innerHeight;

			// Calcula o deslocamento desejado para a imagem de fundo
			targetOffset = (scrollPosition / maxScroll) * 100;
		});

		// Inicia o loop de atualiza√ß√£o do plano de fundo
		updateBackground();

	function savePropostaInputs() {
		const workerLimit = document.getElementById("workerLimitProposta").value.trim();
		const workerHours = document.getElementById("workerHoursProposta").value.trim();
		const productionTime = document.getElementById("productionTimeProposta").value.trim();
		const nightShift = document.getElementById("nightShiftProposta").checked;
		const weeklyScale = document.getElementById("weeklyScaleProposta").value.trim();

		propostaDados = {
			workerLimit,
			workerHours,
			productionTime,
			nightShift,
			weeklyScale
		};

		closePropostaModal();
	}

	// Atualiza o t√≠tulo da coluna na tabela "Vetor Tecnol√≥gico"
	function atualizarTituloColunaVetorTecnologico() {
		const produtoInput = document.querySelector('#producaoMetaTable tbody tr td:first-child input');
		const produtoNome = produtoInput.value || "Produto";
		const colunaTitulo = document.querySelector('#vetorTecnologicoTable thead tr th:nth-child(2)');
		if (colunaTitulo) {
			colunaTitulo.innerHTML = `Quantidade necess√°ria para produzir 1 unidade de ${produtoNome}`;
		}
	}

	// Fun√ß√£o para lidar com a tecla Enter no modal "Proposta para demais Trabalhadores"
	function setupEnterKeyListenerForPropostaModal() {
		const modal = document.getElementById("propostaModal");

		// Adiciona o ouvinte ao modal
		modal.addEventListener("keydown", (event) => {
			if (event.key === "Enter") {
				event.preventDefault(); // Impede o comportamento padr√£o do Enter
				savePropostaInputs(); // Chama a fun√ß√£o de salvar
			}
		});
	}

	//COLOCAR AQUI NESSA FUN√á√ÉO TRECHO QUE, SEJA O CONSELHO QUE FOR, SOMA A CADA SUB-CONSELHO (COME√áANDO DE ZERO) O TRABALHO SOCIAL TOTAL REALIZADO, ASSIM NO CONSELHO MUNDIAL, AO EXECUTAR ESSA FUN√á√ÉO, J√Å TEM SEMPRE O VALOR DO TRABALHO SOCIAL TOTAL ATUALIZADO. COMO CONSEGUE O TRABALHO TOTAL REALIZADO DE UM CONSELHO? VEM DE QUAL ATRIBUTO?
	async function fetchEstimates() {
		
	if (!confirm("Alguns dados da Matriz Tecnol√≥gica atual ser√£o perdidos e substitu√≠dos por dados da estimativa calculada. Tem certeza que deseja prosseguir?")) {
		return; // Sai da fun√ß√£o se o usu√°rio desistir
	}
		
    try {
        const response = await fetch(apiUrl, {
			method: 'GET',
			headers: headers
		});


        if (!response.ok) {
            throw new Error("Erro ao buscar dados do JSONBIN.");
        }

        const data = await response.json();

// Adi√ß√£o para processar matrizes tecnol√≥gicas dos Conselhos acima do Distrital
if (!user.instancePrepositionJurisdictionUUID.includes("Distrital") && !user.instancePrepositionJurisdictionUUID.includes("Comit√™")) {
    const recordsArray = Object.values(data);
    const relevantMatrices = recordsArray.filter(item => 
        item.conselhoPopularAssociadoDeConselhoPopular === user.instancePrepositionJurisdictionUUID &&
        item.inputTable
    );
	
	

    if (relevantMatrices.length > 0) {
        const productSet = new Set();
        const averagedMatrix = {};
        const demandVector = {};
        const optimizationInputs = []; // Array para armazenar os dados para cada produto

        // Lista todos os produtos sem redund√¢ncia e tamb√©m calcula o trabalho social total em conselhos supradistritais
        relevantMatrices.forEach(matrix => {
            matrix.productNames.forEach(productName => productSet.add(productName)); //productSet acaba com a redund√¢ncia que existe aqui nessa itera√ß√£o

			//Soma o Trabalho Social Total da jurisdi√ß√£o do respectivo Conselho Supradistrital (n√£o Comit√™s nem Conselhos Distritais, que j√° est√° feito e calculando corretamente). Serve para todos os supradistritais at√© o Conselho Mundial
			totalSocialWorkDessaJurisdicao += matrix.totalSocialWorkDessaJurisdicao;
			
			console.info("totalSocialWorkDessaJurisdicao += matrix.totalSocialWorkDessaJurisdicao;");
			console.log(totalSocialWorkDessaJurisdicao);
			
        });

        const productList = Array.from(productSet); // Lista ordenada de produtos

        // Calcula m√©dias para cada combina√ß√£o de produto e setor
        productList.forEach((productName, productIndex) => {
            relevantMatrices.forEach(matrix => {
                const matrixProductIndex = matrix.productNames.indexOf(productName);
				
				if (matrixProductIndex !== -1) {
				
                    // C√°lculo da matriz tecnol√≥gica
                    matrix.inputTable[matrixProductIndex].forEach((value, sectorIndex) => {
                        const sectorName = `Produ√ß√£o de ${matrix.productNames[sectorIndex]}`;
                        const key = `${productName}:${sectorName}`;
                        if (!averagedMatrix[key]) {
                            averagedMatrix[key] = { sum: 0, count: 0 };
                        }
                        if (value !== undefined && value !== null) {
							
							//alert("averagedMatrix[key].sum += parseFloat(value);");
							//ENTROU. CADA CONSELHO FAZER SUA SOMA COM BASE NA VARIAVEL DOS CONSELHOS ABAIXO (SO SOMAR TUDO QUE VEM DE BAIXO, 1 VEZ POR CONSELHO (IF SE CONSELHO √â DIFERENTE DO ANTERIOR, PRA VER SE JA MUDOU) E COLOCAR NA VARIAVEL
							//OPTIMIZATIONINPUTS[PRODUCTINDEX] DO CONSELHO (DATA. OU MATRIX. OU ALGO DO TIPO QUE CARREGOU NESSA ITERA√á√ÉO, MAS ANTES CARREGAVA SO COMITE, VE SE CARREGA CONSELHO COM CONSELHOASSOCIADODECONSELHO IGUAL AO DO USUARIO ATUAL) MULTIPLICADO PELO QUE J√Å FOI PRODUZIDO AT√â ESSA JURISDI√á√ÉO
							
							//console.info("matrix: ");
							//console.log(matrix);
							
                            averagedMatrix[key].sum += parseFloat(value);
                            averagedMatrix[key].count += 1;
                        }
                    });

                    // C√°lculo do vetor de demanda
                    const demandValue = matrix.finalDemand[matrixProductIndex];
                    if (!demandVector[productName]) {
                        demandVector[productName] = { sum: 0, count: 0 };
                    }
                    if (demandValue !== undefined && demandValue !== null) {
						
						//alert("demandVector[productName].sum += parseFloat(demandValue);");
						//ENTROU. CADA CONSELHO FAZER SUA SOMA COM BASE NA VARIAVEL DOS CONSELHOS ABAIXO (SO SOMAR TUDO QUE VEM DE BAIXO, 1 VEZ POR CONSELHO (IF SE CONSELHO √â DIFERENTE DO ANTERIOR, PRA VER SE JA MUDOU) E COLOCAR NA VARIAVEL
						//OPTIMIZATIONINPUTS[PRODUCTINDEX] DO CONSELHO (DATA. OU MATRIX. OU ALGO DO TIPO QUE CARREGOU NESSA ITERA√á√ÉO, MAS ANTES CARREGAVA SO COMITE, VE SE CARREGA CONSELHO COM CONSELHOASSOCIADODECONSELHO IGUAL AO DO USUARIO ATUAL) MULTIPLICADO PELO QUE J√Å FOI PRODUZIDO AT√â ESSA JURISDI√á√ÉO
						
						//Entra quando √© Comit√™ ou Conselho
						//totalSocialWorkDessaJurisdicao j√° est√° calculado certo e salvo nos conselhos distritais abaixo
						
                        demandVector[productName].sum += parseFloat(demandValue);
                        demandVector[productName].count += 1;						
					}
				}
			});

            // Inicializa os campos para c√°lculo das m√©dias dos campos exibidos na janela modal
            let totalWorkerLimit = 0, countWorkerLimit = 0;
            let totalWorkerHours = 0, countWorkerHours = 0;
            let totalProductionTime = 0, countProductionTime = 0;
            let totalWeeklyScale = 0, countWeeklyScale = 0;
			let totalNightShift = 0, countNightShift = 0;

            // Calcula as m√©dias para os campos exibidos na janela modal
            relevantMatrices.forEach(matrix => {
                let matrixProductIndex = matrix.productNames.indexOf(productName);

				//console.info("matrixProductIndex: ");
				//console.log(matrixProductIndex);

                if (matrixProductIndex !== -1) {

					//console.info("matrix: ");
					//console.log(matrix);

                    let workerLimit = matrix.optimizationInputs[matrixProductIndex]?.workerLimit;
                    let workerHours = matrix.optimizationInputs[matrixProductIndex]?.workerHours;
                    let productionTime = matrix.optimizationInputs[matrixProductIndex]?.productionTime;
                    let weeklyScale = matrix.optimizationInputs[matrixProductIndex]?.weeklyScale;
					let nightShift = Number(matrix.optimizationInputs[matrixProductIndex]?.nightShift);
					
					
					//console.info("workerLimit: ");
					//console.log(workerLimit);
					//console.info("workerHours: ");
					//console.log(workerHours);
					//console.info("productionTime: ");
					//console.log(productionTime);
					//console.info("weeklyScale: ");
					//console.log(weeklyScale);

                    if (workerLimit !== undefined && workerLimit !== null) {
                        totalWorkerLimit += parseFloat(workerLimit);
                        countWorkerLimit++;
                    }

                    if (workerHours !== undefined && workerHours !== null) {
                        totalWorkerHours += parseFloat(workerHours);
                        countWorkerHours++;
                    }

                    if (productionTime !== undefined && productionTime !== null) {
                        totalProductionTime += parseFloat(productionTime);
                        countProductionTime++;
                    }

                    if (weeklyScale !== undefined && weeklyScale !== null) {
                        totalWeeklyScale += parseFloat(weeklyScale);
                        countWeeklyScale++;
                    }
					
					 if (nightShift !== undefined && nightShift !== null) {
                        totalNightShift += parseFloat(nightShift);
                        countNightShift++;
                    }
                }
            });

            // Adiciona os valores calculados ao array de inputs de otimiza√ß√£o
            optimizationInputs[productIndex] = {
                workerLimit: countWorkerLimit > 0 ? (totalWorkerLimit / countWorkerLimit).toFixed(2) : '',
                workerHours: countWorkerHours > 0 ? (totalWorkerHours / countWorkerHours).toFixed(2) : '',
                productionTime: countProductionTime > 0 ? (totalProductionTime / countProductionTime).toFixed(2) : '',
                weeklyScale: countWeeklyScale > 0 ? (totalWeeklyScale / countWeeklyScale).toFixed(2) : '',
				nightShift: countNightShift > 0 ? Boolean(Math.round((totalNightShift / countNightShift).toFixed(2))) : false,
            };
        });

        // Calcula os valores finais da matriz tecnol√≥gica
        Object.keys(averagedMatrix).forEach(key => {
            averagedMatrix[key] = averagedMatrix[key].count > 0
                ? averagedMatrix[key].sum / averagedMatrix[key].count
                : 0; // Preenche com 0 se n√£o houver dados
        });

        // Calcula os valores finais do vetor de demanda
        Object.keys(demandVector).forEach(key => {
            demandVector[key] = demandVector[key].count > 0
                ? demandVector[key].sum / demandVector[key].count
                : 0; // Preenche com 0 se n√£o houver dados
        });

        // Atualiza a tabela de matriz tecnol√≥gica
        const inputTable = document.getElementById('inputTable');
        const thead = inputTable.querySelector('thead');
        const tbody = inputTable.querySelector('tbody');

        // Cria cabe√ßalho com base na lista de produtos
        thead.innerHTML = '<tr><th>Produtos / Setores Produtivos</th></tr>';
        productList.forEach((productName, index) => {
            const sectorHeader = document.createElement('th');
            const sectorInput = document.createElement('input');
            sectorInput.type = 'text';
            sectorInput.value = `Produ√ß√£o de ${productName}`;
            sectorInput.readOnly = true;
            addTooltipBehavior(sectorInput); // Adiciona o comportamento de tooltip
            sectorHeader.appendChild(sectorInput);
            thead.querySelector('tr').appendChild(sectorHeader);
        });

        // Preenche linhas e c√©lulas com os valores consolidados
        tbody.innerHTML = '';
        productList.forEach((productName, rowIndex) => {
            const row = document.createElement('tr');

            // Primeira c√©lula: nome do produto com funcionalidade de edi√ß√£o
            const productCell = document.createElement('td');
            const productInput = document.createElement('input');
            productInput.type = 'text';
            productInput.value = productName;

            // Sincroniza o nome do produto com o t√≠tulo do setor
            productInput.oninput = () => {
                const correspondingHeader = thead.querySelectorAll('th')[rowIndex + 1]; // +1 para ignorar a coluna de produtos
                if (correspondingHeader) {
                    const headerInput = correspondingHeader.querySelector('input');
                    headerInput.value = `Produ√ß√£o de ${productInput.value}`;
                }
            };

            // Ajusta o cursor para o final do texto
            productInput.addEventListener('focus', () => {
                productInput.setSelectionRange(productInput.value.length, productInput.value.length);
            });

            productCell.appendChild(productInput);
            row.appendChild(productCell);

            // Outras c√©lulas: valores m√©dios ou "0"
            productList.forEach(targetProductName => {
                const cell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'number';
                input.readOnly = true;

                const key = `${productName}:Produ√ß√£o de ${targetProductName}`;
                input.value = averagedMatrix[key] !== undefined ? averagedMatrix[key].toFixed(2) : 0;
                cell.appendChild(input);
                addHighlightBehavior(cell); // Adiciona o comportamento de destaque
                row.appendChild(cell);
            });

            tbody.appendChild(row);
        });

		// Atualiza os valores de "N√∫mero de produtos" e "N√∫mero de Setores Produtivos"
		const numRows = document.getElementById('numRows'); // Campo "N√∫mero de produtos"
		const numCols = document.getElementById('numCols'); // Campo "N√∫mero de Setores Produtivos"

		// Obt√©m o n√∫mero de linhas (produtos) e colunas (setores) da tabela "Matriz Tecnol√≥gica"
		const numProducts = tbody.querySelectorAll('tr').length; // N√∫mero de linhas
		const numSectors = thead.querySelector('tr').querySelectorAll('th').length - 1; // N√∫mero de colunas, excluindo a coluna "Produtos / Setores Produtivos"

		// Atualiza os campos com os valores calculados
		if (numRows) numRows.value = numProducts;
		if (numCols) numCols.value = numSectors;

        // Atualiza a tabela de demanda final com bot√µes "Otimizar"
        const demandTableBody = document.getElementById('finalDemandInputs');
        demandTableBody.innerHTML = '';
        productList.forEach((productName, index) => {
            const row = document.createElement('tr');

            // Primeira c√©lula: nome do produto
            const productCell = document.createElement('td');
            productCell.textContent = productName;
            row.appendChild(productCell);

            // Segunda c√©lula: valor de demanda
            const demandCell = document.createElement('td');
            const demandInput = document.createElement('input');
            demandInput.type = 'number';
            demandInput.readOnly = true;
            demandInput.value = demandVector[productName] !== undefined ? demandVector[productName].toFixed(2) : 0;
            demandCell.appendChild(demandInput);
            row.appendChild(demandCell);

            // Terceira c√©lula: Bot√£o "Otimizar"
            const actionsCell = document.createElement('td');
            const optimizeButton = document.createElement('button');
            optimizeButton.textContent = 'Otimizar';
            optimizeButton.classList.add('optimize-button');
			//console.info("optimizationInputs: ");
			//console.log(optimizationInputs);
            optimizeButton.onclick = () => openOptimizationModalEstimates(index, optimizationInputs);
            actionsCell.appendChild(optimizeButton);
            row.appendChild(actionsCell);

            // Adiciona a linha √† tabela
            demandTableBody.appendChild(row);
        });
    } else {
        showNotification("Nenhuma matriz tecnol√≥gica encontrada para os Conselhos abaixo do seu.", false);
    }
}
// Fim da adi√ß√£o


        if (typeof data === 'object' && data !== null) {
            const inputTechnologicalMatrixTableBody = document.getElementById('inputTechnologicalMatrixTableBody');
            Array.from(inputTechnologicalMatrixTableBody.rows).forEach(row => { //Itera√ß√£o das linhas da matriz tecnol√≥gica
                let productName = row.cells[0].querySelector('input')?.value.trim() || '';

                const recordsArray = Object.values(data);

                let setorUnidade;
				
				if (productName.includes("Rede")) {
					setorUnidade = productName;
				} else {
					setorUnidade = `Produ√ß√£o de ${productName}`;
				}

				//toda vez que itera linha de matriz tecnol√≥gica itera as colunas pra achar a do produto atual que pertence ao vetor de demanda do comit√™. filteredRecords √© a lista de unidades de produ√ß√£o de cada setor que est√° sendo iterado. √© a lista do setor iterado dessa vez.
                const filteredRecords = recordsArray.filter(item => 
                    item.conselhoPopularAssociadoDeComiteOuTrabalhador === user.instancePrepositionJurisdictionUUID && //QUANDO FOR CONSELHO CONSULTANDO CONSELHO USAR√Å item.conselhoPopularAssociadoDeConselhoPopular
                    item.setorUnidade === setorUnidade
                );

                let resultMessage = "";
                let summedTechnologicalVectors = [];
				let summedDemandVectors = [];
				let summedProposalVectors = [];
                let workerLimit = null;

				//console.info("filteredRecords: ");
				//console.log(filteredRecords);

                if (filteredRecords.length > 0) {
                    resultMessage = `Vetores Tecnol√≥gicos do setor ${setorUnidade}:\n`;

                    const demandaFinalInputs = document.querySelectorAll('#finalDemandInputs input[type="number"]');
                    let productIndex = -1;

                    demandaFinalInputs.forEach((input, index) => {
                        const produtoNome = document.querySelectorAll('#finalDemandInputs tr')[index].cells[0].textContent.trim();
                        if (produtoNome === productName) { //Achando a coluna da matriz tecnol√≥gica que est√° o setor
                            productIndex = index;							
                        }
                    });

                    if (productIndex === -1) {
                        showNotification(`Cadastre o produto ${productName} nesse Conselho!`, false);
                        return;
                    }

					let limiteEfetivoTrabalhadoresTotal = 0;

					for (const productionUnit of filteredRecords) { //soma para achar o limiteEfetivoTrabalhadoresTotal necess√°rio para o c√°lculo do peso.
						limiteEfetivoTrabalhadoresTotal = limiteEfetivoTrabalhadoresTotal + parseInt(productionUnit.limiteEfetivoTrabalhadores);
						
						console.info('productionUnit.effectivelyPlannedProductionTime: ');
						console.log(productionUnit.effectivelyPlannedProductionTime);
						
						//S√≥ passa aqui quando √© Comit√™
						totalSocialWorkDessaJurisdicao += productionUnit.producaoMeta[0].quantidadeProduzida*productionUnit.effectivelyPlannedProductionTime;
						
				
					}
					
					//console.info("limiteEfetivoTrabalhadoresTotal: ");
					//console.log(limiteEfetivoTrabalhadoresTotal);
					
					console.info("totalSocialWorkDessaJurisdicao: ");
					console.log(totalSocialWorkDessaJurisdicao);

                    for (const productionUnit of filteredRecords) { //itera√ß√£o das unidades de produ√ß√£o do setor desta rodada na itera√ß√£o. o limiteEfetivoTrabalhadoresTotal deve ser somado antes, de todas essas unidades, antes de prosseguir, o que foi feito acima
						
						productionUnit.vetorDemanda = [];
						productionUnit.vetorProposta = [];
						if (Array.isArray(productionUnit.estoqueDemanda)) {
							 productionUnit.vetorDemanda = productionUnit.estoqueDemanda.map(item => item.demanda);
						}
						if (productionUnit.limiteEfetivoTrabalhadores !== undefined && productionUnit.propostaTrabalhadores) {
							productionUnit.vetorProposta = [
								productionUnit.limiteEfetivoTrabalhadores,
								productionUnit.propostaTrabalhadores.workerHours,
								productionUnit.propostaTrabalhadores.productionTime,
								Number(productionUnit.propostaTrabalhadores.nightShift), // transforma true e false em 1 e 0 pra poder calcular m√©dia e depois voltamos pra true e false arredondando pra 1 ou 0
								productionUnit.propostaTrabalhadores.weeklyScale
							];
						}
						
                        const vetorTecnologico = productionUnit.vetorTecnologico;
						const vetorDemanda = productionUnit.vetorDemanda;
						const vetorProposta = productionUnit.vetorProposta;
						
                        const limiteEfetivoTrabalhadores = parseFloat(productionUnit.limiteEfetivoTrabalhadores);

                        //if (optimizationInputs[productIndex] && optimizationInputs[productIndex].workerLimit) {
                        //    workerLimit = parseFloat(optimizationInputs[productIndex].workerLimit);
                        //}

                        //if (!workerLimit || isNaN(workerLimit)) {
                        //    showNotification(`Preencha os dados de otimiza√ß√£o de ${productName}`, false);
                        //    openOptimizationModal(productIndex);
                        //    return;
                        //}

                        const productionUnitWeight = limiteEfetivoTrabalhadores / limiteEfetivoTrabalhadoresTotal;
						
						//console.info("limiteEfetivoTrabalhadores: ");
						//console.log(limiteEfetivoTrabalhadores);
						//console.info("limiteEfetivoTrabalhadores/limiteEfetivoTrabalhadoresTotal = productionUnitWeight: ");
						//console.log(productionUnitWeight);
						
                        const adjustedTechnologicalVectors = vetorTecnologico.map(value => (value * productionUnitWeight).toFixed(2));
						const adjustedDemandVectors = vetorDemanda.map(value => (value * productionUnitWeight).toFixed(2));
						const adjustedProposalVectors = vetorProposta.map(value => (value * productionUnitWeight).toFixed(2));
						adjustedProposalVectors[0]=limiteEfetivoTrabalhadoresTotal; //n√£o calcula o peso do limiteEfetivoTrabalhadores, pois ele √© real, efetivo, e √© usado para o calculo do peso (n√£o pode ser peso dele mesmo)

                        if (summedTechnologicalVectors.length === 0) {
                            summedTechnologicalVectors = adjustedTechnologicalVectors.map(val => parseFloat(val));
                        } else {
                            summedTechnologicalVectors = summedTechnologicalVectors.map((sum, i) => sum + parseFloat(adjustedTechnologicalVectors[i]));
                        }
						
						if (summedDemandVectors.length === 0) {
                            summedDemandVectors = adjustedDemandVectors.map(val => parseFloat(val));
                        } else {
                            summedDemandVectors = summedDemandVectors.map((sum, i) => sum + parseFloat(adjustedDemandVectors[i]));
                        }
						
						if (summedProposalVectors.length === 0) {
                            summedProposalVectors = adjustedProposalVectors.map(val => parseFloat(val));
                        } else {
                            summedProposalVectors = summedProposalVectors.map((sum, i) => sum + parseFloat(adjustedProposalVectors[i]));
                        }

                        resultMessage += `De alguma f√°brica: ${vetorTecnologico.join(", ")}\n`;
                        resultMessage += `pesoDaUnidadeDeProdu√ß√£o=${productionUnitWeight.toFixed(2)}\n`;
                        resultMessage += `Vetor Tecnol√≥gico M√©dio: ${adjustedTechnologicalVectors.join(", ")}\n`;

                        const weightedAverageTechnologicalVector = summedTechnologicalVectors.map(sum => (sum / filteredRecords.length).toFixed(2));
                        resultMessage += `M√©dia Ponderada dos Vetores Tecnol√≥gicos: ${weightedAverageTechnologicalVector.join(", ")}`;
						
						const weightedAverageDemandVector = summedDemandVectors.map(sum => (sum / filteredRecords.length).toFixed(2));
                        resultMessage += `M√©dia Ponderada dos Vetores Demandas: ${weightedAverageDemandVector.join(", ")}`;
						
						const weightedAverageProposalVector = summedProposalVectors.map(sum => (sum / filteredRecords.length).toFixed(2));
						
						//Arredonda valores que n√£o podem ser quebrados
						//weightedAverageProposalVector[0] = Math.round(weightedAverageProposalVector[0]); //limiteEfetivoTrabalhadores Total (n√£o m√©dio, sen√£o n√£o normaliza)
						
						//console.info("limiteEfetivoTrabalhadoresTotal: ");
						//console.log(limiteEfetivoTrabalhadoresTotal);
						
						
						
						weightedAverageProposalVector[0] = Math.round(limiteEfetivoTrabalhadoresTotal);
						weightedAverageProposalVector[1] = parseFloat(weightedAverageProposalVector[1]); //workerHours m√©dia
						weightedAverageProposalVector[2] = parseFloat(weightedAverageProposalVector[2]);
						weightedAverageProposalVector[3] = Boolean(Math.round(weightedAverageProposalVector[3])); //Turno Diurno/Noturno. se menor ou igual a 0,5 retorna false, se maior retorna true (m√©dia booleana)
						weightedAverageProposalVector[4] = Math.round(weightedAverageProposalVector[4]); //weeklyScale m√©dia
						
						//console.info("weightedAverageProposalVector[4]: ");
						//console.log(weightedAverageProposalVector[4]);
						
						
                        resultMessage += `M√©dia Ponderada dos Vetores Propostas: ${weightedAverageProposalVector.join(", ")}`;

                        if (productionUnit.estoqueDemanda && Array.isArray(productionUnit.estoqueDemanda)) {
                            const inputTechnologicalMatrixTableBody = document.getElementById('inputTechnologicalMatrixTableBody');
							
							const inputFinalDemandTableBody = document.getElementById('finalDemandInputs');

                            if (inputTechnologicalMatrixTableBody.rows.length >= weightedAverageTechnologicalVector.length + 1) {
							
                                productionUnit.estoqueDemanda.forEach((estoqueDemandaRow, index) => {
                                    const bemDeProducao = estoqueDemandaRow.bemDeProducao.trim();
									
                                    const matchingTechnologicalRow = Array.from(inputTechnologicalMatrixTableBody.rows).find(r => r.cells[0].querySelector('input').value.trim() === bemDeProducao);
									
									const matchingFinalDemandRow = Array.from(inputFinalDemandTableBody.rows).find(r => r.cells[0].textContent.trim() === bemDeProducao);
									
									const thead = document.getElementById('inputTable').querySelector('thead');
                                    const sectorHeaders = thead.querySelectorAll('th input');
                                    const setorColIndex = Array.from(sectorHeaders).findIndex(input => input.value.includes(setorUnidade)) + 1;

                                    if (matchingTechnologicalRow && matchingTechnologicalRow.cells[setorColIndex]?.querySelector('input')) {
                                    
									//Estimativas na Matriz Tecnol√≥gica
									matchingTechnologicalRow.cells[setorColIndex].querySelector('input').value = weightedAverageTechnologicalVector[index];
																		
									//console.info(`weightedAverageDemandVector[${index}]`);
									//console.log(weightedAverageDemandVector[index]);
									
									//Estimativa no vetor Demanda Final 
									matchingFinalDemandRow.cells[1].querySelector('input').value = weightedAverageDemandVector[index];
									
									//Estimativas na janela modal "Otimiza√ß√£o"									
									document.getElementById('workerLimit').value = weightedAverageProposalVector[0];
									document.getElementById('workerHours').value = weightedAverageProposalVector[1];
									document.getElementById('productionTime').value = weightedAverageProposalVector[2];
									document.getElementById('nightShift').checked = weightedAverageProposalVector[3];
									document.getElementById('weeklyScale').value = weightedAverageProposalVector[4];
									
									currentProductIndex = productIndex;
									
									//Salvar modal (pra ajustar bot√£o inclusive)
									setTimeout(() => {
										saveOptimizationInputs();
									}, 3000);
										
                                    } else {
                                        showNotification(`Cadastre o produto ${bemDeProducao}, pois √© um bem de produ√ß√£o do setor ${setorUnidade}.`, false);
                                    }
                                });
								
                            } else {
                                resultMessage = `A Matriz Tecnol√≥gica n√£o possui a mesma quantidade de produtos m√≠nima usados como bens de produ√ß√£o do setor ${setorUnidade}. Deve possuir no m√≠nimo ${weightedAverageTechnologicalVector.length + 1} linhas (ou produtos). Cadastre os bens de produ√ß√£o desse setor.`;
								showNotification(resultMessage, false);
                            }
                        }
                    }
                } else {
                    //resultMessage = `Nenhum vetor tecnol√≥gico encontrado para o setor ${setorUnidade}.`;
                }

                console.info(resultMessage);
            });
        } else {
            console.error("data n√£o √© um objeto v√°lido.");
            alert("Ocorreu um erro ao processar os dados. Tente novamente.");
        }
    } catch (error) {
        console.error("Erro ao buscar vetores tecnol√≥gicos:", error);
        alert("Ocorreu um erro ao buscar os vetores tecnol√≥gicos. Por favor, tente novamente.");
    }
}

function updateDemandAndGoal() {
	
	
	const confirmation = confirm("Voc√™ salvou altera√ß√µes que tenha feito aqui?");
	if (!confirmation) {
		showNotification("Salve as altera√ß√µes que fez aqui." ,false);
		return;
	}
	
    // Obter a chave da inst√¢ncia a partir do campo "Conselho Popular Associado:"
    const instanceKey = document.getElementById("conselhoPopularAssociadoDeComiteOuTrabalhador").value.trim();
    const targetProduct = document.querySelector("#producaoMetaTable tbody tr input[type='text']").value.trim();

    if (!instanceKey) {
        console.error("Conselho Popular Associado n√£o preenchido.");
        return;
    }

    fetch(apiUrl, {
		method: 'GET',
		headers: headers
	})
		.then(response => response.json())
		.then(binData => {
            const record = binData || {};
            const instanceData = record[instanceKey];

            if (instanceData) {
                const { optimizationResults, productNames, setorUnidade } = instanceData; //CARREGAR plannedFinalDemand

                // Encontrar √≠ndice do produto no vetor "productNames"
                const productIndex = productNames.indexOf(targetProduct);

                if (productIndex !== -1 && optimizationResults) {
                    // Localizar o valor correspondente no vetor "optimizationResults"
					//console.info("optimizationResults: ");
					//console.log(optimizationResults);
					//console.info("productIndex: ");
					//console.log(productIndex);
                    const requiredProduction = optimizationResults[productIndex].plannedFinalDemand;

					//console.info("requiredProduction: ");
					//console.log(requiredProduction);

                    // Filtrar as unidades de produ√ß√£o do setor atual
                    const filteredRecords = Object.values(record).filter(item =>
                        item.conselhoPopularAssociadoDeComiteOuTrabalhador === instanceKey &&
                        item.setorUnidade === `Produ√ß√£o de ${targetProduct}`
                    );

                    // Calcular o totalEffectiveWorkersLimit
                    let totalEffectiveWorkersLimit = 0;
                    filteredRecords.forEach(productionUnit => {
                        if (productionUnit.limiteEfetivoTrabalhadores) {
                            totalEffectiveWorkersLimit += parseInt(productionUnit.limiteEfetivoTrabalhadores, 10);
                        }
                    });

                    if (totalEffectiveWorkersLimit === 0) {
                        console.error("Nenhum trabalhador efetivo encontrado nas unidades de produ√ß√£o filtradas.");
                        return;
                    }

                    // Obter o totalEffectiveWorkers da interface
                    const totalEffectiveWorkers = parseFloat(document.getElementById("limiteEfetivoTrabalhadores").value.trim()) || 0;

                    // Calcular o peso da unidade de produ√ß√£o
                    const productionUnitWeight = totalEffectiveWorkers / totalEffectiveWorkersLimit;

					let sociallyDeterminedProductionGoal = productionUnitWeight*requiredProduction;
					//console.info("requiredProduction: ");
					//console.log(requiredProduction);
					let producedQuantity = 5;
					let pendingProductionQuantity = ((sociallyDeterminedProductionGoal-producedQuantity*1000)/1000).toFixed(3); //divide por 1000 s√≥ pra dar a ordem de grandeza, mas pode mudar isso
					
					document.getElementById("pendingProductionQuantity").value = pendingProductionQuantity;

					// Adi√ß√£o: Itera√ß√£o nas tabelas "Estoque e Demanda" e "Vetor Tecnol√≥gico"
                    const stockDemandTable = document.querySelector("#estoqueDemandaTable tbody");
                    const techVectorTable = document.querySelector("#vetorTecnologicoTable tbody");

                    if (stockDemandTable && techVectorTable) {
                        const stockRows = stockDemandTable.rows;
                        const techRows = techVectorTable.rows;

                        for (let i = 0; i < stockRows.length && i < techRows.length; i++) {
                            // Obter valores das colunas relevantes
                            const quantidadeDeUmBemDeProducao = parseFloat(techRows[i].cells[1].querySelector("input").value) || 0;
                            const estoqueDeUmBemDeProducao = parseFloat(stockRows[i].cells[1].querySelector("input").value) || 0;

                            // Calcular demanda de um bem de produ√ß√£o
                            const demandaDeUmBemDeProducao = 
                                quantidadeDeUmBemDeProducao * pendingProductionQuantity - estoqueDeUmBemDeProducao;

                            // Atualizar a coluna correspondente na tabela "Estoque e Demanda"
                            stockRows[i].cells[2].querySelector("input").value = demandaDeUmBemDeProducao.toFixed(3);
                        }
                    }

                    // Exibir os resultados no console
                    console.log("Required production to meet final demand:", requiredProduction);
                    console.log("Total Effective Workers Limit:", totalEffectiveWorkersLimit);
                    console.log("Production Unit Weight:", productionUnitWeight);
					console.log("sociallyDeterminedProductionGoal:", sociallyDeterminedProductionGoal);
					console.log("producedQuantity:", producedQuantity);
					console.log("pendingProductionQuantity:", pendingProductionQuantity);
					
					
					
					
                } else {
                    console.error("Produto ou demanda final n√£o encontrada.");
                }
            } else {
                console.error("Nenhum dado encontrado para a inst√¢ncia:", instanceKey);
            }
        })
        .catch(err => console.error("Erro ao carregar dados do JSONBin:", err));

    // Rolar para o final da p√°gina
    scrollToEndOfPage();
}

function addTooltipBehavior(inputElement) {
    inputElement.addEventListener('mouseenter', (e) => {
        const value = e.target.value;

        // Cria o tooltip
        const tooltip = document.createElement('div');
        tooltip.className = 'custom-tooltip';
        tooltip.textContent = value;
        document.body.appendChild(tooltip);

        // Calcula a posi√ß√£o do tooltip
        const rect = e.target.getBoundingClientRect();
        tooltip.style.left = `${rect.left + window.scrollX + rect.width / 2 - tooltip.offsetWidth / 2}px`;
        tooltip.style.top = `${rect.top + window.scrollY - tooltip.offsetHeight - 8}px`;
    });

    inputElement.addEventListener('mouseleave', () => {
        // Remove o tooltip ao sair
        const tooltip = document.querySelector('.custom-tooltip');
        if (tooltip) {
            tooltip.remove();
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    let isDragging = false; // Verifica se o usu√°rio est√° arrastando
    let startX = 0, startY = 0; // Posi√ß√£o inicial do mouse
    let scrollLeft = 0, scrollTop = 0; // Posi√ß√£o inicial de rolagem
    let velocityX = 0, velocityY = 0; // Velocidade de rolagem

    document.body.style.cursor = 'default'; // Cursor padr√£o

    document.addEventListener('mousedown', (e) => {

        isDragging = true;
        startX = e.pageX; // Posi√ß√£o X inicial
        startY = e.pageY; // Posi√ß√£o Y inicial
        scrollLeft = window.scrollX; // Posi√ß√£o inicial de rolagem horizontal
        scrollTop = window.scrollY; // Posi√ß√£o inicial de rolagem vertical

        velocityX = 0;
        velocityY = 0;

        document.body.style.cursor = 'move'; // Muda o cursor para "move"
    });

    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return; // S√≥ funciona enquanto arrastando

        // Calcula o quanto o mouse se moveu
        const moveX = startX - e.pageX;
        const moveY = startY - e.pageY;

        velocityX = moveX * 0.05; // Ajuste de sensibilidade
        velocityY = moveY * 0.05;
    });

    document.addEventListener('mouseup', () => {
        isDragging = false; // Termina o arraste
        document.body.style.cursor = 'default'; // Restaura o cursor padr√£o
    });

    // Suaviza a rolagem
    function smoothScroll() {
        if (!isDragging) {
            // Diminui gradualmente a velocidade quando o mouse n√£o est√° arrastando
            velocityX *= 0.98; // Ajuste de desacelera√ß√£o
            velocityY *= 0.98;
        }

        // Atualiza a posi√ß√£o da rolagem
        window.scrollBy(velocityX, velocityY);

        // Para o loop quando o movimento for insignificante
        if (Math.abs(velocityX) > 0.1 || Math.abs(velocityY) > 0.1) {
            requestAnimationFrame(smoothScroll);
        }
    }

    // Inicia a suaviza√ß√£o cont√≠nua
    document.addEventListener('mousemove', () => {
        if (isDragging || Math.abs(velocityX) > 0.1 || Math.abs(velocityY) > 0.1) {
            requestAnimationFrame(smoothScroll);
        }
    });
});


function addHighlightBehavior(cell) {
    cell.addEventListener('mouseover', () => {
        const table = document.getElementById('inputTable');
        const row = cell.parentElement;
        const cellIndex = Array.from(row.children).indexOf(cell);

        // Destaca a coluna
        Array.from(table.rows).forEach(row => {
            if (row.cells[cellIndex]) {
                row.cells[cellIndex].classList.add('highlight-column');
            }
        });
    });

    cell.addEventListener('mouseout', () => {
        const table = document.getElementById('inputTable');
        const row = cell.parentElement;
        const cellIndex = Array.from(row.children).indexOf(cell);

        // Remove o destaque da coluna
        Array.from(table.rows).forEach(row => {
            if (row.cells[cellIndex]) {
                row.cells[cellIndex].classList.remove('highlight-column');
            }
        });
    });
}

 // Alterna o menu de idiomas e o posiciona pr√≥ximo ao bot√£o
    function toggleLanguageMenu(event) {
        const menu = document.getElementById('languageMenu');
        const button = event.currentTarget;

        if (menu.style.display === 'none' || menu.style.display === '') {
            const rect = button.getBoundingClientRect();
            menu.style.top = `${rect.bottom + window.scrollY}px`;
            menu.style.left = `${rect.left + window.scrollX}px`;
            menu.style.display = 'block';
        } else {
            menu.style.display = 'none';
        }
    }

    function translatePage(language) { 
    // Dicion√°rio com tradu√ß√µes da mensagem
    const translations = {
        en: "Functionality under development. But as a suggestion, you can use your browser's native translator.",
        pt: "Funcionalidade em desenvolvimento. Mas como sugest√£o, voc√™ pode usar o tradutor nativo do seu navegador.",
        es: "Funcionalidad en desarrollo. Pero como sugerencia, puedes utilizar el traductor nativo de tu navegador.",
        fr: "Fonctionnalit√© en cours de d√©veloppement. Mais √† titre de suggestion, vous pouvez utiliser le traducteur natif de votre navigateur.",
        zh: "ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠„ÄÇ‰ΩÜÂª∫ËÆÆÊÇ®‰ΩøÁî®ÊµèËßàÂô®ÁöÑÊú¨Êú∫ÁøªËØëÂô®„ÄÇ",
        ru: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ù–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –≤–∞—à–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.",
        ar: "Ÿàÿ∏ÿßÿ¶ŸÅ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±. ŸàŸÑŸÉŸÜ ŸÉÿßŸÇÿ™ÿ±ÿßÿ≠ÿå ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ ÿßŸÑÿ£ÿµŸÑŸä ŸÑŸÑŸÖÿ™ÿµŸÅÿ≠ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ.",
        yo: "I·π£·∫π ·π£i·π£e lab·∫π idagbasoke. ·π¢ugb·ªçn g·∫πg·∫πbi im·ªçran, o le lo onitum·ªç abinibi ti a·π£awakiri r·∫π."
    };

    // Obt√©m a mensagem traduzida com base no idioma selecionado
    const message = translations[language] || translations.en; // Default para ingl√™s se o idioma n√£o for encontrado

    // Altera o idioma da p√°gina
    document.documentElement.lang = language;

    // Notifica o usu√°rio sobre como ativar a tradu√ß√£o
    showNotification(message);

    // Oculta o menu de idiomas
    document.getElementById('languageMenu').style.display = 'none';
}

function openOptimizationModalEstimates(productIndex, optimizationInputsLocal) {
    // Se optimizationInputsLocal for passado, use-o. Caso contr√°rio, chame a fun√ß√£o original
	
	optimizationInputs = optimizationInputsLocal;
	
	//console.info("optimizationInputs na openOptimizationModal: ");
	//console.log(optimizationInputs);
	
    //Chama a fun√ß√£o original
    openOptimizationModal(productIndex);
}

function generateUUID() {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let uuidBase = '';

    // Gera os primeiros 22 caracteres do UUID (Base64-like)
    for (let i = 0; i < 22; i++) {
        uuidBase += characters.charAt(Math.floor(Math.random() * characters.length));
    }

    // Gera os 2 d√≠gitos verificadores
    const checksum = generateUUIDChecksum(uuidBase);

    // Retorna o UUID completo (22 caracteres + 2 d√≠gitos verificadores)
	let uuid = uuidBase + checksum;
	
	//console.info("uuid: ");
	//console.log(uuid);
	
    return uuid;
}

function generateUUIDChecksum(uuidBase) {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let sum = 0;

    // Calcula a soma ponderada dos caracteres
    for (let i = 0; i < uuidBase.length; i++) {
        const char = uuidBase[i];
        const value = characters.indexOf(char); // √çndice no conjunto de caracteres
        sum += value * (i + 1); // Pondera√ß√£o baseada na posi√ß√£o (1-based)
    }

    // Gera 2 caracteres alfanum√©ricos para o checksum
    const checksumValue1 = sum % 62; // Primeiro caractere do checksum
    const checksumValue2 = Math.floor(sum / 62) % 62; // Segundo caractere do checksum

    return characters[checksumValue1] + characters[checksumValue2];
}

function validateUUID(uuid) {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

    // Verifica o comprimento total do UUID (22 caracteres + 2 d√≠gitos verificadores)
    if (uuid.length !== 24) return false;

    // Extrai a base e o checksum do UUID
    const uuidBase = uuid.slice(0, 22); // Primeiros 22 caracteres
    const checksum = uuid.slice(22);   // √öltimos 2 caracteres

    // Recalcula o checksum com base na base do UUID
    const calculatedChecksum = generateUUIDChecksum(uuidBase);

    // Compara o checksum fornecido com o recalculado
    return checksum === calculatedChecksum;
}


		function generateQRCode(data) {
            const qrCodeDiv = document.getElementById("uuidQRCode");

            // Limpa qualquer QR Code anterior
            qrCodeDiv.innerHTML = "";

            // Gera o QR Code diretamente na div
            new QRCode(qrCodeDiv, {
                text: data,
                width: 200,
                height: 200,
                colorDark: "#000000", // Cor do QR Code
                colorLight: "#ffffff", // Cor de fundo
                correctLevel: 2 // N√≠vel de corre√ß√£o de erros
            });
			
        }


		</script>
	</body>
	</html>
